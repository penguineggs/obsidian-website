(()=>{var yi=Object.defineProperty,Ei=Object.defineProperties;var gi=Object.getOwnPropertyDescriptors;var ct=Object.getOwnPropertySymbols;var wi=Object.prototype.hasOwnProperty,bi=Object.prototype.propertyIsEnumerable;var ut=(a,e,t)=>e in a?yi(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,Le=(a,e)=>{for(var t in e||(e={}))wi.call(e,t)&&ut(a,t,e[t]);if(ct)for(var t of ct(e))bi.call(e,t)&&ut(a,t,e[t]);return a},dt=(a,e)=>Ei(a,gi(e));var l=(a,e,t)=>new Promise((n,s)=>{var u=g=>{try{m(t.next(g))}catch(v){s(v)}},f=g=>{try{m(t.throw(g))}catch(v){s(v)}},m=g=>g.done?n(g.value):Promise.resolve(g.value).then(u,f);m((t=t.apply(a,e)).next())});function ie(a){if(!navigator.clipboard||!navigator.permissions){let e=document.createElement("textarea");e.value=a,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e);try{e.focus(),e.select(),document.execCommand("copy")}catch(t){}document.body.removeChild(e);return}navigator.clipboard.writeText(a)}var aa=window.requestIdleCallback;var sa=/bot|crawl|spider/i.test(navigator.userAgent);var vi=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){vi={passive:!1}}}))}catch(a){}function Ti(a){return new Promise((e,t)=>{let n=document.createElement("script");n.type="text/javascript",n.src=a,n.addEventListener("load",()=>e(n)),n.addEventListener("error",s=>t(s)),document.body.appendChild(n)})}function De(a,e){let t=!1,n=null;return{get loaded(){return t},get promise(){if(t)return Promise.resolve();if(!n){e&&e.before&&e.before();let s=Ti(a);s.catch(u=>{u.detach(),n=null}),n=s.then(()=>{t=!0,n=null,e&&e.after&&e.after()})}return n},then(s){return t?s():this.promise.then(s)}}}var ht=new Map;for(let a of"a abbr acronym b bdi bdo big br button canvas cite code data del dfn em embed i iframe img input ins kbd label map mark meter noscript object outputpicture progress q ruby s samp select small span strong sub sup svg textarea time u tt var video wbr".split(" "))ht.set(a,!0);for(let a of"address article aside blockquote details dialog dd div dl dt fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hgroup hr li main nav ol p pre ul".split(" "))ht.set(a,!1);function T(a){let e,t=!1;return()=>(t||(e=a(),t=!0),e)}var A=class{static encodeUrlQuery(e){if(!e)return"";let t=[];for(let n in e)e.hasOwnProperty(n)&&e[n]&&(e[n]===!0?t.push(encodeURIComponent(n)):t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n])));return t.join("&")}static decodeUrlQuery(e){let t={};if(!e||e.trim()==="")return t;let n=e.split("&");for(let s=0;s<n.length;s++){let u=n[s].split("=");if(u.length>=1&&u[0]){let f=decodeURIComponent(u[0]);u.length===2?t[f]=decodeURIComponent(u[1]):t[f]=""}}return t}static decodeUrl(e){e||(e="");let t=e.split("#"),n=t.length>1?t[1]:"",s=t[0].split("?"),u=s.length>1?s[1]:"";return{path:s[0],query:A.decodeUrlQuery(u),hash:A.decodeUrlQuery(n)}}static addQuery(e,t){return e+(e.contains("?")?"&":"?")+A.encodeUrlQuery(t)}};function pt(a){let e=[];for(let t=0;t<a;t++)e.push((Math.random()*16|0).toString(16));return e.join("")}function ae(a,e,t){return"https://raw.githubusercontent.com/"+a+"/"+(t||"HEAD")+"/"+e}function c(a,e){return l(this,null,function*(){let t;try{t=yield ajaxPromise({method:"POST",url:a,data:e})}catch(n){throw n.error?n.error:n}if(t=JSON.parse(t),t.error)throw t.error;return t})}var pa=ae("obsidianmd/obsidian-releases","community-plugins.json");var ma=ae("obsidianmd/obsidian-releases","community-plugin-stats.json");var fa=ae("obsidianmd/obsidian-releases","community-css-themes.json");var yt=location.host.startsWith("127.0.0.1")||location.host.startsWith("localhost"),h="https://api.obsidian.md";yt&&(h="http://127.0.0.1:3000");var Ci=h+"/user/info",xi=h+"/user/signin",Li=h+"/user/signup",Di=h+"/user/signout",Pi=h+"/user/forgetpass",Fi=h+"/user/resetpass",Si=h+"/user/changename",Mi=h+"/user/changeemail",Ai=h+"/user/changepass",ki=h+"/user/deleteaccount",Ri=h+"/subscription/list",mt=h+"/subscription/pay",Ii=h+"/subscription/stripe/end",ft=h+"/subscription/price",Hi=h+"/subscription/business/rename",Oi=h+"/subscription/business/reduce",k=h+"/subscription/renew",Bi=h+"/subscription/publish/reduce",Ni=h+"/subscription/paymentmethod",_i=h+"/subscription/stripe/paymentmethod",Ui=h+"/subscription/role/discord",Yi=h+"/subscription/role/forum",ji=h+"/subscription/invoice/list",Gi=h+"/subscription/invoice/refund",$i=h+"/subscription/paypal/clientid",qi=h+"/subscription/stripe/finish",Vi=h+"/user/discount/apply",Xi=h+"/user/gift/create",Wi=h+"/user/gift/list",zi=h+"/user/gift/info",Ae=h+"/user/gift/redeem",Ki=h+"/publish/share/info",Qi=h+"/publish/share/accept",Et="pk_live_vqeOYADfYPpqKDT5FtAqCNBP00a9WEhYa6";yt&&(Et="pk_test_y7CBP7qLG6kSU9sdcHV5S2db0052OC4wR8");function Pe(){history.pushState?history.pushState("",document.title,window.location.pathname+window.location.search):location.hash=""}function F(a){let e=(a/100).toFixed(2).toString().toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}var V=location.hash;V&&V.length>1&&(V=V.substr(1));var X=location.search;X&&X.length>1&&(X=X.substr(1));var ke=()=>{location.search&&history.replaceState(null,null,location.pathname)};!location.search.includes("giftcode")&&!location.search.includes("publishcode")&&ke();var Ji=De("https://js.braintreegateway.com/web/3.85.2/js/client.min.js"),Zi=De("https://js.braintreegateway.com/web/3.85.2/js/paypal-checkout.min.js"),gt=T(()=>l(void 0,null,function*(){yield Promise.all([Ji,Zi]);let a=yield c($i,{}),e=window.braintree,t=yield e.client.create({authorization:a.clientid});return{braintree:e,braintreeClient:t}})),ea=T(()=>l(void 0,null,function*(){let{braintree:a,braintreeClient:e}=yield gt(),t=yield a.paypalCheckout.create({client:e});yield t.loadPayPalSDK({vault:!0,currency:"CAD",intent:"capture"});let n=window.paypal;return{paypalCheckout:t,paypal:n}})),ta=T(()=>l(void 0,null,function*(){let{braintree:a,braintreeClient:e}=yield gt();return yield a.dataCollector.create({client:e})}));function wt(a){return l(this,null,function*(){let e="823279137640415263",t=location.protocol+"//"+location.host+location.pathname;a.addClass("mod-disabled"),location.href=`https://discord.com/api/oauth2/authorize?client_id=${e}&redirect_uri=${encodeURIComponent(t)}&response_type=code&scope=identify`})}function bt(a){return l(this,null,function*(){a.addClass("mod-disabled");try{yield c(Yi,{}),new It().open()}catch(e){new Ht(e).open()}a.removeClass("mod-disabled")})}var vt=class{constructor(e){this.value=!1;(this.el=e.createEl("span","checkbox-container")).addEventListener("click",()=>this.setValue(!this.value))}setValue(e){this.value=e,this.el.toggleClass("is-enabled",this.value)}getValue(){return this.value}},U=class{constructor(){this.containerEl=createDiv("modal-container");let e=this.bgEl=this.containerEl.createDiv("modal-bg");this.modalEl=this.containerEl.createDiv("modal");let t=this.modalEl.createDiv("modal-close-button");this.titleEl=this.modalEl.createDiv("modal-title"),this.contentEl=this.modalEl.createDiv("modal-content"),this.buttonContainerEl=this.modalEl.createDiv("modal-button-container"),t.addEventListener("click",this.close.bind(this)),e.addEventListener("click",this.close.bind(this))}setTitle(e){return this.titleEl.setText(e),this}open(){document.body.appendChild(this.containerEl),this.onOpen()}close(){this.onClose(),this.containerEl.detach()}onOpen(){}onClose(){}},C=class extends U{constructor(){super();let e=this.contentEl.createDiv("message-container");this.errorEl=e.createDiv("payment-error message mod-error"),this.hideError()}showError(e){let{errorEl:t}=this;e instanceof XMLHttpRequest&&(e=e.statusText),t.setText(e.toString()),t.show()}hideError(){let{errorEl:e}=this;e.hide(),e.setText("")}},x=class extends U{constructor(){super();this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Got it"}).addEventListener("click",this.close.bind(this))}},P=class{constructor(e,t){let n=this.containerEl=e.createDiv("payment-line");this.descEl=n.createSpan({cls:"payment-desc",text:t}),n.appendText(": "),this.amountEl=n.createSpan("payment-amount"),n.appendText(" USD")}setValues(e,t,n){let{containerEl:s,amountEl:u,descEl:f}=this;s.toggle(e),u.setText(t>=0?"$"+F(t):"-$"+F(-t)),String.isString(n)&&f.setText(n)}},Tt=class{constructor(e){this.subtotal=new P(e,"Subtotal"),this.discount=new P(e,"Discount"),this.tax=new P(e,"Tax"),this.credit=new P(e,"Credit"),this.total=new P(e,"Total")}setValues(e){let{subtotal:t,desc:n,tax:s,taxDesc:u,discount:f,discountDesc:m,creditUsed:g,total:v}=e;this.discount.setValues(f!==0,-f,m),this.tax.setValues(s!==0,s,u),this.credit.setValues(g!==0,-g,"Credit"),t===v&&f===0&&s===0&&g===0?(this.subtotal.setValues(!1,0,"Subtotal"),this.total.setValues(!0,v,n)):(this.subtotal.setValues(!0,t,n),this.total.setValues(!0,v,"Total"))}},Ct=class{constructor(e){this.total=new P(e,"Your credit"),this.gift=new P(e,"Credit to gift"),this.remaining=new P(e,"Remaining credit")}setValues(e){let{total:t,gift:n,remaining:s}=e;this.total.setValues(!0,t,"Your credit"),this.gift.setValues(!0,n,"Credit to gift"),this.remaining.setValues(!0,s,"Remaining credit")}},xt=class{constructor(e){let t=this.formEl=e.createEl("form","payment-form");this.cardEl=t.createEl("label").createDiv("card-element");let n=this.payEl=t.createEl("button","submit mod-cta");this.spinnerEl=n.createDiv("spinner hidden"),this.textEl=n.createSpan({cls:"button-text",text:"Pay"}),this.stripeBadgeEl=t.createEl("p","stripe-badge u-center-text"),this.stripeBadgeEl.createEl("img",{attr:{src:"images/stripe-badge.png",alt:"Powered by Stripe"}})}setUseCredit(e){this.stripeBadgeEl.toggle(!e),this.payEl.toggleClass("mod-no-card",e),this.payEl.setText(e?"Pay with credit":"Pay")}},j=class extends C{constructor(){super();let{contentEl:e}=this;this.createPayment(e);let t=this.paymentContainerEl=e.createDiv("payment-container"),n=this.summaryEl=t.createDiv("payment-summary");this.summary=new Tt(n),this.stripeButton=new xt(t);let s=t.createEl("p","u-center-text");this.paypalButtonEl=s.createEl("span","paypal-button"),this.wechatButtonEl=s.createEl("img",{cls:"wechat-pay-button",attr:{src:"images/wechat-pay.png",alt:"Pay with Wechat Pay"}}),this.alipayButtonEl=s.createEl("img",{cls:"alipay-button",attr:{src:"images/alipay.png",alt:"Pay with Alipay"}}),this.oldPaypalButtonEl=s.createEl("img",{cls:"paypal-temp-button",attr:{src:"images/paypal-badge.svg",alt:"Pay with PayPal"}}),this.stripeButton.formEl.addEventListener("submit",this.onSubmit.bind(this)),this.wechatButtonEl.addEventListener("click",()=>this.pay("wechat")),this.alipayButtonEl.addEventListener("click",()=>this.pay("alipay")),this.oldPaypalButtonEl.addEventListener("click",()=>new Ut().open()),this.setLoading(!1)}createPayment(e){}onSubmit(e){e.preventDefault(),this.pay("card")}setPrices(e){let t=e.total===0;this.stripeButton.cardEl.toggle(!t),this.stripeButton.setUseCredit(t),this.summary.setValues(e)}onOpen(){super.onOpen(),re().mount(this.stripeButton.cardEl)}onClose(){super.onClose(),re().unmount()}updatePrice(){return l(this,null,function*(){this.hideError();try{let e=this.getPriceData(!1),t=yield c(ft,e);this.setPrices(t)}catch(e){this.showError(e)}})}pay(e){return l(this,null,function*(){this.hideError(),this.setLoading(!0);try{let t=this.getPriceData(!0),n=yield c(mt,Le({method:e},t));if(n.secret){let s;if(e==="card")s=yield Q().confirmCardPayment(n.secret,{payment_method:{card:re()}});else if(e==="wechat")s=yield Q().confirmWechatPayPayment(n.secret,{payment_method_options:{wechat_pay:{client:"web"}}});else if(e==="alipay")s=yield Q().confirmAlipayPayment(n.secret,{return_url:qi});else throw"Please select payment method.";if(s.error)throw s.error.message;yield c(Ii,{intent_id:s.paymentIntent.id})}}catch(t){this.showError(t),this.setLoading(!1);return}this.setLoading(!1),this.afterPay()})}setLoading(e){this.stripeButton.payEl.toggleClass("mod-disabled",e),this.stripeButton.spinnerEl.toggleClass("hidden",!e),this.stripeButton.textEl.toggleClass("hidden",e)}setupPaypal(e){return l(this,null,function*(){})}},Fe=class{constructor(e,t){this.value=t,this.cardEl=e.createDiv("card u-center-text",n=>{n.createDiv("card-title",s=>{s.style.textAlign="left",s.appendText(t==="yearly"?"Yearly":"Monthly"),this.promoEl=s.createSpan({cls:"flair mod-pop",text:""})}),n.createDiv("card-description",s=>{s.createDiv({},u=>{u.style.float="right",this.perMonthEl=u.createEl("b",{text:"$-"}),u.appendText(" USD / month")}),s.createDiv({},u=>{u.style.float="left",this.perYearEl=u.createEl("b",{text:"$-"}),u.appendText(" USD / year")})})}),this.promoEl.hide()}setValues(e,t){this.perMonthEl.setText("$"+e),this.perYearEl.setText("$"+e*12),this.promoEl.setText(t),this.promoEl.toggle(!!t)}},Re=class extends j{onOpen(){super.onOpen(),this.setCard(this.yearlyCard),this.setupPaypal(!0)}createPayment(e){let t=e.createDiv("card-container mod-horizontal"),n=this.yearlyCard=new Fe(t,"yearly"),s=this.monthlyCard=new Fe(t,"monthly");this.cards=[n,s],n.cardEl.addEventListener("click",()=>this.setCard(n)),s.cardEl.addEventListener("click",()=>this.setCard(s))}setCard(e){this.selectedCard&&this.selectedCard.cardEl.removeClass("is-selected"),this.selectedCard=e,e&&(e.cardEl.addClass("is-selected"),this.updatePrice())}setSubscriptionPrices(e){this.yearlyCard.setValues(e.yearly,e.yearlyPromo),this.monthlyCard.setValues(e.monthly,e.monthlyPromo)}onSubmit(e){e.preventDefault(),this.pay("card")}},Lt=class extends Re{constructor(e){super();this.setTitle("Choose a plan"),this.setSubscriptionPrices(e)}getPriceData(){return{type:"sync",variation:"",renew:this.selectedCard.value}}afterPay(){this.close(),new Ft().open()}},Dt=class extends Re{constructor(e){super();this.setTitle("Choose a plan"),this.setSubscriptionPrices(e)}createPayment(e){super.createPayment(e);let t=e.createEl("p");t.createEl("label",{cls:"input-label",text:"Number of sites"}),this.numSitesEl=t.createEl("input",{type:"number",attr:{placeholder:"Enter a number...",min:1,value:1}}),this.numSitesEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(){return{type:"publish",variation:this.numSitesEl.value,renew:this.selectedCard.value}}afterPay(){this.close(),new St().open()}},Pt=class extends j{constructor(){super();this.currentSeats=0;this.setTitle("Commercial license"),this.containerEl.addClass("mod-commercial-license")}createPayment(e){super.createPayment(e),this.businessNameContainerEl=e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Business name"}),this.businessNameEl=t.createEl("input",{type:"text",placeholder:"Name of your business..."})}),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Seats"}),this.seatsEl=t.createEl("input",{type:"number",placeholder:"1",attr:{min:1,value:1}})}),this.autoRenewalContainerEl=e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Auto-renewal"}),this.autoRenewal=new vt(t)}),this.seatsEl.addEventListener("input",this.updatePrice.bind(this))}setStatus(e,t){return this.currentSeats=e,e===0?this.setTitle("Commercial license"):this.setTitle("Add seats"),this.businessNameContainerEl.toggle(e===0),this.autoRenewalContainerEl.toggle(e===0),this.autoRenewal.setValue(t),this}getPriceData(e){let{currentSeats:t}=this;if(e&&t===0&&!this.businessNameEl.value)throw"Please enter a business name.";let n=this.seatsEl.value;if(n==="")return null;let s=parseInt(n);if(isNaN(s)||s<=0)return null;let u=this.autoRenewal.getValue()?"yearly":"";return{type:"business",variation:(t+s).toString(),renew:u}}afterPay(){return l(this,null,function*(){let e=this.businessNameEl.value;if(e)try{yield c(Hi,{company:e})}catch(t){this.showError(t);return}window.location.reload()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Ft=class extends x{constructor(){super();this.setTitle("Successfully bought Obsidian Sync"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by using Obsidian Sync!"),jsx("p",null,"To learn more about how to use the in-app plugin to sync your vaults, ",jsx("a",{href:"https://help.obsidian.md/Obsidian+Sync/Introduction+to+Obsidian+Sync",target:"_blank"},"here's a guide"),"."))}onClose(){super.onClose(),window.location.reload()}},St=class extends x{constructor(){super();this.setTitle("Successfully bought Obsidian Publish"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by using Obsidian Publish!"),jsx("p",null,"To learn more about how to publish your notes, ",jsx("a",{href:"https://help.obsidian.md/Obsidian+Publish/Introduction+to+Obsidian+Publish",target:"_blank"},"here's a guide"),"."))}onClose(){super.onClose(),window.location.reload()}},se=class{constructor(e,t,n,s,u){this.value=t,this.cardEl=e.createDiv("card",f=>{f.createDiv({cls:"card-title",text:n}),f.createDiv("card-description").appendChild(s),f.createDiv("button-container u-center-text").createEl("button","mod-cta",m=>{m.createEl("b",{text:"$"+u}),m.appendText(" USD one-time")})})}},Mt=class extends j{constructor(){super();this.currentCard=null;this.setTitle("Obsidian Catalyst"),this.containerEl.addClass("mod-personal-license"),this.paymentContainerEl.hide()}createPayment(e){e.createDiv("card-container mod-catalyst",t=>{let n=[this.insiderCard=new se(t,"insider","Insider",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,jsx("b",{className:"u-pop"},'"Insider"')," badge in the community")),25),this.supporterCard=new se(t,"supporter","Supporter",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,"Access to exclusive dev channel"),jsx("li",null,jsx("b",{className:"u-pop"},'"Supporter"')," badge in the community")),50),this.vipCard=new se(t,"vip","VIP",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,"Access to exclusive dev channel"),jsx("li",null,jsx("b",{className:"u-pop"},'"VIP"')," badge in the community")),100)];for(let s of n)s.cardEl.addEventListener("click",()=>l(this,null,function*(){this.setCard(s)}))}),this.upgradeEl=this.contentEl.appendChild(jsx("div",{className:"u-muted"},jsx("p",null,"Please select a tier to upgrade. When upgrading you only need to pay the difference."))),this.upgradeEl.hide()}onOpen(){super.onOpen(),this.setupPaypal(!1)}setCard(e){this.paymentContainerEl.show(),this.currentCard&&this.currentCard.cardEl.removeClass("is-selected"),this.currentCard=e,e&&(e.cardEl.addClass("is-selected"),this.updatePrice())}setTier(e){e==="supporter"?(this.insiderCard.cardEl.hide(),this.supporterCard.cardEl.hide()):e==="insider"&&this.insiderCard.cardEl.hide(),e&&this.upgradeEl.show()}getPriceData(){let{currentCard:e}=this;return e?{type:"catalyst",variation:e.value,renew:""}:null}afterPay(){this.close(),new At().open()}},At=class extends U{constructor(){super();this.setTitle("Successfully bought Catalyst"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by upgrading to Catalyst!"),jsx("p",null,"To get insider builds, ",jsx("a",{href:"https://help.obsidian.md/Insider+builds",target:"_blank"},"here's a guide"),"."),jsx("p",null,"To claim your community badges:")),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Get Discord badge"},e=>{e.addEventListener("click",()=>wt(e))}),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Get forum badge"},e=>{e.addEventListener("click",()=>bt(e))})}onClose(){super.onClose(),window.location.reload()}},kt=class extends U{constructor(){super();this.contentEl.createDiv("message-container").createDiv({cls:"message mod-success",text:"Successfully added badge for you!"}),this.setTitle("Added Discord badge"),this.contentEl.append(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent so we can pursue our vision."))}},Rt=class extends C{constructor(e){super();this.setTitle("Couldn't add Discord badge"),this.contentEl.append(jsx("p",null,"Please contact us for support or try again later. We're really sorry for the inconvenience!")),this.showError(e)}},It=class extends U{constructor(){super();this.contentEl.createDiv("message-container").createDiv({cls:"message mod-success",text:"Successfully added badge for you!"}),this.setTitle("Added forum badge"),this.contentEl.append(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent so we can pursue our vision."),jsx("p",null,'P.S. Your forum badge is not a "badge" in the forum system, but a shiny gold tag right next to your name in all of your posts. Hope that helps!'))}},Ht=class extends C{constructor(e){super();this.setTitle("Couldn't add forum badge"),this.contentEl.append(jsx("p",null,"Please contact us for support or try again later. We're really sorry for the inconvenience!")),this.showError(e)}},Ot=class extends j{constructor(){super();this.setTitle("Obsidian Unlimited"),this.summaryEl.hide()}createPayment(e){e.appendChild(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent, so we can pursue our vision.")),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Amount (USD)"}),this.donationEl=t.createEl("input",{type:"number",placeholder:"Pay what you want...",attr:{min:5,value:50,step:1}})}),this.donationEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(e){let t=this.donationEl.value;if(t==="")return null;let n=parseInt(t);return isNaN(n)||n<=0?null:{type:"donation",variation:(n*100).toString(),renew:""}}afterPay(){return l(this,null,function*(){window.location.reload()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Bt=class extends j{constructor(){super();this.setTitle("Obsidian Credit"),this.summaryEl.hide()}createPayment(e){e.appendChild(jsx("p",null,"Obsidian Credit can be used to buy all kinds of Obsidian licenses and services (Sync and Publish).")),e.appendChild(jsx("p",null,"You can also send your credit to friends and family as a gift.")),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Amount (USD)"}),this.amountEl=t.createEl("input",{type:"number",placeholder:"Credit amount",attr:{min:5,value:50,step:1}})}),this.amountEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(e){let t=this.amountEl.value;if(t==="")return null;let n=parseInt(t);return isNaN(n)||n<=0?null:{type:"credit",variation:(n*100).toString(),renew:""}}afterPay(){return l(this,null,function*(){new Nt().open()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Nt=class extends x{constructor(){super();this.setTitle("Successfully bought Obsidian Credit"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by buying Obsidian Credit!"),jsx("p",null,"You can now purchase Obsidian Sync, Obsidian Publish, or any license with your credit. You can also gift it to others. "))}onClose(){super.onClose(),window.location.reload()}},_t=class extends C{constructor(){super();this.setTitle("Gift Obsidian Credit"),this.contentEl.appendChild(jsx("p",null,"Gift Obsidian Credit to friends and family so they can buy all things Obsidian!")),this.contentEl.appendChild(jsx("p",null,"It applies to Obsidian Sync, Obsidian Publish, commercial licenses, and Catalyst licenses.")),this.contentEl.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Gift amount (USD)"}),this.giftAmountEl=t.createEl("input",{type:"number",placeholder:"Gift amount",attr:{min:1,max:Math.floor(W/100),value:5,step:1}})}),this.giftOptionsEl=this.contentEl.createDiv(),this.updateGiftOptions(!0),this.giftAmountEl.addEventListener("change",this.updateSummary.bind(this));let e=this.summaryEl=this.contentEl.createDiv("payment-summary");this.contentEl.createDiv("button-container u-center-text",t=>{t.createEl("button",{cls:"mod-cta",text:"Send gift"},n=>{n.onClickEvent(()=>l(this,null,function*(){this.hideError();let s=this.recipientEl.value,u=this.getGiftAmount(),f=this.emailOptionEl.checked;if(f){if(!s){this.showError("Please enter email of the recipient so we can send the gift for you!");return}if(!s.contains("@")){this.showError("Please enter valid recipient email.");return}}if(isNaN(u)){this.showError("Please enter a valid gift amount.");return}if(u<500){this.showError("You need to gift at least $5.");return}if(u>W){this.showError("You cannot gift more credit than you currently have.");return}try{let m=yield c(Xi,{should_email:this.emailOptionEl.checked,recipient:s,amount:u});f?window.location.reload():(this.close(),new Ie(m.redeem_code,u,s).open())}catch(m){this.showError(m)}}))}),t.createEl("button",{text:"Cancel"}).addEventListener("click",this.close.bind(this))}),this.summary=new Ct(e)}getGiftAmount(){return parseInt(this.giftAmountEl.value)*100}updateGiftOptions(e){this.giftOptionsEl.empty(),this.giftOptionsEl.append(jsx(jsxFragment,null,jsx("p",null,jsx("label",null,jsx("span",{className:"input-label"},"Method"),jsx("label",null,this.codeOptionEl=jsx("input",{type:"radio",name:"gift-method",value:"code",checked:e}),"Get redeem link"),"\xA0\xA0",jsx("label",null,this.emailOptionEl=jsx("input",{type:"radio",name:"gift-method",value:"email",checked:!e}),"Send anonymously through email"))),jsx("p",{class:"u-muted"},jsx("span",{className:"input-label"}),e?"You'll get a link to redeem the gift. Choose this if you want to send a personalized gift yourself.":"We'll send an email on your behalf. Choose this if you want to stay anonymous or want it to be a surprise."),e?jsx(jsxFragment,null,jsx("p",null,jsx("label",{className:"input-label"},"Recipient name"),this.recipientEl=jsx("input",{type:"email",placeholder:"Recipient name..."})),jsx("p",{class:"u-muted"},jsx("label",{className:"input-label"}),"For your reference only. The recipient will not see this.")):jsx(jsxFragment,null,jsx("p",null,jsx("label",{className:"input-label"},"Recipient email"),this.recipientEl=jsx("input",{type:"email",placeholder:"Recipient email..."})),jsx("p",{className:"u-muted"},jsx("label",{className:"input-label"}),"We'll send an email to this address. Please double check the email address.")))),this.codeOptionEl.addEventListener("change",()=>{let t=this.codeOptionEl.checked;this.updateGiftOptions(t)}),this.emailOptionEl.addEventListener("change",()=>{let t=this.codeOptionEl.checked;this.updateGiftOptions(t)})}updateSummary(){let e=this.getGiftAmount(),t=W-e;if(this.hideError(),isNaN(e)){this.showError("Please enter a valid gift amount.");return}if(e<500){this.showError("You need to gift at least $5 worth of Obsidian Credit.");return}if(t<0){this.showError("You cannot gift more credit than you currently have.");return}this.summary.setValues({total:W,gift:e,remaining:t})}onOpen(){super.onOpen(),this.updateSummary()}},Ut=class extends U{constructor(){super();this.setTitle("Pay with PayPal"),this.contentEl.appendChild(jsx(jsxFragment,null,jsx("p",null,"Paying with PayPal is currently a manual process, and we're working on automating it. Please do the following in order to get your payment processed:"),jsx("ol",{className:"u-pop"},jsx("li",null,jsx("span",{class:"mod-warning"},"Verify you're not paying a monthly fee.")," Because it's a manual process, we only accept yearly payments for Sync and Publish. Monthly payments will be refunded."),jsx("li",null,"Forward your PayPal receipt to ",jsx("a",{href:"mailto:support@obsidian.md"},"support@obsidian.md")," and specify what service you're purchasing.")),jsx("p",null,"Your payment should be processed within 3 business days."),jsx("p",null,"Thanks so much for your kind support! Obsidian couldn't have become what it is today without help from amazing people like you. Sorry for the trouble!"),jsx("p",{className:"u-center-text"},jsx("a",{href:"https://paypal.me/obsidianmd",target:"_blank"},jsx("img",{style:"width: 200px; background-color: #FFC439;border-radius: 24px;padding: 8px 40px;",src:"images/paypal-badge.png",alt:"Pay with PayPal"})))))}},Yt=class extends C{constructor(){super();this.setTitle("Apply for discount"),this.contentEl.append(jsx("p",null,"Please choose discount type you're applying for and enter your school or organization email. We will send an email to this email address to verify it."),jsx("p",{class:"u-muted u-small"},"Please note that if you already have early bird, discounts will not stack with early bird."),jsx("p",{class:"u-muted u-small"},"If you do not have an organization email, please contact us at ",jsx("a",{href:"mailto:support@obsidian.md"},"support@obsidian.md")," to provide other forms of verification, such as student ID card, transcript, or employee ID card."),jsx("p",null,jsx("label",null,jsx("span",{class:"input-label"},"Discount type"),jsx("label",null,jsx("input",{type:"radio",name:"apply-discount-type",value:"1",checked:!0}),"Education (student or faculty)"),"\xA0\xA0",jsx("label",null,jsx("input",{type:"radio",name:"apply-discount-type",value:"2"}),"Non-profit organization"))),jsx("p",null,jsx("label",null,jsx("span",{class:"input-label"},"School or organization email"),this.emailEl=jsx("input",{type:"email",placeholder:"Your email..."})))),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Send application"}).addEventListener("click",()=>l(this,null,function*(){this.hideError();let e=this.contentEl.find('input[name="apply-discount-type"]:checked').value,t=this.emailEl.value;if(!e){this.showError("Please select a discount type.");return}if(t===""||!t.contains("@")){this.showError("Please enter a valid organization email address.");return}try{yield c(Vi,{type:e,email:t}),this.close(),new jt().open()}catch(n){this.showError(n)}})),this.buttonContainerEl.createEl("button",{text:"Cancel"}).addEventListener("click",this.close.bind(this))}},jt=class extends x{constructor(){super();this.setTitle("Verify your email"),this.contentEl.append(jsx("p",null,"Thanks for applying for Obsidian discount!"),jsx("p",null,"We've sent an email to your organization email address to verify your email. Once you click on the link, the application will be submitted for review."),jsx("p",null,"If you don't see the email in a few minutes, please try checking your spam folder. You can try applying for a discount again."))}},Gt=class extends x{constructor(){super();this.setTitle("Organization email verified"),this.contentEl.append(jsx("p",null,"Thanks for verifying your organization email! We'll take a look at your application as soon as we can."),jsx("p",null,"You'll get an email update when your discount application is approved. Have a nice day!"))}},$t=class extends x{constructor(e){super();this.setTitle("Your discount is active"),this.contentEl.append(jsx("p",null,"Your ",jsx("span",{class:"approved-discount-type"},e)," discount is approved!"),jsx("p",null,"You'll see the discount applied when you try to buy Obsidian Sync or Obsidian Publish. It's not applicable to Catalyst licenses, commercial licenses, or donations."))}},Se=class extends C{constructor(e,t){super();this.setTitle("Redeem your gift"),t?(this.contentEl.append(jsx("p",null,"Unfortunately, we were unable to fetch your gift.")),this.showError(t)):(this.contentEl.append(jsx("p",null,"Someone has sent you a gift worth of $",F(e)," Obsidian Credit. How exciting!")),this.buttonContainerEl.append(jsx(jsxFragment,null,jsx("button",{className:"mod-cta",onclick:this.redeemGift.bind(this)},"Redeem"),jsx("button",{onclick:this.close.bind(this)},"Cancel"))))}redeemGift(){return l(this,null,function*(){try{yield c(Ae,{code:z}),new He().open()}catch(e){new oe(e).open()}})}},qt=class extends C{constructor(){super();this.setTitle("Redeem your gift"),this.contentEl.append(jsx("p",null,"Please enter your redeem code below:")),this.contentEl.append(jsx("p",null,this.codeField=jsx("input",{type:"text",placeholder:"Gift redeem code...",style:"width: 100%;"}))),this.buttonContainerEl.append(jsx(jsxFragment,null,jsx("button",{className:"mod-cta",onclick:this.redeemGift.bind(this)},"Redeem"),jsx("button",{onclick:this.close.bind(this)},"Cancel")))}redeemGift(){return l(this,null,function*(){try{let e=this.codeField.value;if(e===""){this.showError("Please enter a redeem code.");return}yield c(Ae,{code:e}),new He().open()}catch(e){new oe(e).open()}})}},Ie=class extends x{constructor(e,t,n){super();this.link=`${location.origin}/account?giftcode=${e}`,n?this.setTitle("Successfully sent gift"):this.setTitle("Copied redeem link"),this.contentEl.append(jsx(jsxFragment,null,n?jsx("p",null,"You just sent a gift of ",F(t),' to "',n,'"!'):"",jsx("p",null,"The link to redeem the gift has been copied to your clipboard."),jsx("p",null,this.linkField=jsx("input",{type:"text",value:this.link,style:"width: 100%;"}))))}onOpen(){super.onOpen(),ie(this.link),this.linkField.select()}},Vt=class extends x{constructor(e,t,n){super();this.code=e,n?this.setTitle("Successfully sent gift"):this.setTitle("Copied redeem code"),this.contentEl.append(jsx(jsxFragment,null,n?jsx("p",null,"You just sent a gift of ",F(t),' to "',n,'"!'):"",jsx("p",null,"The gift redeem code has been copied to your clipboard."),jsx("p",null,this.codeField=jsx("input",{type:"text",value:e,style:"width: 100%;"}))))}onOpen(){super.onOpen(),ie(this.code),this.codeField.select()}},He=class extends x{constructor(){super();this.setTitle("Gift redeemed"),this.contentEl.append(jsx("p",null,"Your gift was successfully redeemed!"),jsx("p",null,'You should be able to see the credit in the "Obsidian Credit" section. You can use it to buy whatever you want, or even gift to others.'))}onClose(){super.onClose(),ke(),location.reload()}},oe=class extends C{constructor(e){super();this.setTitle("Gift not redeemed"),this.contentEl.append(jsx("p",null,"Unfortunately, we were unable to redeem your gift for you.")),this.showError(e)}},Me=class extends C{constructor(e,t,n){super();this.setTitle("Publish site invite"),n?(this.contentEl.append(jsx("p",null,"Unfortunately, we were unable to fetch your invite.")),this.showError(n)):(this.contentEl.append(jsx("p",null,e," (",t,") has invited you to collaborate on an Obsidian Publish site together.")),this.buttonContainerEl.append(jsx(jsxFragment,null,jsx("button",{className:"mod-cta",onclick:this.acceptInvite.bind(this)},"Accept"),jsx("button",{onclick:this.close.bind(this)},"Cancel"))))}acceptInvite(){return l(this,null,function*(){try{yield c(Qi,{code:K}),this.close(),new Xt().open()}catch(e){let t=new C;t.setTitle("Couldn't accept invite"),t.contentEl.append(jsx("p",null,"Unfortunately, something went wrong when accepting the invite.")),t.showError(e),this.close(),t.open()}})}},Xt=class extends x{constructor(){super();this.setTitle("Accepted invite"),this.contentEl.append(jsx("p",null,"You have successfully accepted the invite!"),jsx("p",null,"You can now go into the Obsidian app, log in under Settings ","->",' Account, and enable the "Publish" core plugin to start collaborating on this site.'))}onClose(){super.onClose(),ke(),location.reload()}},Q=T(()=>window.Stripe(Et)),re=T(()=>Q().elements().create("card",{style:{base:{color:"#dcddde",iconColor:"#dcddde",fontFamily:"Inter, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#888888"}},invalid:{fontFamily:"Inter, sans-serif",color:"#fa755a",iconColor:"#fa755a"}}})),na="",W=0,z=null,K=null;ready(()=>{let a=fish(".login-form"),e=fish(".login-form .message.mod-error"),t=fish(".signup-form"),n=fish(".signup-form .message.mod-error"),s=fish(".welcome"),u=fish("#labeled-input-email"),f=fish("#labeled-input-password"),m=fish(".signup-name"),g=fish(".obsidian-signup-email"),v=fish(".signup-password"),R=fish(".welcome-name"),le=fish(".welcome-email"),Wt=fish(".js-change-email"),zt=fish(".modal-container.mod-change-email"),Kt=fish(".change-email-new-email"),Qt=fish(".change-email-password"),Jt=fish(".js-confirm-change-email"),I=fish(".modal-container.mod-change-email .message.mod-error"),Zt=fish(".js-change-name"),en=fish(".modal-container.mod-change-name"),tn=fish(".change-name-new-name"),nn=fish(".js-confirm-change-name"),G=fish(".modal-container.mod-change-name .message.mod-error"),an=fish(".js-change-password"),sn=fish(".modal-container.mod-change-password"),rn=fish(".change-password-old-password"),on=fish(".change-password-new-password"),ln=fish(".js-confirm-change-password"),H=fish(".modal-container.mod-change-password .message.mod-error"),cn=fish(".js-delete-account"),un=fish(".modal-container.mod-delete-account"),dn=fish(".delete-account-password"),hn=fish(".delete-account-email"),pn=fish(".js-confirm-delete-account"),O=fish(".modal-container.mod-delete-account .message.mod-error"),$=fish(".modal-container.mod-change-info-success"),mn=fish(".js-logout"),Oe=fish(".card.mod-publish"),Be=fish(".card.mod-sync"),Ne=fish(".publish-site-num"),_e=fish(".publish-renew-site-num"),fn=fishAll(".publish-renewal-time"),yn=fish(".publish-renew-info-renewing"),Ue=fish(".publish-renew-info-not-renewing"),En=fishAll(".js-view-payment-info"),gn=fishAll(".js-open-change-payment"),Ye=fish(".current-card-info"),je=fish(".modal-container.mod-change-payment-method"),wn=fish(".modal-container.mod-change-payment-method .payment-form"),bn=fish(".js-change-number-of-publish-sites"),ce=fish(".js-reduce-number-of-publish-sites"),Ge=fish(".js-change-publish-to-monthly"),$e=fish(".js-change-publish-to-yearly"),qe=fish(".setting-item-description.mod-publish-frequency"),Ve=fish(".publish-reduce-sites-num"),vn=fish(".js-update-reduce-sites"),Xe=fish(".js-stop-publish-auto-renewal"),Tn=fish(".commercial-license-pitch"),Cn=fish(".existing-commercial-license"),L=fish(".commercial-license-key"),xn=fish(".commercial-license-company-name"),Ln=fishAll(".commercial-license-seat-number"),We=fish(".card.mod-commercial-license"),Dn=fish(".catalyst-tier"),ze=fish(".catalyst-upgrade-button"),Pn=fishAll(".js-close-modal, .modal-close-button, .modal-bg"),Ke=fish(".card.mod-catalyst"),w=fish(".loader-cube"),Fn=fish(".js-go-to-signup"),Sn=fish(".js-go-to-login"),Mn=fish(".js-go-to-forgot-pass"),Qe=fish(".forgot-pass-form"),ue=fish(".forgot-pass-form .message.mod-success"),B=fish(".forgot-pass-form .message.mod-error"),An=fish(".forgot-pass-email"),Je=fish(".reset-pass-form"),kn=fish(".forgot-pass-email-container"),Rn=fish(".reset-pass-password"),de=fish(".reset-pass-form .message.mod-success"),q=fish(".reset-pass-form .message.mod-error"),In=fish(".js-request-forgot"),he=null,Hn=fish(".js-upgrade-publish"),On=fish(".modal-container.mod-publish-reduce-sites"),Bn=fish(".modal-container.mod-view-payment-method"),Nn=fish(".js-open-unlimited"),_n=fish(".obsidian-credit-amount"),Un=fish(".donation-amount"),Yn=fishAll(".modal-container"),jn=fish(".js-upgrade-sync"),pe=fish(".js-change-sync-to-monthly"),me=fish(".js-change-sync-to-yearly"),fe=fish(".js-stop-sync-auto-renewal"),Gn=fishAll(".sync-renewal-time"),Ze=fish(".sync-renew-info-renewing"),ye=fish(".sync-renew-info-not-renewing"),et=fish(".setting-item-description.mod-sync-frequency"),$n=fishAll(".commercial-renewal-time"),Ee=fish(".js-resume-commercial-auto-renewal"),J=fish(".js-stop-commercial-auto-renewal"),ge=fish(".commercial-renew-info-renewing"),Z=fish(".commercial-renew-info-not-renewing"),qn=fishAll(".commercial-license-expiry-date"),Vn=fishAll(".checkbox-container"),Xn=fishAll(".claim-discord-badge-button"),Wn=fishAll(".claim-forum-badge-button"),zn=fish(".js-commercial-license-change-seat"),Kn=fish(".js-commercial-license-reduce-seat"),Qn=fish(".modal-container.mod-commercial-license-reduce-seats"),Jn=fish(".commercial-license-reduce-seat-input"),Zn=fish(".js-update-reduce-seats"),N=fish(".modal-container.mod-commercial-license-reduce-seats .payment-error"),we={monthly:10,yearly:8,yearlyPromo:"20% off compared to monthly"},be={monthly:20,yearly:16,yearlyPromo:"20% off compared to monthly"},ve=T(()=>new Mt),ei=T(()=>new Lt(we)),tt=T(()=>new Dt(be)),nt=T(()=>new Pt),ti=T(()=>new Ot),ni=T(()=>new Bt),ee="",te=!1,it=null,at=null,S=!1,M=null,ii=Q(),Te=re(),_=null,Y=()=>{if(S){window.location.reload();return}Te.unmount(),Yn.forEach(i=>i.hide()),S=!1},b=A.decodeUrlQuery(V);if(b.mode&&b.mode==="signup")Pe(),w.hide(),t.show(),te=!0;else if(b.mode&&b.mode==="forgotpass")Pe(),w.hide(),Qe.show(),te=!0;else if(b.hasOwnProperty("forgetpw")&&b.id&&b.key)Pe(),it=b.id,at=b.key,w.hide(),Je.show(),te=!0;else if(b.stripe&&b.stripe==="complete"){let i=b.session}else b.discount&&(b.discount==="verified"?new Gt().open():b.discount==="approved"&&b.type&&new $t(b.type).open());_=A.decodeUrlQuery(X),_.code?l(void 0,null,function*(){try{yield c(Ui,{code:_.code}),new kt().open()}catch(i){new Rt(i).open()}}):_.giftcode?z=_.giftcode:_.publishcode&&(K=_.publishcode);let ai=i=>l(void 0,null,function*(){try{let r=yield c(zi,{code:i});new Se(r.amount,null).open()}catch(r){new Se(0,r).open()}}),si=i=>l(void 0,null,function*(){try{let r=yield c(Ki,{code:i});new Me(r.name,r.email,null).open()}catch(r){new Me("","",r).open()}}),ri=()=>l(void 0,null,function*(){let i;try{i=yield c(Ci,{})}catch(r){te||(w.hide(),a.show(),z&&(e.setText("Please log in or sign up to redeem your gift."),e.show()),K&&(e.setText("Please log in or sign up to accept the invite."),e.show()));return}if(na=i.name,R.setText(i.name),le.setText(i.email),i.donation&&Un.setText(F(i.donation)),t.hide(),w.hide(),s.show(),i.license&&(ee=i.license),ee?(Ke.addClass("is-active"),Dn.setText(i.license),ve().setTier(ee),ee==="vip"?fish(".card-container.mod-unlimited").show():(ze.addEventListener("click",()=>{ve().open()}),ze.show())):Ke.addEventListener("click",()=>{ve().open()}),W=i.credit,fish(".js-gift-credit").toggle(i.credit!==0),_n.setText(F(i.credit)),i.discount){let{status:r,type:d,expiry_ts:o}=i.discount,p=fish(".setting-item.mod-discount .setting-item-description"),y=fish(".setting-item.mod-discount .setting-item-control a");r==="submitted"?(p.setText("You have submitted your school or organization email, but have not completed email verification yet. Please check your email for a link to verify your email address."),y.hide()):r==="verified"?(p.setText("Your discount application has been submitted for review. Thanks for your patience!"),y.hide()):r==="approved"&&(p.setText(`Your ${d} discount currently gives you 40% off the regular price of Obsidian Sync and Publish. Your discount will expire on ${new Date(o).toLocaleDateString()}.`),y.setText("Renew"))}z?ai(z):K&&si(K)}),oi=()=>l(void 0,null,function*(){let i=yield c(Ri,{});if(i.business&&i.business.expiry>=Date.now()){M=i.business,L.setText(M.key),xn.setText(M.company);let r=M.seats,d=r===1?"1 seat":r+" seats";Ln.forEach(o=>o.setText(d)),qn.forEach(o=>o.setText(new Date(M.expiry).toLocaleDateString())),Tn.hide(),Cn.show()}else We.addEventListener("click",()=>nt().setStatus(0,!0).open());if(i.publish){let{sites:r,renew:d,renew_sites:o,expiry_ts:p,earlybird:y}=i.publish;if(p>=Date.now()){if(Oe.addClass("is-active"),r===1?Ne.setText("1 site"):Ne.setText(`${r} sites`),o===1?(_e.setText("1 site"),ce.hide()):(_e.setText(`${o} sites`),ce.show()),p){let D=new Date(p);fn.forEach(ne=>ne.setText(`on ${D.toLocaleDateString()}`))}Ue.hide();let E=document.createDocumentFragment();d==="yearly"?($e.hide(),E.createSpan({text:"You're currently on a "}),E.createSpan({cls:"u-pop",text:"yearly"}),E.createSpan({text:" plan."})):d==="monthly"?(Ge.hide(),E.createSpan({text:"You're currently on a "}),E.createSpan({cls:"u-pop",text:"monthly"}),E.createSpan({text:" plan."})):d===""&&(Xe.hide(),Ue.show(),yn.hide(),E.createSpan({text:"You're not currently being renewed."})),qe.empty(),qe.appendChild(E),Ve.value=r}y===!0&&(be.yearly/=2,be.monthly/=2,Oe.addClass("is-early-bird"))}if(i.sync){let{renew:r,expiry_ts:d,earlybird:o}=i.sync;if(d>=Date.now()){if(Be.addClass("is-active"),d){let y=new Date(d);Gn.forEach(E=>E.setText(`on ${y.toLocaleDateString()}`))}ye.hide(),r==="yearly"||(r==="monthly"?pe.hide():r===""&&(fe.hide(),ye.show(),Ze.hide()));let p=document.createDocumentFragment();r==="yearly"?(me.hide(),p.createSpan({text:"You're currently on a "}),p.createSpan({cls:"u-pop",text:"yearly"}),p.createSpan({text:" plan."})):r==="monthly"?(pe.hide(),p.createSpan({text:"You're currently on a "}),p.createSpan({cls:"u-pop",text:"monthly"}),p.createSpan({text:" plan."})):r===""&&(fe.hide(),ye.show(),Ze.hide(),p.createSpan({text:"You're not currently being renewed."})),et.empty(),et.appendChild(p)}o===!0&&(we.yearly/=2,we.monthly/=2,Be.addClass("is-early-bird"))}if(i.business){let{renew:r,expiry:d}=i.business;if(d>=Date.now()){if(We.addClass("is-active"),d){let o=new Date(d);$n.forEach(p=>p.setText(`on ${o.toLocaleDateString()}`))}Z.hide(),r==="yearly"?(Ee.hide(),J.show(),Z.hide(),ge.show()):r===""&&(Ee.show(),J.hide(),Z.show(),ge.hide()),r==="yearly"?me.hide():r===""&&(J.hide(),Z.show(),ge.hide())}}}),li=()=>l(void 0,null,function*(){let i=yield c(Wi,{}),r=fish(".setting-item.mod-gift-history"),d=r.find(".setting-item-description");if(!(!i||i.length===0)){d.empty(),i.sort((o,p)=>o.ts-p.ts);for(let o of i){if(o.type==="sent"){let p=`You sent $${F(o.amount)} to "${o.recipient}" on ${new Date(o.ts).toLocaleDateString()}. `;d.createEl("p",{text:p},y=>{if(o.redeemed||(y.createEl("a",{cls:"landing-link",text:"Copy redeem link",href:"#"},E=>E.addEventListener("click",D=>l(void 0,null,function*(){D.preventDefault(),new Ie(o.redeem_code).open()}))),y.createEl("span",{text:" or "}),y.createEl("a",{cls:"landing-link",text:"copy redeem code",href:"#"},E=>E.addEventListener("click",D=>l(void 0,null,function*(){D.preventDefault(),new Vt(o.redeem_code).open()})))),y.createEl("br"),o.redeemed){let E=o.is_cancelled?"cancelled":"redeemed";y.createEl("span",{text:`Your gift was ${E} on ${new Date(o.redeemed_ts).toLocaleDateString()}.`})}else y.createEl("span",{text:"Waiting for recipient to redeem gift. "}),y.createEl("span",{text:" "}),y.createEl("a",{cls:"landing-link",text:"Cancel this gift",href:"#"},E=>E.addEventListener("click",D=>l(void 0,null,function*(){if(D.preventDefault(),!!confirm("Are you sure you want to cancel this gift? Your credits will be refunded, and the recipient will no longer be able to redeem it."))try{yield c(Ae,{code:o.redeem_code}),location.reload()}catch(xe){new oe(xe).open()}})))})}else if(o.type==="received"){let p=`You redeemed $${F(o.amount)} worth of gift credit on ${new Date(o.ts).toLocaleDateString()}. `;d.createEl("p",{text:p})}r.show()}}}),ci=()=>l(void 0,null,function*(){e.hide(),a.hide(),w.show();let i=u.value,r=f.value,d=!1;if(i===""?(e.setText("Email cannot be empty."),d=!0):i.indexOf("@")===-1?(e.setText("Email is not valid."),d=!0):r===""&&(e.setText("Password cannot be empty."),d=!0),d){a.show(),w.hide(),e.show();return}try{yield c(xi,{email:u.value,password:f.value}),window.location.reload()}catch(o){a.show(),w.hide(),o==="Login failed"&&(e.setText("Login failed, please double check your email and password."),e.show())}}),ui=()=>l(void 0,null,function*(){n.hide(),t.hide(),w.show();let i=m.value,r=g.value,d=v.value,o=!1;if(i===""?(n.setText("Name cannot be empty."),o=!0):r===""?(n.setText("Email cannot be empty."),o=!0):r.indexOf("@")===-1?(n.setText("Email is not valid."),o=!0):d===""&&(n.setText("Password cannot be empty."),o=!0),o){n.show(),t.show(),w.hide();return}try{yield c(Li,{name:i,email:r,password:d}),window.location.reload()}catch(p){t.show(),w.hide(),p==="Invalid email address"?n.setText("The email address you entered was invalid."):p==="Already signed up"&&n.setText("Seems like you already have an account! Please log in."),n.show()}}),di=()=>l(void 0,null,function*(){B.hide(),ue.hide();let i=An.value;if(i){if(i.indexOf("@")===-1){B.setText('Email address is not valid and must contain "@".'),B.show();return}}else{B.setText("Please fill out your email."),B.show();return}w.show();try{yield c(Pi,{email:i,captcha:"captcha"}),ue.setText(`We have sent an email to ${i} to reset your password.`),ue.show(),kn.hide(),In.hide(),w.hide()}catch(r){B.setText("Something went wrong, please try again."),B.show(),w.hide()}}),hi=()=>l(void 0,null,function*(){de.hide(),q.hide();let i=Rn.value;if(!i){q.setText("Please set a new password."),q.show();return}try{yield c(Fi,{password:i,id:it,key:at}),de.innerHTML='Your password has been successfully set. <a href="/account">Log in</a>',de.show()}catch(r){q.setText("Something went wrong, please try again."),q.show()}}),pi=()=>l(void 0,null,function*(){yield c(Di,{}),window.location.reload()});ri(),oi(),li(),mn.addEventListener("click",()=>{pi()});let Ce=()=>{let i=L.getText();ie(i),L.setText("Copied!"),L.addClass("is-copied"),L.removeEventListener("click",Ce),setTimeout(()=>{L.removeClass("is-copied"),L.setText(i),L.addEventListener("click",Ce)},500)};L.addEventListener("click",Ce),Pn.forEach(i=>{i.addEventListener("click",Y)}),Fn.addEventListener("click",()=>{location.hash="#mode=signup",location.reload()}),Sn.addEventListener("click",()=>{location.hash="",location.reload()}),Mn.addEventListener("click",()=>{location.hash="#mode=forgotpass",location.reload()}),a.find("form").addEventListener("submit",i=>{i.preventDefault(),ci()}),t.find("form").addEventListener("submit",i=>{i.preventDefault(),ui()}),Qe.find("form").addEventListener("submit",i=>{i.preventDefault(),di()}),Je.find("form").addEventListener("submit",i=>{i.preventDefault(),hi()}),Hn.addEventListener("click",()=>tt().open()),Ge.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to change your Obsidian Publish subscription to monthly?")&&(yield c(k,{type:"publish",renew:"monthly"}),window.location.reload())})),$e.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to change your Obsidian Publish subscription to yearly?")&&(yield c(k,{type:"publish",renew:"yearly"}),window.location.reload())})),Xe.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to stop your Obsidian Publish subscription?")&&(yield c(k,{type:"publish",renew:""}),window.location.reload())})),bn.addEventListener("click",()=>tt().open()),ce.addEventListener("click",()=>{On.show()}),vn.addEventListener("click",()=>l(void 0,null,function*(){let i=parseInt(Ve.value);yield c(Bi,{sites:i}),window.location.reload()})),En.forEach(i=>i.addEventListener("click",()=>l(void 0,null,function*(){let r=yield c(Ni,{});r.info?Ye.setText(`You're currently using a ${r.info}.`):Ye.setText("You currently do not have any payment methods on file."),Bn.show()}))),gn.forEach(i=>i.addEventListener("click",()=>{je.show(),he=je.find(".payment-error"),Te.mount(".modal-container.mod-change-payment-method .card-element")})),wn.addEventListener("submit",i=>{i.preventDefault(),ii.createPaymentMethod({type:"card",card:Te}).then(r=>l(void 0,null,function*(){r.paymentMethod&&r.paymentMethod.id?(yield c(_i,{payment_method_id:r.paymentMethod.id}),window.location.reload()):(he.setText("Could not update your payment method."),he.show())}))}),Nn.addEventListener("click",()=>{ti().open()}),fish(".js-add-credit").onClickEvent(()=>{ni().open()}),fish(".js-gift-credit").onClickEvent(()=>{new _t().open()}),fish(".js-redeem-gift").onClickEvent(()=>{new qt().open()}),jn.addEventListener("click",()=>ei().open()),pe.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to change your Obsidian Sync subscription to monthly?")&&(yield c(k,{type:"sync",renew:"monthly"}),window.location.reload())})),me.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to change your Obsidian Sync subscription to yearly?")&&(yield c(k,{type:"sync",renew:"yearly"}),window.location.reload())})),fe.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to stop your Obsidian Sync subscription?")&&(yield c(k,{type:"sync",renew:""}),window.location.reload())})),J.addEventListener("click",()=>l(void 0,null,function*(){yield c(k,{type:"business",renew:""}),window.location.reload()})),Ee.addEventListener("click",()=>l(void 0,null,function*(){yield c(k,{type:"business",renew:"yearly"}),window.location.reload()})),Vn.forEach(i=>{i.addEventListener("click",()=>{i.hasClass("is-enabled")?i.removeClass("is-enabled"):i.addClass("is-enabled")})}),Xn.forEach(i=>i.addEventListener("click",()=>wt(i))),Wn.forEach(i=>i.addEventListener("click",()=>bt(i))),Wt.addEventListener("click",()=>{zt.show()}),Jt.addEventListener("click",()=>l(void 0,null,function*(){I.hide();let i=Kt.value,r=Qt.value;if(i===""){I.setText("New email cannot be empty."),I.show();return}if(r===""){I.setText("Password cannot be empty."),I.show();return}try{yield c(Mi,{password:r,email:i}),Y(),S=!0,$.show()}catch(d){I.setText(d),I.show()}})),Zt.addEventListener("click",()=>{en.show()}),nn.addEventListener("click",()=>l(void 0,null,function*(){G.hide();let i=tn.value;if(i===""){G.setText("New name cannot be empty."),G.show();return}try{yield c(Si,{name:i}),Y(),S=!0,$.show()}catch(r){G.setText(r),G.show()}})),an.addEventListener("click",()=>{sn.show()}),ln.addEventListener("click",()=>l(void 0,null,function*(){H.hide();let i=rn.value,r=on.value;if(i===""){H.setText("Current password cannot be empty."),H.show();return}if(i===""){H.setText("New password cannot be empty."),H.show();return}try{yield c(Ai,{old_password:i,new_password:r}),Y(),S=!0,$.show()}catch(d){H.setText(d),H.show()}})),cn.addEventListener("click",()=>{un.show()}),pn.addEventListener("click",()=>l(void 0,null,function*(){O.hide();let i=hn.value,r=dn.value;if(i===""){O.setText("Please enter your email to confirm account deletion."),O.show();return}if(r===""){O.setText("Please enter your password to confirm account deletion."),O.show();return}try{yield c(ki,{email:i,password:r}),Y(),S=!0,$.show()}catch(d){O.setText(d),O.show()}})),zn.addEventListener("click",()=>{nt().setStatus(M.seats,!!M.renew).open()}),Kn.addEventListener("click",()=>{Qn.show()}),Zn.addEventListener("click",()=>l(void 0,null,function*(){N.hide();let i=Jn.valueAsNumber,r=M.seats;if(i===0){N.setText("The number of seats to remove cannot be 0."),N.show();return}let d=r-i;if(d<0){let o=r===1?"1 seat":r+" seats";N.setText("You currently have "+o+" and cannot remove more seats than that."),N.show();return}try{yield c(Oi,{seats:d}),Y(),S=!0,$.show()}catch(o){N.setText(o),N.show()}}));let st="",rt="stripe",ot=fish(".modal-container.mod-invoice-list");fishAll(".js-view-invoices").forEach(i=>i.addEventListener("click",()=>l(void 0,null,function*(){w.show(),s.hide();let r=yield c(ji,{});w.hide(),s.show(),ot.show();let d=ot.find(".invoice-list");d.empty();for(let o of r)d.createDiv({cls:"invoice-item setting-item"},p=>{p.createDiv({cls:"setting-item-info"},y=>{y.createDiv({text:o.description,cls:"setting-item-name"}),y.createDiv({text:new Date(o.created).toLocaleString(),cls:"setting-item-description"})}),p.createDiv({cls:"setting-item-control mod-vertical"},y=>{y.createEl("button",{cls:"mod-cta",text:"View"},E=>{E.addEventListener("click",()=>{let D=(o.amount/100).toFixed(2),ne=(o.refunded/100).toFixed(2),xe=((o.amount-o.refunded)/100).toFixed(2),mi=o.refunded!==0,lt=localStorage.getItem("billing-info");fish(".invoice-date").setText(new Date(o.created).toLocaleString()),fish(".invoice-number-title").setText(o.receipt_number||o.id),fish(".invoice-number").setText(o.receipt_number||o.id),fish(".invoice-description").setText(o.description),fish(".invoice-amount").setText(D),mi?(fish(".invoice-box .item.mod-refund").show(),fish(".invoice-refund-amount").setText(ne)):fish(".invoice-box .item.mod-refund").hide(),fish(".invoice-total").setText(xe),lt&&fish(".billing-info").setText(lt),fish(".billing-info").addEventListener("input",()=>{let fi=fish(".billing-info").getText();localStorage.setItem("billing-info",fi)}),fish(".modal-container.mod-invoice-detail").show()})}),o.refundable&&y.createEl("a",{text:"Get refund"},E=>{E.addEventListener("click",()=>{st=o.id,rt=o.type,fish(".modal-container.mod-confirm-refund").show()})})})})}))),fish(".js-confirm-refund").addEventListener("click",()=>l(void 0,null,function*(){fish(".modal-container.mod-invoice-list").hide(),fish(".modal-container.mod-confirm-refund").hide(),w.show(),s.hide();try{yield c(Gi,{charge:st,type:rt}),S=!0,fish(".modal-container.mod-refund-success").show()}catch(i){fish(".refund-failed-reason").setText(i),fish(".modal-container.mod-refund-failed").show()}w.hide(),s.show()})),fish(".js-apply-for-discount").addEventListener("click",()=>new Yt().open())});})();
