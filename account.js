(()=>{var wi=Object.defineProperty,vi=Object.defineProperties;var Ti=Object.getOwnPropertyDescriptors;var dt=Object.getOwnPropertySymbols;var Ci=Object.prototype.hasOwnProperty,xi=Object.prototype.propertyIsEnumerable;var ht=(s,e,t)=>e in s?wi(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,xe=(s,e)=>{for(var t in e||(e={}))Ci.call(e,t)&&ht(s,t,e[t]);if(dt)for(var t of dt(e))xi.call(e,t)&&ht(s,t,e[t]);return s},pt=(s,e)=>vi(s,Ti(e));var l=(s,e,t)=>new Promise((i,a)=>{var u=g=>{try{m(t.next(g))}catch(v){a(v)}},f=g=>{try{m(t.throw(g))}catch(v){a(v)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,f);m((t=t.apply(s,e)).next())});function se(s){if(!navigator.clipboard||!navigator.permissions){let e=document.createElement("textarea");e.value=s,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e);try{e.focus(),e.select(),document.execCommand("copy")}catch(t){}document.body.removeChild(e);return}navigator.clipboard.writeText(s)}var ds=window.requestIdleCallback;var hs=/bot|crawl|spider/i.test(navigator.userAgent);var Li=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){Li={passive:!1}}}))}catch(s){}function Di(s){return new Promise((e,t)=>{let i=document.createElement("script");i.type="text/javascript",i.src=s,i.addEventListener("load",()=>e(i)),i.addEventListener("error",a=>t(a)),document.body.appendChild(i)})}function ae(s,e){let t=!1,i=null;return{get loaded(){return t},get promise(){if(t)return Promise.resolve();if(!i){e&&e.before&&e.before();let a=Di(s);a.catch(u=>{u.detach(),i=null}),i=a.then(()=>{t=!0,i=null,e&&e.after&&e.after()})}return i},then(a){return t?a():this.promise.then(a)}}}var mt=new Map;for(let s of"a abbr acronym b bdi bdo big br button canvas cite code data del dfn em embed i iframe img input ins kbd label map mark meter noscript object outputpicture progress q ruby s samp select small span strong sub sup svg textarea time u tt var video wbr".split(" "))mt.set(s,!0);for(let s of"address article aside blockquote details dialog dd div dl dt fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hgroup hr li main nav ol p pre ul".split(" "))mt.set(s,!1);function x(s){let e,t=!1;return()=>(t||(e=s(),t=!0),e)}var I=class{static encodeUrlQuery(e){if(!e)return"";let t=[];for(let i in e)e.hasOwnProperty(i)&&e[i]&&(e[i]===!0?t.push(encodeURIComponent(i)):t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i])));return t.join("&")}static decodeUrlQuery(e){let t={};if(!e||e.trim()==="")return t;let i=e.split("&");for(let a=0;a<i.length;a++){let u=i[a].split("=");if(u.length>=1&&u[0]){let f=decodeURIComponent(u[0]);u.length===2?t[f]=decodeURIComponent(u[1]):t[f]=""}}return t}static decodeUrl(e){e||(e="");let t=e.split("#"),i=t.length>1?t[1]:"",a=t[0].split("?"),u=a.length>1?a[1]:"";return{path:a[0],query:I.decodeUrlQuery(u),hash:I.decodeUrlQuery(i)}}static addQuery(e,t){return e+(e.contains("?")?"&":"?")+I.encodeUrlQuery(t)}};function ft(s){let e=[];for(let t=0;t<s;t++)e.push((Math.random()*16|0).toString(16));return e.join("")}function oe(s,e,t){return"https://raw.githubusercontent.com/"+s+"/"+(t||"HEAD")+"/"+e}function c(s,e){return l(this,null,function*(){let t;try{t=yield ajaxPromise({method:"POST",url:s,data:e})}catch(i){throw i.error?i.error:i}if(t=JSON.parse(t),t.error)throw t.error;return t})}var ws=oe("obsidianmd/obsidian-releases","community-plugins.json");var vs=oe("obsidianmd/obsidian-releases","community-plugin-stats.json");var Ts=oe("obsidianmd/obsidian-releases","community-css-themes.json");var gt=location.host.startsWith("127.0.0.1")||location.host.startsWith("localhost"),h="https://api.obsidian.md";gt&&(h="http://127.0.0.1:3000");var Pi=h+"/user/info",Si=h+"/user/signin",Fi=h+"/user/signup",Mi=h+"/user/signout",Ai=h+"/user/forgetpass",Ii=h+"/user/resetpass",Ri=h+"/user/changename",ki=h+"/user/changeemail",Hi=h+"/user/changepass",Oi=h+"/user/deleteaccount",Ni=h+"/subscription/list",yt=h+"/subscription/pay",_i=h+"/subscription/stripe/end",Et=h+"/subscription/price",Bi=h+"/subscription/business/rename",Ui=h+"/subscription/business/reduce",R=h+"/subscription/renew",Yi=h+"/subscription/publish/reduce",ji=h+"/subscription/paymentmethod",Gi=h+"/subscription/stripe/paymentmethod",$i=h+"/subscription/role/discord",qi=h+"/subscription/role/forum",Vi=h+"/subscription/invoice/list",Xi=h+"/subscription/invoice/refund",Wi=h+"/subscription/paypal/clientid",zi=h+"/subscription/stripe/finish",Ki=h+"/user/discount/apply",Qi=h+"/user/gift/create",Ji=h+"/user/gift/list",Zi=h+"/user/gift/info",Ae=h+"/user/gift/redeem",es=h+"/publish/share/info",ts=h+"/publish/share/accept",ns=h+"/vault/share/info",is=h+"/vault/share/accept",bt="pk_live_vqeOYADfYPpqKDT5FtAqCNBP00a9WEhYa6";gt&&(bt="pk_test_y7CBP7qLG6kSU9sdcHV5S2db0052OC4wR8");function Le(){history.pushState?history.pushState("",document.title,window.location.pathname+window.location.search):location.hash=""}function F(s){let e=(s/100).toFixed(2).toString().toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}var V=location.hash;V&&V.length>1&&(V=V.substr(1));var X=location.search;X&&X.length>1&&(X=X.substr(1));var ce=()=>{location.search&&history.replaceState(null,null,location.pathname)},De=location.search;!De.includes("giftcode")&&!De.includes("publishcode")&&!De.includes("synccode")&&ce();var ss=ae("https://js.braintreegateway.com/web/3.85.2/js/client.min.js"),as=ae("https://js.braintreegateway.com/web/3.85.2/js/data-collector.min.js"),os=ae("https://js.braintreegateway.com/web/3.85.2/js/paypal-checkout.min.js"),wt=x(()=>l(void 0,null,function*(){yield Promise.all([ss,as,os]);let s=yield c(Wi,{}),e=window.braintree,t=yield e.client.create({authorization:s.clientid});return{braintree:e,braintreeClient:t}})),rs=x(()=>l(void 0,null,function*(){let{braintree:s,braintreeClient:e}=yield wt(),t=yield s.paypalCheckout.create({client:e});yield t.loadPayPalSDK({vault:!0,currency:"CAD",intent:"capture"});let i=window.paypal;return{paypalCheckout:t,paypal:i}})),ls=x(()=>l(void 0,null,function*(){let{braintree:s,braintreeClient:e}=yield wt();return yield s.dataCollector.create({client:e})}));function vt(s){return l(this,null,function*(){let e="823279137640415263",t=location.protocol+"//"+location.host+location.pathname;s.addClass("mod-disabled"),location.href=`https://discord.com/api/oauth2/authorize?client_id=${e}&redirect_uri=${encodeURIComponent(t)}&response_type=code&scope=identify`})}function Tt(s){return l(this,null,function*(){s.addClass("mod-disabled");try{yield c(qi,{}),new Ot().open()}catch(e){new Nt(e).open()}s.removeClass("mod-disabled")})}var Ct=class{constructor(e){this.value=!1;(this.el=e.createEl("span","checkbox-container")).addEventListener("click",()=>this.setValue(!this.value))}setValue(e){this.value=e,this.el.toggleClass("is-enabled",this.value)}getValue(){return this.value}},Y=class{constructor(){this.containerEl=createDiv("modal-container");let e=this.bgEl=this.containerEl.createDiv("modal-bg");this.modalEl=this.containerEl.createDiv("modal");let t=this.modalEl.createDiv("modal-close-button");this.titleEl=this.modalEl.createDiv("modal-title"),this.contentEl=this.modalEl.createDiv("modal-content"),this.buttonContainerEl=this.modalEl.createDiv("modal-button-container"),t.addEventListener("click",this.close.bind(this)),e.addEventListener("click",this.close.bind(this))}setTitle(e){return this.titleEl.setText(e),this}open(){document.body.appendChild(this.containerEl),this.onOpen()}close(){this.onClose(),this.containerEl.detach()}onOpen(){}onClose(){}},T=class extends Y{constructor(){super();let e=this.contentEl.createDiv("message-container");this.errorEl=e.createDiv("payment-error message mod-error"),this.hideError()}showError(e){let{errorEl:t}=this;e instanceof XMLHttpRequest&&(e=e.statusText),t.setText(e.toString()),t.show()}hideError(){let{errorEl:e}=this;e.hide(),e.setText("")}},C=class extends Y{constructor(){super();this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Got it"}).addEventListener("click",this.close.bind(this))}},S=class{constructor(e,t){let i=this.containerEl=e.createDiv("payment-line");this.descEl=i.createSpan({cls:"payment-desc",text:t}),i.appendText(": "),this.amountEl=i.createSpan("payment-amount"),i.appendText(" USD"),this.containerEl.hide()}setValues(e,t,i){let{containerEl:a,amountEl:u,descEl:f}=this;a.toggle(e),u.setText(t>=0?"$"+F(t):"-$"+F(-t)),String.isString(i)&&f.setText(i)}},xt=class{constructor(e){this.subtotal=new S(e,"Subtotal"),this.discount=new S(e,"Discount"),this.tax=new S(e,"Tax"),this.credit=new S(e,"Credit"),this.total=new S(e,"Total")}setValues(e){let{subtotal:t,desc:i,tax:a,taxDesc:u,discount:f,discountDesc:m,creditUsed:g,total:v}=e;this.discount.setValues(f!==0,-f,m),this.tax.setValues(a!==0,a,u),this.credit.setValues(g!==0,-g,"Credit"),t===v&&f===0&&a===0&&g===0?(this.subtotal.setValues(!1,0,"Subtotal"),this.total.setValues(!0,v,i)):(this.subtotal.setValues(!0,t,i),this.total.setValues(!0,v,"Total"))}},Lt=class{constructor(e){this.total=new S(e,"Your credit"),this.gift=new S(e,"Credit to gift"),this.remaining=new S(e,"Remaining credit")}setValues(e){let{total:t,gift:i,remaining:a}=e;this.total.setValues(!0,t,"Your credit"),this.gift.setValues(!0,i,"Credit to gift"),this.remaining.setValues(!0,a,"Remaining credit")}},Dt=class{constructor(e){let t=this.formEl=e.createEl("form","payment-form");this.cardEl=t.createEl("label").createDiv("card-element");let i=this.payEl=t.createEl("button","submit mod-cta");this.spinnerEl=i.createDiv("spinner hidden"),this.textEl=i.createSpan({cls:"button-text",text:"Pay"}),this.stripeBadgeEl=t.createEl("p","stripe-badge u-center-text"),this.stripeBadgeEl.createEl("img",{attr:{src:"images/stripe-badge.png",alt:"Powered by Stripe"}})}setUseCredit(e){this.stripeBadgeEl.toggle(!e),this.payEl.toggleClass("mod-no-card",e),this.payEl.setText(e?"Pay with credit":"Pay")}},j=class extends T{constructor(){super();let{contentEl:e}=this;this.createPayment(e);let t=this.paymentContainerEl=e.createDiv("payment-container"),i=this.summaryEl=t.createDiv("payment-summary");this.summary=new xt(i),this.stripeButton=new Dt(t);let a=t.createEl("p","u-center-text");this.paypalButtonEl=a.createEl("span","paypal-button"),this.wechatButtonEl=a.createEl("img",{cls:"wechat-pay-button",attr:{src:"images/wechat-pay.png",alt:"Pay with Wechat Pay"}}),this.alipayButtonEl=a.createEl("img",{cls:"alipay-button",attr:{src:"images/alipay.png",alt:"Pay with Alipay"}}),this.stripeButton.formEl.addEventListener("submit",this.onSubmit.bind(this)),this.wechatButtonEl.addEventListener("click",()=>this.pay("wechat")),this.alipayButtonEl.addEventListener("click",()=>this.pay("alipay")),this.setLoading(!1)}createPayment(e){}onSubmit(e){e.preventDefault(),this.pay("card")}setPrices(e){let t=e.total===0;this.stripeButton.cardEl.toggle(!t),this.stripeButton.setUseCredit(t),this.summary.setValues(e)}onOpen(){super.onOpen(),le().mount(this.stripeButton.cardEl)}onClose(){super.onClose(),le().unmount()}updatePrice(){return l(this,null,function*(){this.hideError();try{let e=this.getPriceData(!1),t=yield c(Et,e);this.setPrices(t)}catch(e){this.showError(e)}})}pay(e){return l(this,null,function*(){this.hideError(),this.setLoading(!0);try{let t=this.getPriceData(!0),i=yield c(yt,xe({method:e},t));if(i.secret){let a;if(e==="card")a=yield J().confirmCardPayment(i.secret,{payment_method:{card:le()}});else if(e==="wechat")a=yield J().confirmWechatPayPayment(i.secret,{payment_method_options:{wechat_pay:{client:"web"}}});else if(e==="alipay")a=yield J().confirmAlipayPayment(i.secret,{return_url:zi});else throw"Please select payment method.";if(a.error)throw a.error.message;yield c(_i,{intent_id:a.paymentIntent.id})}}catch(t){this.showError(t),this.setLoading(!1);return}this.setLoading(!1),this.afterPay()})}setLoading(e){this.stripeButton.payEl.toggleClass("mod-disabled",e),this.stripeButton.spinnerEl.toggleClass("hidden",!e),this.stripeButton.textEl.toggleClass("hidden",e)}setupPaypal(e){return l(this,null,function*(){let{paypalCheckout:t,paypal:i}=yield rs(),a={fundingSource:i.FUNDING.PAYPAL,style:{layout:"horizontal",shape:"pill"},onApprove:(m,g)=>l(this,null,function*(){this.setLoading(!0);try{let v=yield t.tokenizePayment(m),k=yield ls(),de=this.getPriceData(!0);yield c(yt,pt(xe({method:"paypal"},de),{nonce:v.nonce,device_data:k.deviceData})),this.afterPay()}catch(v){console.log(v),this.showError(v)}this.setLoading(!1)}),onCancel:m=>{console.log("PayPal payment cancelled",JSON.stringify(m))},onError:m=>{this.showError(m)}},u=()=>l(this,null,function*(){try{let m=this.getPriceData(!0),g=yield c(Et,m),v=(g.total*g.usdToCad/100).toFixed(2),k={flow:e?"vault":"checkout",intent:"capture",currency:"CAD",amount:v};return e&&(k.requestBillingAgreement=!0,k.billingAgreementDetails={description:g.desc}),t.createPayment(k)}catch(m){throw console.error(m),this.showError(m),m}});e?a.createBillingAgreement=u:a.createOrder=u,this.paypalButtonEl.empty();let f=this.paypalButtonEl.id;f||(this.paypalButtonEl.id=f="paypal-"+ft(16)),i.Buttons(a).render("#"+f)})}},Pe=class{constructor(e,t){this.value=t,this.cardEl=e.createDiv("card u-center-text",i=>{i.createDiv("card-title",a=>{a.style.textAlign="left",a.appendText(t==="yearly"?"Yearly":"Monthly"),this.promoEl=a.createSpan({cls:"flair mod-pop",text:""})}),i.createDiv("card-description",a=>{a.createDiv({},u=>{u.style.float="right",this.perMonthEl=u.createEl("b",{text:"$-"}),u.appendText(" USD / month")}),a.createDiv({},u=>{u.style.float="left",this.perYearEl=u.createEl("b",{text:"$-"}),u.appendText(" USD / year")})})}),this.promoEl.hide()}setValues(e,t){this.perMonthEl.setText("$"+e),this.perYearEl.setText("$"+e*12),this.promoEl.setText(t),this.promoEl.toggle(!!t)}},Ie=class extends j{onOpen(){super.onOpen(),this.setupPaypal(!0)}createPayment(e){let t=e.createDiv("card-container mod-horizontal"),i=this.yearlyCard=new Pe(t,"yearly"),a=this.monthlyCard=new Pe(t,"monthly");this.cards=[i,a],i.cardEl.addEventListener("click",()=>this.setCard(i)),a.cardEl.addEventListener("click",()=>this.setCard(a))}setCard(e){this.selectedCard&&this.selectedCard.cardEl.removeClass("is-selected"),this.selectedCard=e,e&&(e.cardEl.addClass("is-selected"),this.updatePrice())}setSubscriptionPrices(e){this.yearlyCard.setValues(e.yearly,e.yearlyPromo),this.monthlyCard.setValues(e.monthly,e.monthlyPromo)}onSubmit(e){e.preventDefault(),this.pay("card")}},Pt=class extends Ie{constructor(e){super();this.setTitle("Choose a plan"),this.setSubscriptionPrices(e)}getPriceData(){return{type:"sync",variation:"",renew:this.selectedCard.value}}afterPay(){this.close(),new Mt().open()}},St=class extends Ie{constructor(e){super();this.setTitle("Choose a plan"),this.setSubscriptionPrices(e)}createPayment(e){super.createPayment(e);let t=e.createEl("p");t.createEl("label",{cls:"input-label",text:"Number of sites"}),this.numSitesEl=t.createEl("input",{type:"number",attr:{placeholder:"Enter a number...",min:1,value:1}}),this.numSitesEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(){return{type:"publish",variation:this.numSitesEl.value,renew:this.selectedCard.value}}afterPay(){this.close(),new At().open()}},Ft=class extends j{constructor(){super();this.currentSeats=0;this.setTitle("Commercial license"),this.containerEl.addClass("mod-commercial-license")}createPayment(e){super.createPayment(e),this.businessNameContainerEl=e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Business name"}),this.businessNameEl=t.createEl("input",{type:"text",placeholder:"Name of your business..."})}),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Seats"}),this.seatsEl=t.createEl("input",{type:"number",placeholder:"1",attr:{min:1,value:1}})}),this.autoRenewalContainerEl=e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Auto-renewal"}),this.autoRenewal=new Ct(t)}),this.seatsEl.addEventListener("input",this.updatePrice.bind(this))}setStatus(e,t){return this.currentSeats=e,e===0?this.setTitle("Commercial license"):this.setTitle("Add seats"),this.businessNameContainerEl.toggle(e===0),this.autoRenewalContainerEl.toggle(e===0),this.autoRenewal.setValue(t),this}getPriceData(e){let{currentSeats:t}=this;if(e&&t===0&&!this.businessNameEl.value)throw"Please enter a business name.";let i=this.seatsEl.value;if(i==="")return null;let a=parseInt(i);if(isNaN(a)||a<=0)return null;let u=this.autoRenewal.getValue()?"yearly":"";return{type:"business",variation:(t+a).toString(),renew:u}}afterPay(){return l(this,null,function*(){let e=this.businessNameEl.value;if(e)try{yield c(Bi,{company:e})}catch(t){this.showError(t);return}window.location.reload()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Mt=class extends C{constructor(){super();this.setTitle("Successfully bought Obsidian Sync"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by using Obsidian Sync!"),jsx("p",null,"To learn more about how to use the in-app plugin to sync your vaults, ",jsx("a",{href:"https://help.obsidian.md/Obsidian+Sync/Introduction+to+Obsidian+Sync",target:"_blank"},"here's a guide"),"."))}onClose(){super.onClose(),window.location.reload()}},At=class extends C{constructor(){super();this.setTitle("Successfully bought Obsidian Publish"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by using Obsidian Publish!"),jsx("p",null,"To learn more about how to publish your notes, ",jsx("a",{href:"https://help.obsidian.md/Obsidian+Publish/Introduction+to+Obsidian+Publish",target:"_blank"},"here's a guide"),"."))}onClose(){super.onClose(),window.location.reload()}},re=class{constructor(e,t,i,a,u){this.value=t,this.cardEl=e.createDiv("card",f=>{f.createDiv({cls:"card-title",text:i}),f.createDiv("card-description").appendChild(a),f.createDiv("button-container u-center-text").createEl("button","mod-cta",m=>{m.createEl("b",{text:"$"+u}),m.appendText(" USD one-time")})})}},It=class extends j{constructor(){super();this.currentCard=null;this.setTitle("Obsidian Catalyst"),this.containerEl.addClass("mod-personal-license"),this.paymentContainerEl.hide()}createPayment(e){e.createDiv("card-container mod-catalyst",t=>{let i=[this.insiderCard=new re(t,"insider","Insider",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,jsx("b",{className:"u-pop"},'"Insider"')," badge in the community")),25),this.supporterCard=new re(t,"supporter","Supporter",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,"Access to exclusive dev channel"),jsx("li",null,jsx("b",{className:"u-pop"},'"Supporter"')," badge in the community")),50),this.vipCard=new re(t,"vip","VIP",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,"Access to exclusive dev channel"),jsx("li",null,jsx("b",{className:"u-pop"},'"VIP"')," badge in the community")),100)];for(let a of i)a.cardEl.addEventListener("click",()=>l(this,null,function*(){this.setCard(a)}))}),this.upgradeEl=this.contentEl.appendChild(jsx("div",{className:"u-muted"},jsx("p",null,"Please select a tier to upgrade. When upgrading you only need to pay the difference."))),this.upgradeEl.hide()}onOpen(){super.onOpen(),this.setupPaypal(!1)}setCard(e){this.paymentContainerEl.show(),this.currentCard&&this.currentCard.cardEl.removeClass("is-selected"),this.currentCard=e,e&&(e.cardEl.addClass("is-selected"),this.updatePrice())}setTier(e){e==="supporter"?(this.insiderCard.cardEl.hide(),this.supporterCard.cardEl.hide()):e==="insider"&&this.insiderCard.cardEl.hide(),e&&this.upgradeEl.show()}getPriceData(){let{currentCard:e}=this;return e?{type:"catalyst",variation:e.value,renew:""}:null}afterPay(){this.close(),new Rt().open()}},Rt=class extends Y{constructor(){super();this.setTitle("Successfully bought Catalyst"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by upgrading to Catalyst!"),jsx("p",null,"To get insider builds, ",jsx("a",{href:"https://help.obsidian.md/Insider+builds",target:"_blank"},"here's a guide"),"."),jsx("p",null,"To claim your community badges:")),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Get Discord badge"},e=>{e.addEventListener("click",()=>vt(e))}),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Get forum badge"},e=>{e.addEventListener("click",()=>Tt(e))})}onClose(){super.onClose(),window.location.reload()}},kt=class extends Y{constructor(){super();this.contentEl.createDiv("message-container").createDiv({cls:"message mod-success",text:"Successfully added badge for you!"}),this.setTitle("Added Discord badge"),this.contentEl.append(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent so we can pursue our vision."))}},Ht=class extends T{constructor(e){super();this.setTitle("Couldn't add Discord badge"),this.contentEl.append(jsx("p",null,"Please contact us for support or try again later. We're really sorry for the inconvenience!")),this.showError(e)}},Ot=class extends Y{constructor(){super();this.contentEl.createDiv("message-container").createDiv({cls:"message mod-success",text:"Successfully added badge for you!"}),this.setTitle("Added forum badge"),this.contentEl.append(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent so we can pursue our vision."),jsx("p",null,'P.S. Your forum badge is not a "badge" in the forum system, but a shiny gold tag right next to your name in all of your posts. Hope that helps!'))}},Nt=class extends T{constructor(e){super();this.setTitle("Couldn't add forum badge"),this.contentEl.append(jsx("p",null,"Please contact us for support or try again later. We're really sorry for the inconvenience!")),this.showError(e)}},_t=class extends j{constructor(){super();this.setTitle("Obsidian Unlimited"),this.summaryEl.hide()}createPayment(e){e.appendChild(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent, so we can pursue our vision.")),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Amount (USD)"}),this.donationEl=t.createEl("input",{type:"number",placeholder:"Pay what you want...",attr:{min:5,value:50,step:1}})}),this.donationEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(e){let t=this.donationEl.value;if(t==="")return null;let i=parseInt(t);return isNaN(i)||i<=0?null:{type:"donation",variation:(i*100).toString(),renew:""}}afterPay(){return l(this,null,function*(){window.location.reload()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Bt=class extends j{constructor(){super();this.setTitle("Obsidian Credit"),this.summaryEl.hide()}createPayment(e){e.appendChild(jsx("p",null,"Obsidian Credit can be used to buy all kinds of Obsidian licenses and services (Sync and Publish).")),e.appendChild(jsx("p",null,"You can also send your credit to friends and family as a gift.")),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Amount (USD)"}),this.amountEl=t.createEl("input",{type:"number",placeholder:"Credit amount",attr:{min:5,value:50,step:1}})}),this.amountEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(e){let t=this.amountEl.value;if(t==="")return null;let i=parseInt(t);return isNaN(i)||i<=0?null:{type:"credit",variation:(i*100).toString(),renew:""}}afterPay(){return l(this,null,function*(){new Ut().open()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Ut=class extends C{constructor(){super();this.setTitle("Successfully bought Obsidian Credit"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by buying Obsidian Credit!"),jsx("p",null,"You can now purchase Obsidian Sync, Obsidian Publish, or any license with your credit. You can also gift it to others. "))}onClose(){super.onClose(),window.location.reload()}},Yt=class extends T{constructor(){super();this.setTitle("Gift Obsidian Credit"),this.contentEl.appendChild(jsx("p",null,"Gift Obsidian Credit to friends and family so they can buy all things Obsidian!")),this.contentEl.appendChild(jsx("p",null,"It applies to Obsidian Sync, Obsidian Publish, commercial licenses, and Catalyst licenses.")),this.contentEl.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Gift amount (USD)"}),this.giftAmountEl=t.createEl("input",{type:"number",placeholder:"Gift amount",attr:{min:1,max:Math.floor(W/100),value:5,step:1}})}),this.giftOptionsEl=this.contentEl.createDiv(),this.updateGiftOptions(!0),this.giftAmountEl.addEventListener("change",this.updateSummary.bind(this));let e=this.summaryEl=this.contentEl.createDiv("payment-summary");this.contentEl.createDiv("button-container u-center-text",t=>{t.createEl("button",{cls:"mod-cta",text:"Send gift"},i=>{i.onClickEvent(()=>l(this,null,function*(){this.hideError();let a=this.recipientEl.value,u=this.getGiftAmount(),f=this.emailOptionEl.checked;if(f){if(!a){this.showError("Please enter email of the recipient so we can send the gift for you!");return}if(!a.contains("@")){this.showError("Please enter valid recipient email.");return}}if(isNaN(u)){this.showError("Please enter a valid gift amount.");return}if(u<500){this.showError("You need to gift at least $5.");return}if(u>W){this.showError("You cannot gift more credit than you currently have.");return}try{let m=yield c(Qi,{should_email:this.emailOptionEl.checked,recipient:a,amount:u});f?window.location.reload():(this.close(),new Re(m.redeem_code,u,a).open())}catch(m){this.showError(m)}}))}),t.createEl("button",{text:"Cancel"}).addEventListener("click",this.close.bind(this))}),this.summary=new Lt(e)}getGiftAmount(){return parseInt(this.giftAmountEl.value)*100}updateGiftOptions(e){this.giftOptionsEl.empty(),this.giftOptionsEl.append(jsx(jsxFragment,null,jsx("p",null,jsx("label",null,jsx("span",{className:"input-label"},"Method"),jsx("label",null,this.codeOptionEl=jsx("input",{type:"radio",name:"gift-method",value:"code",checked:e}),"Get redeem link"),"\xA0\xA0",jsx("label",null,this.emailOptionEl=jsx("input",{type:"radio",name:"gift-method",value:"email",checked:!e}),"Send anonymously through email"))),jsx("p",{class:"u-muted"},jsx("span",{className:"input-label"}),e?"You'll get a link to redeem the gift. Choose this if you want to send a personalized gift yourself.":"We'll send an email on your behalf. Choose this if you want to stay anonymous or want it to be a surprise."),e?jsx(jsxFragment,null,jsx("p",null,jsx("label",{className:"input-label"},"Recipient name"),this.recipientEl=jsx("input",{type:"email",placeholder:"Recipient name..."})),jsx("p",{class:"u-muted"},jsx("label",{className:"input-label"}),"For your reference only. The recipient will not see this.")):jsx(jsxFragment,null,jsx("p",null,jsx("label",{className:"input-label"},"Recipient email"),this.recipientEl=jsx("input",{type:"email",placeholder:"Recipient email..."})),jsx("p",{className:"u-muted"},jsx("label",{className:"input-label"}),"We'll send an email to this address. Please double check the email address.")))),this.codeOptionEl.addEventListener("change",()=>{let t=this.codeOptionEl.checked;this.updateGiftOptions(t)}),this.emailOptionEl.addEventListener("change",()=>{let t=this.codeOptionEl.checked;this.updateGiftOptions(t)})}updateSummary(){let e=this.getGiftAmount(),t=W-e;if(this.hideError(),isNaN(e)){this.showError("Please enter a valid gift amount.");return}if(e<500){this.showError("You need to gift at least $5 worth of Obsidian Credit.");return}if(t<0){this.showError("You cannot gift more credit than you currently have.");return}this.summary.setValues({total:W,gift:e,remaining:t})}onOpen(){super.onOpen(),this.updateSummary()}};var jt=class extends T{constructor(){super();this.setTitle("Apply for discount"),this.contentEl.append(jsx("p",null,"Please choose discount type you're applying for and enter your school or organization email. We will send an email to this email address to verify it."),jsx("p",{class:"u-muted u-small"},"Please note that if you already have early bird, discounts will not stack with early bird."),jsx("p",{class:"u-muted u-small"},"If you do not have an organization email, please contact us at ",jsx("a",{href:"mailto:support@obsidian.md"},"support@obsidian.md")," to provide other forms of verification, such as student ID card, transcript, or employee ID card."),jsx("p",null,jsx("label",null,jsx("span",{class:"input-label"},"Discount type"),jsx("label",null,jsx("input",{type:"radio",name:"apply-discount-type",value:"1",checked:!0}),"Education (student or faculty)"),"\xA0\xA0",jsx("label",null,jsx("input",{type:"radio",name:"apply-discount-type",value:"2"}),"Non-profit organization"))),jsx("p",null,jsx("label",null,jsx("span",{class:"input-label"},"School or organization email"),this.emailEl=jsx("input",{type:"email",placeholder:"Your email..."})))),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Send application"}).addEventListener("click",()=>l(this,null,function*(){this.hideError();let e=this.contentEl.find('input[name="apply-discount-type"]:checked').value,t=this.emailEl.value;if(!e){this.showError("Please select a discount type.");return}if(t===""||!t.contains("@")){this.showError("Please enter a valid organization email address.");return}try{yield c(Ki,{type:e,email:t}),this.close(),new Gt().open()}catch(i){this.showError(i)}})),this.buttonContainerEl.createEl("button",{text:"Cancel"}).addEventListener("click",this.close.bind(this))}},Gt=class extends C{constructor(){super();this.setTitle("Verify your email"),this.contentEl.append(jsx("p",null,"Thanks for applying for Obsidian discount!"),jsx("p",null,"We've sent an email to your organization email address to verify your email. Once you click on the link, the application will be submitted for review."),jsx("p",null,"If you don't see the email in a few minutes, please try checking your spam folder. You can try applying for a discount again."))}},$t=class extends C{constructor(){super();this.setTitle("Organization email verified"),this.contentEl.append(jsx("p",null,"Thanks for verifying your organization email! We'll take a look at your application as soon as we can."),jsx("p",null,"You'll get an email update when your discount application is approved. Have a nice day!"))}},qt=class extends C{constructor(e){super();this.setTitle("Your discount is active"),this.contentEl.append(jsx("p",null,"Your ",jsx("span",{class:"approved-discount-type"},e)," discount is approved!"),jsx("p",null,"You'll see the discount applied when you try to buy Obsidian Sync or Obsidian Publish. It's not applicable to Catalyst licenses, commercial licenses, or donations."))}},Se=class extends T{constructor(e,t){super();this.setTitle("Redeem your gift"),t?(this.contentEl.append(jsx("p",null,"Unfortunately, we were unable to fetch your gift.")),this.showError(t)):(this.contentEl.append(jsx("p",null,"Someone has sent you a gift worth of $",F(e)," Obsidian Credit. How exciting!")),this.buttonContainerEl.append(jsx(jsxFragment,null,jsx("button",{className:"mod-cta",onclick:this.redeemGift.bind(this)},"Redeem"),jsx("button",{onclick:this.close.bind(this)},"Cancel"))))}redeemGift(){return l(this,null,function*(){try{yield c(Ae,{code:z}),new ke().open()}catch(e){new ue(e).open()}})}},Vt=class extends T{constructor(){super();this.setTitle("Redeem your gift"),this.contentEl.append(jsx("p",null,"Please enter your redeem code below:")),this.contentEl.append(jsx("p",null,this.codeField=jsx("input",{type:"text",placeholder:"Gift redeem code...",style:"width: 100%;"}))),this.buttonContainerEl.append(jsx(jsxFragment,null,jsx("button",{className:"mod-cta",onclick:this.redeemGift.bind(this)},"Redeem"),jsx("button",{onclick:this.close.bind(this)},"Cancel")))}redeemGift(){return l(this,null,function*(){try{let e=this.codeField.value;if(e===""){this.showError("Please enter a redeem code.");return}yield c(Ae,{code:e}),new ke().open()}catch(e){new ue(e).open()}})}},Re=class extends C{constructor(e,t,i){super();this.link=`${location.origin}/account?giftcode=${e}`,i?this.setTitle("Successfully sent gift"):this.setTitle("Copied redeem link"),this.contentEl.append(jsx(jsxFragment,null,i?jsx("p",null,"You just sent a gift of ",F(t),' to "',i,'"!'):"",jsx("p",null,"The link to redeem the gift has been copied to your clipboard."),jsx("p",null,this.linkField=jsx("input",{type:"text",value:this.link,style:"width: 100%;"}))))}onOpen(){super.onOpen(),se(this.link),this.linkField.select()}},Xt=class extends C{constructor(e,t,i){super();this.code=e,i?this.setTitle("Successfully sent gift"):this.setTitle("Copied redeem code"),this.contentEl.append(jsx(jsxFragment,null,i?jsx("p",null,"You just sent a gift of ",F(t),' to "',i,'"!'):"",jsx("p",null,"The gift redeem code has been copied to your clipboard."),jsx("p",null,this.codeField=jsx("input",{type:"text",value:e,style:"width: 100%;"}))))}onOpen(){super.onOpen(),se(this.code),this.codeField.select()}},ke=class extends C{constructor(){super();this.setTitle("Gift redeemed"),this.contentEl.append(jsx("p",null,"Your gift was successfully redeemed!"),jsx("p",null,'You should be able to see the credit in the "Obsidian Credit" section. You can use it to buy whatever you want, or even gift to others.'))}onClose(){super.onClose(),ce(),location.reload()}},ue=class extends T{constructor(e){super();this.setTitle("Gift not redeemed"),this.contentEl.append(jsx("p",null,"Unfortunately, we were unable to redeem your gift for you.")),this.showError(e)}},Fe=class extends T{constructor(e,t,i){super();this.setTitle("Publish site invite"),i?this.showError(i):(this.contentEl.append(jsx("p",null,e," (",t,") has invited you to collaborate on an Obsidian Publish site together.")),this.buttonContainerEl.append(jsx(jsxFragment,null,jsx("button",{className:"mod-cta",onclick:this.acceptInvite.bind(this)},"Accept"),jsx("button",{onclick:this.close.bind(this)},"Cancel"))))}acceptInvite(){return l(this,null,function*(){try{yield c(ts,{code:K}),this.close(),new Wt().open()}catch(e){let t=new T;t.setTitle("Couldn't accept invite"),t.contentEl.append(jsx("p",null,"Unfortunately, something went wrong when accepting the invite.")),t.showError(e),this.close(),t.open()}})}},Wt=class extends C{constructor(){super();this.setTitle("Accepted invite"),this.contentEl.append(jsx("p",null,"You have successfully accepted the invite!"),jsx("p",null,"You can now go into the Obsidian app, log in under Settings ","->",' Account, and enable the "Publish" core plugin to start collaborating on this site.'))}onClose(){super.onClose(),ce(),location.reload()}},Me=class extends T{constructor(e,t,i){super();this.setTitle("Obsidian Sync vault invite"),i?this.showError(i):(this.contentEl.append(jsx("p",null,e," (",t,") has invited you to collaborate on an Obsidian Sync vault together.")),this.buttonContainerEl.append(jsx(jsxFragment,null,jsx("button",{className:"mod-cta",onclick:this.acceptInvite.bind(this)},"Accept"),jsx("button",{onclick:this.close.bind(this)},"Cancel"))))}acceptInvite(){return l(this,null,function*(){try{yield c(is,{code:Q}),this.close(),new zt().open()}catch(e){let t=new T;t.setTitle("Couldn't accept invite"),t.contentEl.append(jsx("p",null,"Unfortunately, something went wrong when accepting the invite.")),t.showError(e),this.close(),t.open()}})}},zt=class extends C{constructor(){super();this.setTitle("Accepted invite"),this.contentEl.append(jsx("p",null,"You have successfully accepted the invite!"),jsx("p",null,"You can now go into the Obsidian app, log in under Settings ","->",' Account, and enable the "Sync" core plugin to start collaborating on this vault.'))}onClose(){super.onClose(),ce(),location.reload()}},J=x(()=>window.Stripe(bt)),le=x(()=>J().elements().create("card",{style:{base:{color:"#dcddde",iconColor:"#dcddde",fontFamily:"Inter, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#888888"}},invalid:{fontFamily:"Inter, sans-serif",color:"#fa755a",iconColor:"#fa755a"}}})),cs="",W=0,z=null,K=null,Q=null;ready(()=>{let s=fish(".login-form"),e=fish(".login-form .message.mod-error"),t=fish(".signup-form"),i=fish(".signup-form .message.mod-error"),a=fish(".welcome"),u=fish("#labeled-input-email"),f=fish("#labeled-input-password"),m=fish(".signup-name"),g=fish(".obsidian-signup-email"),v=fish(".signup-password"),k=fish(".welcome-name"),de=fish(".welcome-email"),Kt=fish(".js-change-email"),Qt=fish(".modal-container.mod-change-email"),Jt=fish(".change-email-new-email"),Zt=fish(".change-email-password"),en=fish(".js-confirm-change-email"),H=fish(".modal-container.mod-change-email .message.mod-error"),tn=fish(".js-change-name"),nn=fish(".modal-container.mod-change-name"),sn=fish(".change-name-new-name"),an=fish(".js-confirm-change-name"),G=fish(".modal-container.mod-change-name .message.mod-error"),on=fish(".js-change-password"),rn=fish(".modal-container.mod-change-password"),ln=fish(".change-password-old-password"),cn=fish(".change-password-new-password"),un=fish(".js-confirm-change-password"),O=fish(".modal-container.mod-change-password .message.mod-error"),dn=fish(".js-delete-account"),hn=fish(".modal-container.mod-delete-account"),pn=fish(".delete-account-password"),mn=fish(".delete-account-email"),fn=fish(".js-confirm-delete-account"),N=fish(".modal-container.mod-delete-account .message.mod-error"),$=fish(".modal-container.mod-change-info-success"),yn=fish(".js-logout"),He=fish(".card.mod-publish"),Oe=fish(".card.mod-sync"),Ne=fish(".publish-site-num"),_e=fish(".publish-renew-site-num"),En=fishAll(".publish-renewal-time"),gn=fish(".publish-renew-info-renewing"),Be=fish(".publish-renew-info-not-renewing"),bn=fishAll(".js-view-payment-info"),wn=fishAll(".js-open-change-payment"),Ue=fish(".current-card-info"),Ye=fish(".modal-container.mod-change-payment-method"),vn=fish(".modal-container.mod-change-payment-method .payment-form"),Tn=fish(".js-change-number-of-publish-sites"),he=fish(".js-reduce-number-of-publish-sites"),je=fish(".js-change-publish-to-monthly"),Ge=fish(".js-change-publish-to-yearly"),$e=fish(".setting-item-description.mod-publish-frequency"),qe=fish(".publish-reduce-sites-num"),Cn=fish(".js-update-reduce-sites"),Ve=fish(".js-stop-publish-auto-renewal"),xn=fish(".commercial-license-pitch"),Ln=fish(".existing-commercial-license"),D=fish(".commercial-license-key"),Dn=fish(".commercial-license-company-name"),Pn=fishAll(".commercial-license-seat-number"),Xe=fish(".card.mod-commercial-license"),Sn=fish(".catalyst-tier"),We=fish(".catalyst-upgrade-button"),Fn=fishAll(".js-close-modal, .modal-close-button, .modal-bg"),ze=fish(".card.mod-catalyst"),b=fish(".loader-cube"),Mn=fish(".js-go-to-signup"),An=fish(".js-go-to-login"),In=fish(".js-go-to-forgot-pass"),Ke=fish(".forgot-pass-form"),pe=fish(".forgot-pass-form .message.mod-success"),_=fish(".forgot-pass-form .message.mod-error"),Rn=fish(".forgot-pass-email"),Qe=fish(".reset-pass-form"),kn=fish(".forgot-pass-email-container"),Hn=fish(".reset-pass-password"),me=fish(".reset-pass-form .message.mod-success"),q=fish(".reset-pass-form .message.mod-error"),On=fish(".js-request-forgot"),fe=null,Nn=fish(".js-upgrade-publish"),_n=fish(".modal-container.mod-publish-reduce-sites"),Bn=fish(".modal-container.mod-view-payment-method"),Un=fish(".js-open-unlimited"),Yn=fish(".obsidian-credit-amount"),jn=fish(".donation-amount"),Gn=fishAll(".modal-container"),$n=fish(".js-upgrade-sync"),Je=fish(".js-change-sync-to-monthly"),Ze=fish(".js-change-sync-to-yearly"),et=fish(".js-stop-sync-auto-renewal"),qn=fishAll(".sync-renewal-time"),Vn=fish(".sync-renew-info-renewing"),tt=fish(".sync-renew-info-not-renewing"),nt=fish(".setting-item-description.mod-sync-frequency"),Xn=fishAll(".commercial-renewal-time"),ye=fish(".js-resume-commercial-auto-renewal"),Z=fish(".js-stop-commercial-auto-renewal"),Ee=fish(".commercial-renew-info-renewing"),ee=fish(".commercial-renew-info-not-renewing"),Wn=fishAll(".commercial-license-expiry-date"),zn=fishAll(".checkbox-container"),Kn=fishAll(".claim-discord-badge-button"),Qn=fishAll(".claim-forum-badge-button"),Jn=fish(".js-commercial-license-change-seat"),Zn=fish(".js-commercial-license-reduce-seat"),ei=fish(".modal-container.mod-commercial-license-reduce-seats"),ti=fish(".commercial-license-reduce-seat-input"),ni=fish(".js-update-reduce-seats"),B=fish(".modal-container.mod-commercial-license-reduce-seats .payment-error"),ge={monthly:10,yearly:8,yearlyPromo:"20% off compared to monthly"},be={monthly:20,yearly:16,yearlyPromo:"20% off compared to monthly"},we=x(()=>new It),ii=x(()=>new Pt(ge)),it=x(()=>new St(be)),st=x(()=>new Ft),si=x(()=>new _t),ai=x(()=>new Bt),te="",ne=!1,at=null,ot=null,M=!1,A=null,oi=J(),ve=le(),L=null,U=()=>{if(M){window.location.reload();return}ve.unmount(),Gn.forEach(n=>n.hide()),M=!1},w=I.decodeUrlQuery(V);if(w.mode&&w.mode==="signup")Le(),b.hide(),t.show(),ne=!0;else if(w.mode&&w.mode==="forgotpass")Le(),b.hide(),Ke.show(),ne=!0;else if(w.hasOwnProperty("forgetpw")&&w.id&&w.key)Le(),at=w.id,ot=w.key,b.hide(),Qe.show(),ne=!0;else if(w.stripe&&w.stripe==="complete"){let n=w.session}else w.discount&&(w.discount==="verified"?new $t().open():w.discount==="approved"&&w.type&&new qt(w.type).open());if(L=I.decodeUrlQuery(X),L.code)l(void 0,null,function*(){try{yield c($i,{code:L.code}),new kt().open()}catch(n){new Ht(n).open()}});else if(L.giftcode)z=L.giftcode;else if(L.publishcode)K=L.publishcode;else if(L.synccode)Q=L.synccode;else if(L.action&&L.action==="sync-setup"){setTimeout(()=>location.href="obsidian://sync-setup",0);let n=new C;n.setTitle("Invited to shared Obsidian Sync vault"),n.contentEl.append(jsx("p",null,"You've been invited to a shared Obsidian Sync vault!"),jsx("p",null,"If Obsidian didn't open automatically, you can view vaults shared with you by going to Settings -> Sync -> Remote vault -> Manage/Choose.")),n.open()}let ri=n=>l(void 0,null,function*(){try{let o=yield c(Zi,{code:n});new Se(o.amount,null).open()}catch(o){new Se(0,o).open()}}),li=n=>l(void 0,null,function*(){try{let o=yield c(es,{code:n});new Fe(o.name,o.email,null).open()}catch(o){new Fe("","",o).open()}}),ci=n=>l(void 0,null,function*(){try{let o=yield c(ns,{code:n});new Me(o.name,o.email,null).open()}catch(o){new Me("","",o).open()}}),ui=()=>l(void 0,null,function*(){let n;try{n=yield c(Pi,{})}catch(o){ne||(b.hide(),s.show(),z&&(e.setText("Please log in or sign up to redeem your gift."),e.show()),(K||Q)&&(e.setText("Please log in or sign up to accept the invite."),e.show()));return}if(cs=n.name,k.setText(n.name),de.setText(n.email),n.donation&&jn.setText(F(n.donation)),t.hide(),b.hide(),a.show(),n.license&&(te=n.license),te?(ze.addClass("is-active"),Sn.setText(n.license),we().setTier(te),te==="vip"?fish(".card-container.mod-unlimited").show():(We.addEventListener("click",()=>{we().open()}),We.show())):ze.addEventListener("click",()=>{we().open()}),W=n.credit,fish(".js-gift-credit").toggle(n.credit!==0),Yn.setText(F(n.credit)),n.discount){let{status:o,type:d,expiry_ts:r}=n.discount,p=fish(".setting-item.mod-discount .setting-item-description"),y=fish(".setting-item.mod-discount .setting-item-control a");o==="submitted"?(p.setText("You have submitted your school or organization email, but have not completed email verification yet. Please check your email for a link to verify your email address."),y.hide()):o==="verified"?(p.setText("Your discount application has been submitted for review. Thanks for your patience!"),y.hide()):o==="approved"&&(p.setText(`Your ${d} discount currently gives you 40% off the regular price of Obsidian Sync and Publish. Your discount will expire on ${new Date(r).toLocaleDateString()}.`),y.setText("Renew"))}z?ri(z):K?li(K):Q&&ci(Q)}),di=()=>l(void 0,null,function*(){let n=yield c(Ni,{});if(n.business&&n.business.expiry>=Date.now()){A=n.business,D.setText(A.key),Dn.setText(A.company);let o=A.seats,d=o===1?"1 seat":o+" seats";Pn.forEach(r=>r.setText(d)),Wn.forEach(r=>r.setText(new Date(A.expiry).toLocaleDateString())),xn.hide(),Ln.show()}else Xe.addEventListener("click",()=>st().setStatus(0,!0).open());if(n.publish){let{sites:o,renew:d,renew_sites:r,expiry_ts:p,earlybird:y}=n.publish;if(p>=Date.now()){if(He.addClass("is-active"),o===1?Ne.setText("1 site"):Ne.setText(`${o} sites`),r===1?(_e.setText("1 site"),he.hide()):(_e.setText(`${r} sites`),he.show()),p){let P=new Date(p);En.forEach(ie=>ie.setText(`on ${P.toLocaleDateString()}`))}Be.hide();let E=document.createDocumentFragment();d==="yearly"?(Ge.hide(),E.createSpan({text:"You're currently on a "}),E.createSpan({cls:"u-pop",text:"yearly"}),E.createSpan({text:" plan."})):d==="monthly"?(je.hide(),E.createSpan({text:"You're currently on a "}),E.createSpan({cls:"u-pop",text:"monthly"}),E.createSpan({text:" plan."})):d===""&&(Ve.hide(),Be.show(),gn.hide(),E.createSpan({text:"You're not currently being renewed."})),$e.empty(),$e.appendChild(E),qe.value=o}y===!0&&(be.yearly/=2,be.monthly/=2,He.addClass("is-early-bird"))}if(n.sync){let{renew:o,expiry_ts:d,earlybird:r}=n.sync;if(d>=Date.now()){if(Oe.addClass("is-active"),d){let y=new Date(d);qn.forEach(E=>E.setText(`on ${y.toLocaleDateString()}`))}tt.hide();let p=document.createDocumentFragment();o==="yearly"?(Ze.hide(),p.createSpan({text:"You're currently on a "}),p.createSpan({cls:"u-pop",text:"yearly"}),p.createSpan({text:" plan."})):o==="monthly"?(Je.hide(),p.createSpan({text:"You're currently on a "}),p.createSpan({cls:"u-pop",text:"monthly"}),p.createSpan({text:" plan."})):o===""&&(et.hide(),tt.show(),Vn.hide(),p.createSpan({text:"You're not currently being renewed."})),nt.empty(),nt.appendChild(p)}r===!0&&(ge.yearly/=2,ge.monthly/=2,Oe.addClass("is-early-bird"))}if(n.business){let{renew:o,expiry:d}=n.business;if(d>=Date.now()){if(Xe.addClass("is-active"),d){let r=new Date(d);Xn.forEach(p=>p.setText(`on ${r.toLocaleDateString()}`))}ee.hide(),o==="yearly"?(ye.hide(),Z.show(),ee.hide(),Ee.show()):o===""&&(ye.show(),Z.hide(),ee.show(),Ee.hide()),o===""&&(Z.hide(),ee.show(),Ee.hide())}}}),hi=()=>l(void 0,null,function*(){let n=yield c(Ji,{}),o=fish(".setting-item.mod-gift-history"),d=o.find(".setting-item-description");if(!(!n||n.length===0)){d.empty(),n.sort((r,p)=>r.ts-p.ts);for(let r of n){if(r.type==="sent"){let p=`You sent $${F(r.amount)} to "${r.recipient}" on ${new Date(r.ts).toLocaleDateString()}. `;d.createEl("p",{text:p},y=>{if(r.redeemed||(y.createEl("a",{cls:"landing-link",text:"Copy redeem link",href:"#"},E=>E.addEventListener("click",P=>l(void 0,null,function*(){P.preventDefault(),new Re(r.redeem_code).open()}))),y.createEl("span",{text:" or "}),y.createEl("a",{cls:"landing-link",text:"copy redeem code",href:"#"},E=>E.addEventListener("click",P=>l(void 0,null,function*(){P.preventDefault(),new Xt(r.redeem_code).open()})))),y.createEl("br"),r.redeemed){let E=r.is_cancelled?"cancelled":"redeemed";y.createEl("span",{text:`Your gift was ${E} on ${new Date(r.redeemed_ts).toLocaleDateString()}.`})}else y.createEl("span",{text:"Waiting for recipient to redeem gift. "}),y.createEl("span",{text:" "}),y.createEl("a",{cls:"landing-link",text:"Cancel this gift",href:"#"},E=>E.addEventListener("click",P=>l(void 0,null,function*(){if(P.preventDefault(),!!confirm("Are you sure you want to cancel this gift? Your credits will be refunded, and the recipient will no longer be able to redeem it."))try{yield c(Ae,{code:r.redeem_code}),location.reload()}catch(Ce){new ue(Ce).open()}})))})}else if(r.type==="received"){let p=`You redeemed $${F(r.amount)} worth of gift credit on ${new Date(r.ts).toLocaleDateString()}. `;d.createEl("p",{text:p})}o.show()}}}),pi=()=>l(void 0,null,function*(){e.hide(),s.hide(),b.show();let n=u.value,o=f.value,d=!1;if(n===""?(e.setText("Email cannot be empty."),d=!0):n.indexOf("@")===-1?(e.setText("Email is not valid."),d=!0):o===""&&(e.setText("Password cannot be empty."),d=!0),d){s.show(),b.hide(),e.show();return}try{yield c(Si,{email:u.value,password:f.value}),window.location.reload()}catch(r){s.show(),b.hide(),e.setText(r),e.show()}}),mi=()=>l(void 0,null,function*(){i.hide(),t.hide(),b.show();let n=m.value,o=g.value,d=v.value,r=!1;if(n===""?(i.setText("Name cannot be empty."),r=!0):o===""?(i.setText("Email cannot be empty."),r=!0):o.indexOf("@")===-1?(i.setText("Email is not valid."),r=!0):d===""&&(i.setText("Password cannot be empty."),r=!0),r){i.show(),t.show(),b.hide();return}try{yield c(Fi,{name:n,email:o,password:d}),window.location.reload()}catch(p){t.show(),b.hide(),p==="Invalid email address"?i.setText("The email address you entered was invalid."):p==="Already signed up"&&i.setText("Seems like you already have an account! Please log in."),i.show()}}),fi=()=>l(void 0,null,function*(){_.hide(),pe.hide();let n=Rn.value;if(n){if(n.indexOf("@")===-1){_.setText('Email address is not valid and must contain "@".'),_.show();return}}else{_.setText("Please fill out your email."),_.show();return}b.show();try{yield c(Ai,{email:n,captcha:"captcha"}),pe.setText(`We have sent an email to ${n} to reset your password.`),pe.show(),kn.hide(),On.hide(),b.hide()}catch(o){_.setText("Something went wrong, please try again."),_.show(),b.hide()}}),yi=()=>l(void 0,null,function*(){me.hide(),q.hide();let n=Hn.value;if(!n){q.setText("Please set a new password."),q.show();return}try{yield c(Ii,{password:n,id:at,key:ot}),me.innerHTML='Your password has been successfully set. <a href="/account">Log in</a>',me.show()}catch(o){q.setText("Something went wrong, please try again."),q.show()}}),Ei=()=>l(void 0,null,function*(){yield c(Mi,{}),window.location.reload()});ui(),di(),hi(),yn.addEventListener("click",()=>{Ei()});let Te=()=>{let n=D.getText();se(n),D.setText("Copied!"),D.addClass("is-copied"),D.removeEventListener("click",Te),setTimeout(()=>{D.removeClass("is-copied"),D.setText(n),D.addEventListener("click",Te)},500)};D.addEventListener("click",Te),Fn.forEach(n=>{n.addEventListener("click",U)}),Mn.addEventListener("click",()=>{location.hash="#mode=signup",location.reload()}),An.addEventListener("click",()=>{location.hash="",location.reload()}),In.addEventListener("click",()=>{location.hash="#mode=forgotpass",location.reload()}),s.find("form").addEventListener("submit",n=>{n.preventDefault(),pi()}),t.find("form").addEventListener("submit",n=>{n.preventDefault(),mi()}),Ke.find("form").addEventListener("submit",n=>{n.preventDefault(),fi()}),Qe.find("form").addEventListener("submit",n=>{n.preventDefault(),yi()}),Nn.addEventListener("click",()=>it().open()),je.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to change your Obsidian Publish subscription to monthly?")&&(yield c(R,{type:"publish",renew:"monthly"}),window.location.reload())})),Ge.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to change your Obsidian Publish subscription to yearly?")&&(yield c(R,{type:"publish",renew:"yearly"}),window.location.reload())})),Ve.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to stop your Obsidian Publish subscription?")&&(yield c(R,{type:"publish",renew:""}),window.location.reload())})),Tn.addEventListener("click",()=>it().open()),he.addEventListener("click",()=>{_n.show()}),Cn.addEventListener("click",()=>l(void 0,null,function*(){let n=parseInt(qe.value);yield c(Yi,{sites:n}),window.location.reload()})),bn.forEach(n=>n.addEventListener("click",()=>l(void 0,null,function*(){let o=yield c(ji,{});o.info?Ue.setText(`You're currently using a ${o.info}.`):Ue.setText("You currently do not have any payment methods on file."),Bn.show()}))),wn.forEach(n=>n.addEventListener("click",()=>{Ye.show(),fe=Ye.find(".payment-error"),ve.mount(".modal-container.mod-change-payment-method .card-element")})),vn.addEventListener("submit",n=>{n.preventDefault(),oi.createPaymentMethod({type:"card",card:ve}).then(o=>l(void 0,null,function*(){o.paymentMethod&&o.paymentMethod.id?(yield c(Gi,{payment_method_id:o.paymentMethod.id}),window.location.reload()):(fe.setText("Could not update your payment method."),fe.show())}))}),Un.addEventListener("click",()=>{si().open()}),fish(".js-add-credit").onClickEvent(()=>{ai().open()}),fish(".js-gift-credit").onClickEvent(()=>{new Yt().open()}),fish(".js-redeem-gift").onClickEvent(()=>{new Vt().open()}),$n.addEventListener("click",()=>ii().open()),Je.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to change your Obsidian Sync subscription to monthly?")&&(yield c(R,{type:"sync",renew:"monthly"}),window.location.reload())})),Ze.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to change your Obsidian Sync subscription to yearly?")&&(yield c(R,{type:"sync",renew:"yearly"}),window.location.reload())})),et.addEventListener("click",()=>l(void 0,null,function*(){confirm("Are you sure you want to stop your Obsidian Sync subscription?")&&(yield c(R,{type:"sync",renew:""}),window.location.reload())})),Z.addEventListener("click",()=>l(void 0,null,function*(){yield c(R,{type:"business",renew:""}),window.location.reload()})),ye.addEventListener("click",()=>l(void 0,null,function*(){yield c(R,{type:"business",renew:"yearly"}),window.location.reload()})),zn.forEach(n=>{n.addEventListener("click",()=>{n.hasClass("is-enabled")?n.removeClass("is-enabled"):n.addClass("is-enabled")})}),Kn.forEach(n=>n.addEventListener("click",()=>vt(n))),Qn.forEach(n=>n.addEventListener("click",()=>Tt(n))),Kt.addEventListener("click",()=>{Qt.show()}),en.addEventListener("click",()=>l(void 0,null,function*(){H.hide();let n=Jt.value,o=Zt.value;if(n===""){H.setText("New email cannot be empty."),H.show();return}if(o===""){H.setText("Password cannot be empty."),H.show();return}try{yield c(ki,{password:o,email:n}),U(),M=!0,$.show()}catch(d){H.setText(d),H.show()}})),tn.addEventListener("click",()=>{nn.show()}),an.addEventListener("click",()=>l(void 0,null,function*(){G.hide();let n=sn.value;if(n===""){G.setText("New name cannot be empty."),G.show();return}try{yield c(Ri,{name:n}),U(),M=!0,$.show()}catch(o){G.setText(o),G.show()}})),on.addEventListener("click",()=>{rn.show()}),un.addEventListener("click",()=>l(void 0,null,function*(){O.hide();let n=ln.value,o=cn.value;if(n===""){O.setText("Current password cannot be empty."),O.show();return}if(n===""){O.setText("New password cannot be empty."),O.show();return}try{yield c(Hi,{old_password:n,new_password:o}),U(),M=!0,$.show()}catch(d){O.setText(d),O.show()}})),dn.addEventListener("click",()=>{hn.show()}),fn.addEventListener("click",()=>l(void 0,null,function*(){N.hide();let n=mn.value,o=pn.value;if(n===""){N.setText("Please enter your email to confirm account deletion."),N.show();return}if(o===""){N.setText("Please enter your password to confirm account deletion."),N.show();return}try{yield c(Oi,{email:n,password:o}),U(),M=!0,$.show()}catch(d){N.setText(d),N.show()}})),Jn.addEventListener("click",()=>{st().setStatus(A.seats,!!A.renew).open()}),Zn.addEventListener("click",()=>{ei.show()}),ni.addEventListener("click",()=>l(void 0,null,function*(){B.hide();let n=ti.valueAsNumber,o=A.seats;if(n===0){B.setText("The number of seats to remove cannot be 0."),B.show();return}let d=o-n;if(d<0){let r=o===1?"1 seat":o+" seats";B.setText("You currently have "+r+" and cannot remove more seats than that."),B.show();return}try{yield c(Ui,{seats:d}),U(),M=!0,$.show()}catch(r){B.setText(r),B.show()}}));let rt="",lt="stripe",ct=fish(".modal-container.mod-invoice-list");fishAll(".js-view-invoices").forEach(n=>n.addEventListener("click",()=>l(void 0,null,function*(){b.show(),a.hide();let o=yield c(Vi,{});b.hide(),a.show(),ct.show();let d=ct.find(".invoice-list");d.empty();for(let r of o)d.createDiv({cls:"invoice-item setting-item"},p=>{p.createDiv({cls:"setting-item-info"},y=>{y.createDiv({text:r.description,cls:"setting-item-name"}),y.createDiv({text:new Date(r.created).toLocaleString(),cls:"setting-item-description"})}),p.createDiv({cls:"setting-item-control mod-vertical"},y=>{y.createEl("button",{cls:"mod-cta",text:"View"},E=>{E.addEventListener("click",()=>{let P=(r.amount/100).toFixed(2),ie=(r.refunded/100).toFixed(2),Ce=((r.amount-r.refunded)/100).toFixed(2),gi=r.refunded!==0,ut=localStorage.getItem("billing-info");fish(".invoice-date").setText(new Date(r.created).toLocaleString()),fish(".invoice-number-title").setText(r.receipt_number||r.id),fish(".invoice-number").setText(r.receipt_number||r.id),fish(".invoice-description").setText(r.description),fish(".invoice-amount").setText(P),gi?(fish(".invoice-box .item.mod-refund").show(),fish(".invoice-refund-amount").setText(ie)):fish(".invoice-box .item.mod-refund").hide(),fish(".invoice-total").setText(Ce),ut&&fish(".billing-info").setText(ut),fish(".billing-info").addEventListener("input",()=>{let bi=fish(".billing-info").getText();localStorage.setItem("billing-info",bi)}),fish(".modal-container.mod-invoice-detail").show()})}),r.refundable&&y.createEl("a",{text:"Get refund"},E=>{E.addEventListener("click",()=>{rt=r.id,lt=r.type,fish(".modal-container.mod-confirm-refund").show()})})})})}))),fish(".js-confirm-refund").addEventListener("click",()=>l(void 0,null,function*(){fish(".modal-container.mod-invoice-list").hide(),fish(".modal-container.mod-confirm-refund").hide(),b.show(),a.hide();try{yield c(Xi,{charge:rt,type:lt}),M=!0,fish(".modal-container.mod-refund-success").show()}catch(n){fish(".refund-failed-reason").setText(n),fish(".modal-container.mod-refund-failed").show()}b.hide(),a.show()})),fish(".js-apply-for-discount").addEventListener("click",()=>new jt().open())});})();
