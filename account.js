(()=>{var ci=Object.defineProperty,ui=Object.defineProperties;var di=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var hi=Object.prototype.hasOwnProperty,mi=Object.prototype.propertyIsEnumerable;var nt=(a,e,t)=>e in a?ci(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,Te=(a,e)=>{for(var t in e||(e={}))hi.call(e,t)&&nt(a,t,e[t]);if(tt)for(var t of tt(e))mi.call(e,t)&&nt(a,t,e[t]);return a},it=(a,e)=>ui(a,di(e));var o=(a,e,t)=>new Promise((i,s)=>{var u=y=>{try{f(t.next(y))}catch(v){s(v)}},m=y=>{try{f(t.throw(y))}catch(v){s(v)}},f=y=>y.done?i(y.value):Promise.resolve(y.value).then(u,m);f((t=t.apply(a,e)).next())});function at(a){if(!navigator.clipboard||!navigator.permissions){let e=document.createElement("textarea");e.value=a,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e);try{e.focus(),e.select(),document.execCommand("copy")}catch(t){}document.body.removeChild(e);return}navigator.clipboard.writeText(a)}var Xi=window.requestIdleCallback;var zi=/bot|crawl|spider/i.test(navigator.userAgent);var pi=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){pi={passive:!1}}}))}catch(a){}function fi(a){return new Promise((e,t)=>{let i=document.createElement("script");i.type="text/javascript",i.src=a,i.addEventListener("load",()=>e(i)),i.addEventListener("error",s=>t(s)),document.body.appendChild(i)})}function Ce(a,e){let t=!1,i=null;return{get loaded(){return t},get promise(){if(t)return Promise.resolve();if(!i){e&&e.before&&e.before();let s=fi(a);s.catch(u=>{u.detach(),i=null}),i=s.then(()=>{t=!0,i=null,e&&e.after&&e.after()})}return i},then(s){return t?s():this.promise.then(s)}}}var st=new Map;for(let a of"a abbr acronym b bdi bdo big br button canvas cite code data del dfn em embed i iframe img input ins kbd label map mark meter noscript object outputpicture progress q ruby s samp select small span strong sub sup svg textarea time u tt var video wbr".split(" "))st.set(a,!0);for(let a of"address article aside blockquote details dialog dd div dl dt fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hgroup hr li main nav ol p pre ul".split(" "))st.set(a,!1);function T(a){let e,t=!1;return()=>(t||(e=a(),t=!0),e)}var P=class{static encodeUrlQuery(e){if(!e)return"";let t=[];for(let i in e)e.hasOwnProperty(i)&&e[i]&&(e[i]===!0?t.push(encodeURIComponent(i)):t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i])));return t.join("&")}static decodeUrlQuery(e){let t={};if(!e||e.trim()==="")return t;let i=e.split("&");for(let s=0;s<i.length;s++){let u=i[s].split("=");if(u.length>=1&&u[0]){let m=decodeURIComponent(u[0]);u.length===2?t[m]=decodeURIComponent(u[1]):t[m]=""}}return t}static decodeUrl(e){e||(e="");let t=e.split("#"),i=t.length>1?t[1]:"",s=t[0].split("?"),u=s.length>1?s[1]:"";return{path:s[0],query:P.decodeUrlQuery(u),hash:P.decodeUrlQuery(i)}}static addQuery(e,t){return e+(e.contains("?")?"&":"?")+P.encodeUrlQuery(t)}};function rt(a){let e=[];for(let t=0;t<a;t++)e.push((Math.random()*16|0).toString(16));return e.join("")}function ne(a,e,t){return"https://raw.githubusercontent.com/"+a+"/"+(t||"HEAD")+"/"+e}function c(a,e){return o(this,null,function*(){let t;try{t=yield ajaxPromise({method:"POST",url:a,data:e})}catch(i){throw i.error?i.error:i}if(t=JSON.parse(t),t.error)throw t.error;return t})}var na=ne("obsidianmd/obsidian-releases","community-plugins.json");var ia=ne("obsidianmd/obsidian-releases","community-plugin-stats.json");var aa=ne("obsidianmd/obsidian-releases","community-css-themes.json");var ut=location.host.startsWith("127.0.0.1")||location.host.startsWith("localhost"),h="https://api.obsidian.md";ut&&(h="http://127.0.0.1:3000");var yi=h+"/user/info",Ei=h+"/user/signin",gi=h+"/user/signup",wi=h+"/user/signout",bi=h+"/user/forgetpass",vi=h+"/user/resetpass",Ti=h+"/user/changename",Ci=h+"/user/changeemail",xi=h+"/user/changepass",Di=h+"/user/deleteaccount",Li=h+"/subscription/list",lt=h+"/subscription/pay",Pi=h+"/subscription/stripe/end",ot=h+"/subscription/price",Fi=h+"/subscription/business/rename",Si=h+"/subscription/business/reduce",F=h+"/subscription/renew",Mi=h+"/subscription/publish/reduce",Ai=h+"/subscription/paymentmethod",Ri=h+"/subscription/stripe/paymentmethod",Ii=h+"/subscription/role/discord",ki=h+"/subscription/role/forum",Hi=h+"/subscription/invoice/list",Bi=h+"/subscription/invoice/refund",_i=h+"/subscription/paypal/clientid",Ni=h+"/subscription/stripe/finish",Oi=h+"/user/discount/apply",Ui=h+"/user/gift/create",Yi=h+"/user/gift/list",ct=h+"/user/gift/redeem",dt="pk_live_vqeOYADfYPpqKDT5FtAqCNBP00a9WEhYa6";ut&&(dt="pk_test_y7CBP7qLG6kSU9sdcHV5S2db0052OC4wR8");function xe(){history.pushState?history.pushState("",document.title,window.location.pathname+window.location.search):location.hash=""}function z(a){let e=(a/100).toFixed(2).toString().toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}var V=location.hash;V&&V.length>1&&(V=V.substr(1));var $=location.search;$&&$.length>1&&($=$.substr(1));var ht=()=>{location.search&&history.replaceState(null,null,location.pathname)};location.search.includes("giftcode")||ht();var ji=Ce("https://js.braintreegateway.com/web/3.85.2/js/client.min.js"),Gi=Ce("https://js.braintreegateway.com/web/3.85.2/js/paypal-checkout.min.js"),mt=T(()=>o(void 0,null,function*(){yield Promise.all([ji,Gi]);let a=yield c(_i,{}),e=window.braintree,t=yield e.client.create({authorization:a.clientid});return{braintree:e,braintreeClient:t}})),qi=T(()=>o(void 0,null,function*(){let{braintree:a,braintreeClient:e}=yield mt(),t=yield a.paypalCheckout.create({client:e});yield t.loadPayPalSDK({vault:!0,currency:"CAD",intent:"capture"});let i=window.paypal;return{paypalCheckout:t,paypal:i}})),Vi=T(()=>o(void 0,null,function*(){let{braintree:a,braintreeClient:e}=yield mt();return yield a.dataCollector.create({client:e})}));function pt(a){return o(this,null,function*(){let e="823279137640415263",t=location.protocol+"//"+location.host+location.pathname;a.addClass("mod-disabled"),location.href=`https://discord.com/api/oauth2/authorize?client_id=${e}&redirect_uri=${encodeURIComponent(t)}&response_type=code&scope=identify`})}function ft(a){return o(this,null,function*(){a.addClass("mod-disabled");try{yield c(ki,{}),new St().open()}catch(e){new Mt(e).open()}a.removeClass("mod-disabled")})}var yt=class{constructor(e){this.value=!1;(this.el=e.createEl("span","checkbox-container")).addEventListener("click",()=>this.setValue(!this.value))}setValue(e){this.value=e,this.el.toggleClass("is-enabled",this.value)}getValue(){return this.value}},B=class{constructor(){this.containerEl=createDiv("modal-container");let e=this.bgEl=this.containerEl.createDiv("modal-bg");this.modalEl=this.containerEl.createDiv("modal");let t=this.modalEl.createDiv("modal-close-button");this.titleEl=this.modalEl.createDiv("modal-title"),this.contentEl=this.modalEl.createDiv("modal-content"),this.buttonContainerEl=this.modalEl.createDiv("modal-button-container"),t.addEventListener("click",this.close.bind(this)),e.addEventListener("click",this.close.bind(this))}setTitle(e){return this.titleEl.setText(e),this}open(){document.body.appendChild(this.containerEl),this.onOpen()}close(){this.onClose(),this.containerEl.detach()}onOpen(){}onClose(){}},_=class extends B{constructor(){super();let e=this.contentEl.createDiv("message-container");this.errorEl=e.createDiv("payment-error message mod-error"),this.hideError()}showError(e){let{errorEl:t}=this;e instanceof XMLHttpRequest&&(e=e.statusText),t.setText(e.toString()),t.show()}hideError(){let{errorEl:e}=this;e.hide(),e.setText("")}},S=class extends B{constructor(){super();this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Got it"}).addEventListener("click",this.close.bind(this))}},x=class{constructor(e,t){let i=this.containerEl=e.createDiv("payment-line");this.descEl=i.createSpan({cls:"payment-desc",text:t}),i.appendText(": "),this.amountEl=i.createSpan("payment-amount"),i.appendText(" USD")}setValues(e,t,i){let{containerEl:s,amountEl:u,descEl:m}=this;s.toggle(e),u.setText(t>=0?"$"+z(t):"-$"+z(-t)),String.isString(i)&&m.setText(i)}},Et=class{constructor(e){this.subtotal=new x(e,"Subtotal"),this.discount=new x(e,"Discount"),this.tax=new x(e,"Tax"),this.credit=new x(e,"Credit"),this.total=new x(e,"Total")}setValues(e){let{subtotal:t,desc:i,tax:s,taxDesc:u,discount:m,discountDesc:f,creditUsed:y,total:v}=e;this.discount.setValues(m!==0,-m,f),this.tax.setValues(s!==0,s,u),this.credit.setValues(y!==0,-y,"Credit"),t===v&&m===0&&s===0&&y===0?(this.subtotal.setValues(!1,0,"Subtotal"),this.total.setValues(!0,v,i)):(this.subtotal.setValues(!0,t,i),this.total.setValues(!0,v,"Total"))}},gt=class{constructor(e){this.total=new x(e,"Your credit"),this.gift=new x(e,"Credit to gift"),this.remaining=new x(e,"Remaining credit")}setValues(e){let{total:t,gift:i,remaining:s}=e;this.total.setValues(!0,t,"Your credit"),this.gift.setValues(!0,i,"Credit to gift"),this.remaining.setValues(!0,s,"Remaining credit")}},wt=class{constructor(e){let t=this.formEl=e.createEl("form","payment-form");this.cardEl=t.createEl("label").createDiv("card-element");let i=this.payEl=t.createEl("button","submit mod-cta");this.spinnerEl=i.createDiv("spinner hidden"),this.textEl=i.createSpan({cls:"button-text",text:"Pay"}),this.stripeBadgeEl=t.createEl("p","stripe-badge u-center-text"),this.stripeBadgeEl.createEl("img",{attr:{src:"images/stripe-badge.png",alt:"Powered by Stripe"}})}setUseCredit(e){this.stripeBadgeEl.toggle(!e),this.payEl.toggleClass("mod-no-card",e),this.payEl.setText(e?"Pay with credit":"Pay")}},O=class extends _{constructor(){super();let{contentEl:e}=this;this.createPayment(e);let t=this.paymentContainerEl=e.createDiv("payment-container"),i=this.summaryEl=t.createDiv("payment-summary");this.summary=new Et(i),this.stripeButton=new wt(t);let s=t.createEl("p","u-center-text");this.paypalButtonEl=s.createEl("span","paypal-button"),this.wechatButtonEl=s.createEl("img",{cls:"wechat-pay-button",attr:{src:"images/wechat-pay.png",alt:"Pay with Wechat Pay"}}),this.alipayButtonEl=s.createEl("img",{cls:"alipay-button",attr:{src:"images/alipay.png",alt:"Pay with Alipay"}}),this.oldPaypalButtonEl=s.createEl("img",{cls:"paypal-temp-button",attr:{src:"images/paypal-badge.svg",alt:"Pay with PayPal"}}),this.stripeButton.formEl.addEventListener("submit",this.onSubmit.bind(this)),this.wechatButtonEl.addEventListener("click",()=>this.pay("wechat")),this.alipayButtonEl.addEventListener("click",()=>this.pay("alipay")),this.oldPaypalButtonEl.addEventListener("click",()=>new Ht().open()),this.setLoading(!1)}createPayment(e){}onSubmit(e){e.preventDefault(),this.pay("card")}setPrices(e){let t=e.total===0;this.stripeButton.cardEl.toggle(!t),this.stripeButton.setUseCredit(t),this.summary.setValues(e)}onOpen(){super.onOpen(),ae().mount(this.stripeButton.cardEl)}onClose(){super.onClose(),ae().unmount()}updatePrice(){return o(this,null,function*(){this.hideError();try{let e=this.getPriceData(!1),t=yield c(ot,e);this.setPrices(t)}catch(e){this.showError(e)}})}pay(e){return o(this,null,function*(){this.hideError(),this.setLoading(!0);try{let t=this.getPriceData(!0),i=yield c(lt,Te({method:e},t));if(i.secret){let s;if(e==="card")s=yield W().confirmCardPayment(i.secret,{payment_method:{card:ae()}});else if(e==="wechat")s=yield W().confirmWechatPayPayment(i.secret,{payment_method_options:{wechat_pay:{client:"web"}}});else if(e==="alipay")s=yield W().confirmAlipayPayment(i.secret,{return_url:Ni});else throw"Please select payment method.";if(s.error)throw s.error.message;yield c(Pi,{intent_id:s.paymentIntent.id})}}catch(t){this.showError(t),this.setLoading(!1);return}this.setLoading(!1),this.afterPay()})}setLoading(e){this.stripeButton.payEl.toggleClass("mod-disabled",e),this.stripeButton.spinnerEl.toggleClass("hidden",!e),this.stripeButton.textEl.toggleClass("hidden",e)}setupPaypal(e){return o(this,null,function*(){})}},De=class{constructor(e,t){this.value=t,this.cardEl=e.createDiv("card u-center-text",i=>{i.createDiv("card-title",s=>{s.style.textAlign="left",s.appendText(t==="yearly"?"Yearly":"Monthly"),this.promoEl=s.createSpan({cls:"flair mod-pop",text:""})}),i.createDiv("card-description",s=>{s.createDiv({},u=>{u.style.float="right",this.perMonthEl=u.createEl("b",{text:"$-"}),u.appendText(" USD / month")}),s.createDiv({},u=>{u.style.float="left",this.perYearEl=u.createEl("b",{text:"$-"}),u.appendText(" USD / year")})})}),this.promoEl.hide()}setValues(e,t){this.perMonthEl.setText("$"+e),this.perYearEl.setText("$"+e*12),this.promoEl.setText(t),this.promoEl.toggle(!!t)}},Pe=class extends O{onOpen(){super.onOpen(),this.setCard(this.yearlyCard),this.setupPaypal(!0)}createPayment(e){let t=e.createDiv("card-container mod-horizontal"),i=this.yearlyCard=new De(t,"yearly"),s=this.monthlyCard=new De(t,"monthly");this.cards=[i,s],i.cardEl.addEventListener("click",()=>this.setCard(i)),s.cardEl.addEventListener("click",()=>this.setCard(s))}setCard(e){this.selectedCard&&this.selectedCard.cardEl.removeClass("is-selected"),this.selectedCard=e,e&&(e.cardEl.addClass("is-selected"),this.updatePrice())}setSubscriptionPrices(e){this.yearlyCard.setValues(e.yearly,e.yearlyPromo),this.monthlyCard.setValues(e.monthly,e.monthlyPromo)}onSubmit(e){e.preventDefault(),this.pay("card")}},bt=class extends Pe{constructor(e){super();this.setTitle("Choose a plan"),this.setSubscriptionPrices(e)}getPriceData(){return{type:"sync",variation:"",renew:this.selectedCard.value}}afterPay(){this.close(),new Ct().open()}},vt=class extends Pe{constructor(e){super();this.setTitle("Choose a plan"),this.setSubscriptionPrices(e)}createPayment(e){super.createPayment(e);let t=e.createEl("p");t.createEl("label",{cls:"input-label",text:"Number of sites"}),this.numSitesEl=t.createEl("input",{type:"number",attr:{placeholder:"Enter a number...",min:1,value:1}}),this.numSitesEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(){return{type:"publish",variation:this.numSitesEl.value,renew:this.selectedCard.value}}afterPay(){this.close(),new xt().open()}},Tt=class extends O{constructor(){super();this.currentSeats=0;this.setTitle("Commercial license"),this.containerEl.addClass("mod-commercial-license")}createPayment(e){super.createPayment(e),this.businessNameContainerEl=e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Business name"}),this.businessNameEl=t.createEl("input",{type:"text",placeholder:"Name of your business..."})}),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Seats"}),this.seatsEl=t.createEl("input",{type:"number",placeholder:"1",attr:{min:1,value:1}})}),this.autoRenewalContainerEl=e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Auto-renewal"}),this.autoRenewal=new yt(t)}),this.seatsEl.addEventListener("input",this.updatePrice.bind(this))}setStatus(e,t){return this.currentSeats=e,e===0?this.setTitle("Commercial license"):this.setTitle("Add seats"),this.businessNameContainerEl.toggle(e===0),this.autoRenewalContainerEl.toggle(e===0),this.autoRenewal.setValue(t),this}getPriceData(e){let{currentSeats:t}=this;if(e&&t===0&&!this.businessNameEl.value)throw"Please enter a business name.";let i=this.seatsEl.value;if(i==="")return null;let s=parseInt(i);if(isNaN(s)||s<=0)return null;let u=this.autoRenewal.getValue()?"yearly":"";return{type:"business",variation:(t+s).toString(),renew:u}}afterPay(){return o(this,null,function*(){let e=this.businessNameEl.value;if(e)try{yield c(Fi,{company:e})}catch(t){this.showError(t);return}window.location.reload()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Ct=class extends S{constructor(){super();this.setTitle("Successfully bought Obsidian Sync"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by using Obsidian Sync!"),jsx("p",null,"To learn more about how to use the in-app plugin to sync your vaults,",jsx("a",{href:"https://help.obsidian.md/Obsidian+Sync/Introduction+to+Obsidian+Sync",target:"_blank"},"here's a guide"),"."))}onClose(){super.onClose(),window.location.reload()}},xt=class extends S{constructor(){super();this.setTitle("Successfully bought Obsidian Publish"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by using Obsidian Publish!"),jsx("p",null,"To learn more about how to publish your notes",jsx("a",{href:"https://help.obsidian.md/Obsidian+Publish/Introduction+to+Obsidian+Publish",target:"_blank"},"here's a guide"),"."))}onClose(){super.onClose(),window.location.reload()}},ie=class{constructor(e,t,i,s,u){this.value=t,this.cardEl=e.createDiv("card",m=>{m.createDiv({cls:"card-title",text:i}),m.createDiv("card-description").appendChild(s),m.createDiv("button-container u-center-text").createEl("button","mod-cta",f=>{f.createEl("b",{text:"$"+u}),f.appendText(" USD one-time")})})}},Dt=class extends O{constructor(){super();this.currentCard=null;this.setTitle("Obsidian Catalyst"),this.containerEl.addClass("mod-personal-license"),this.paymentContainerEl.hide()}createPayment(e){e.createDiv("card-container mod-catalyst",t=>{let i=[this.insiderCard=new ie(t,"insider","Insider",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,jsx("b",{className:"u-pop"},'"Insider"')," badge in the community")),25),this.supporterCard=new ie(t,"supporter","Supporter",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,"Access to exclusive dev channel"),jsx("li",null,jsx("b",{className:"u-pop"},'"Supporter"')," badge in the community")),50),this.vipCard=new ie(t,"vip","VIP",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,"Access to exclusive dev channel"),jsx("li",null,jsx("b",{className:"u-pop"},'"VIP"')," badge in the community")),100)];for(let s of i)s.cardEl.addEventListener("click",()=>o(this,null,function*(){this.setCard(s)}))}),this.upgradeEl=this.contentEl.appendChild(jsx("div",{className:"u-muted"},jsx("p",null,"Please select a tier to upgrade. When upgrading you only need to pay the difference."))),this.upgradeEl.hide()}onOpen(){super.onOpen(),this.setupPaypal(!1)}setCard(e){this.paymentContainerEl.show(),this.currentCard&&this.currentCard.cardEl.removeClass("is-selected"),this.currentCard=e,e&&(e.cardEl.addClass("is-selected"),this.updatePrice())}setTier(e){e==="supporter"?(this.insiderCard.cardEl.hide(),this.supporterCard.cardEl.hide()):e==="insider"&&this.insiderCard.cardEl.hide(),e&&this.upgradeEl.show()}getPriceData(){let{currentCard:e}=this;return e?{type:"catalyst",variation:e.value,renew:""}:null}afterPay(){this.close(),new Lt().open()}},Lt=class extends B{constructor(){super();this.setTitle("Successfully bought Catalyst"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by upgrading to Catalyst!"),jsx("p",null,"To get insider builds, ",jsx("a",{href:"https://help.obsidian.md/Insider+builds",target:"_blank"},"here's a guide"),"."),jsx("p",null,"To claim your community badges:")),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Get Discord badge"},e=>{e.addEventListener("click",()=>pt(e))}),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Get forum badge"},e=>{e.addEventListener("click",()=>ft(e))})}onClose(){super.onClose(),window.location.reload()}},Pt=class extends B{constructor(){super();this.contentEl.createDiv("message-container").createDiv({cls:"message mod-success",text:"Successfully added badge for you!"}),this.setTitle("Added Discord badge"),this.contentEl.append(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent so we can pursue our vision."))}},Ft=class extends _{constructor(e){super();this.setTitle("Couldn't add Discord badge"),this.contentEl.append(jsx("p",null,"Please contact us for support or try again later. We're really sorry for the inconvenience!")),this.showError(e)}},St=class extends B{constructor(){super();this.contentEl.createDiv("message-container").createDiv({cls:"message mod-success",text:"Successfully added badge for you!"}),this.setTitle("Added forum badge"),this.contentEl.append(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent so we can pursue our vision."),jsx("p",null,'P.S. Your forum badge is not a "badge" in the forum system, but a shiny gold tag right next to your name in all of your posts. Hope that helps!'))}},Mt=class extends _{constructor(e){super();this.setTitle("Couldn't add forum badge"),this.contentEl.append(jsx("p",null,"Please contact us for support or try again later. We're really sorry for the inconvenience!")),this.showError(e)}},At=class extends O{constructor(){super();this.setTitle("Obsidian Unlimited"),this.summaryEl.hide()}createPayment(e){e.appendChild(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent, so we can pursue our vision.")),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Amount (USD)"}),this.donationEl=t.createEl("input",{type:"number",placeholder:"Pay what you want...",attr:{min:5,value:50,step:1}})}),this.donationEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(e){let t=this.donationEl.value;if(t==="")return null;let i=parseInt(t);return isNaN(i)||i<=0?null:{type:"donation",variation:(i*100).toString(),renew:""}}afterPay(){return o(this,null,function*(){window.location.reload()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Rt=class extends O{constructor(){super();this.setTitle("Obsidian Credit"),this.summaryEl.hide()}createPayment(e){e.appendChild(jsx("p",null,"Obsidian Credit can be used to buy all kinds of Obsidian licenses and services (Sync and Publish).")),e.appendChild(jsx("p",null,"You can also send your credit to friends and family as a gift.")),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Amount (USD)"}),this.amountEl=t.createEl("input",{type:"number",placeholder:"Credit amount",attr:{min:5,value:50,step:1}})}),this.amountEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(e){let t=this.amountEl.value;if(t==="")return null;let i=parseInt(t);return isNaN(i)||i<=0?null:{type:"credit",variation:(i*100).toString(),renew:""}}afterPay(){return o(this,null,function*(){new It().open()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},It=class extends S{constructor(){super();this.setTitle("Successfully bought Obsidian Credit"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by buying Obsidian Credit!"),jsx("p",null,"You can now purchase Obsidian Sync, Obsidian Publish, or any license with your credit. You can also gift it to others. "))}onClose(){super.onClose(),window.location.reload()}},kt=class extends _{constructor(){super();this.setTitle("Gift Obsidian Credit"),this.contentEl.appendChild(jsx("p",null,"Gift Obsidian Credit to friends and family so they can buy all things Obsidian!")),this.contentEl.appendChild(jsx("p",null,"It applies to Obsidian Sync, Obsidian Publish, commercial licenses, and Catalyst licenses.")),this.contentEl.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Gift amount"}),this.giftAmountEl=t.createEl("input",{type:"number",placeholder:"Gift amount",attr:{min:1,max:Math.floor(X/100),value:0,step:1}})}),this.contentEl.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Sender name"}),this.nameEl=t.createEl("input",{type:"text",placeholder:"Name you'd like the recipient to see",attr:{value:Yt}})}),this.contentEl.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Recipient email"}),this.emailEl=t.createEl("input",{type:"email",placeholder:"Recipient email..."})}),this.giftAmountEl.addEventListener("change",this.updateSummary.bind(this));let e=this.summaryEl=this.contentEl.createDiv("payment-summary");this.contentEl.createDiv("button-container u-center-text",t=>{t.createEl("button",{cls:"mod-cta",text:"Send gift"},i=>{i.onClickEvent(()=>o(this,null,function*(){this.hideError();let s=this.nameEl.value,u=this.emailEl.value,m=this.getGiftAmount();if(!s){this.showError("Please enter your name so we can let the recipient know who sent the gift.");return}if(!u){this.showError("Please enter email of the recipient so we can send the gift for you!");return}if(!u.contains("@")){this.showError("Please enter valid recipient email.");return}if(m<100){this.showError("You need to gift at least $1.");return}if(m>X){this.showError("You cannot gift more credit than you currently have.");return}try{yield c(Ui,{sender_name:s,recipient_email:u,amount:m}),window.location.reload()}catch(f){this.showError(f)}}))}),t.createEl("button",{text:"Cancel"}).addEventListener("click",this.close.bind(this))}),this.summary=new gt(e)}getGiftAmount(){return parseInt(this.giftAmountEl.value)*100}updateSummary(){let e=this.getGiftAmount(),t=X-e;if(t<0){this.showError("You cannot gift more credit than you currently have.");return}this.summary.setValues({total:X,gift:e,remaining:t})}onOpen(){super.onOpen(),this.updateSummary()}},Ht=class extends B{constructor(){super();this.setTitle("Pay with PayPal"),this.contentEl.appendChild(jsx(jsxFragment,null,jsx("p",null,"Paying with PayPal is currently a manual process, and we're working on automating it. Please do the following in order to get your payment processed:"),jsx("ol",{className:"u-pop"},jsx("li",null,jsx("span",{class:"mod-warning"},"Verify you're not paying a monthly fee.")," Because it's a manual process, we only accept yearly payments for Sync and Publish. Monthly payments will be refunded."),jsx("li",null,"Forward your PayPal receipt to ",jsx("a",{href:"mailto:support@obsidian.md"},"support@obsidian.md")," and specify what service you're purchasing.")),jsx("p",null,"Your payment should be processed within 3 business days."),jsx("p",null,"Thanks so much for your kind support! Obsidian couldn't have become what it is today without help from amazing people like you. Sorry for the trouble!"),jsx("p",{className:"u-center-text"},jsx("a",{href:"https://paypal.me/obsidianmd",target:"_blank"},jsx("img",{style:"width: 200px; background-color: #FFC439;border-radius: 24px;padding: 8px 40px;",src:"images/paypal-badge.png",alt:"Pay with PayPal"})))))}},Bt=class extends _{constructor(){super();this.setTitle("Apply for discount"),this.contentEl.append(jsx("p",null,"Please choose discount type you're applying for and enter your school or organization email. We will send an email to this email address to verify it."),jsx("p",{class:"u-muted u-small"},"Please note that if you already have early bird, discounts will not stack with early bird."),jsx("p",{class:"u-muted u-small"},"If you do not have an organization email, please contact us at ",jsx("a",{href:"mailto:support@obsidian.md"},"support@obsidian.md")," to provide other forms of verification, such as student ID card, transcript, or employee ID card."),jsx("p",null,jsx("label",null,jsx("span",{class:"input-label"},"Discount type"),jsx("label",null,jsx("input",{type:"radio",name:"apply-discount-type",value:"1",checked:!0}),"Education (student or faculty)"),"\xA0\xA0",jsx("label",null,jsx("input",{type:"radio",name:"apply-discount-type",value:"2"}),"Non-profit organization"))),jsx("p",null,jsx("label",null,jsx("span",{class:"input-label"},"School or organization email"),this.emailEl=jsx("input",{type:"email",placeholder:"Your email..."})))),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Send application"}).addEventListener("click",()=>o(this,null,function*(){this.hideError();let e=this.contentEl.find('input[name="apply-discount-type"]:checked').value,t=this.emailEl.value;if(!e){this.showError("Please select a discount type.");return}if(t===""||!t.contains("@")){this.showError("Please enter a valid organization email address.");return}try{yield c(Oi,{type:e,email:t}),this.close(),new _t().open()}catch(i){this.showError(i)}})),this.buttonContainerEl.createEl("button",{text:"Cancel"}).addEventListener("click",this.close.bind(this))}},_t=class extends S{constructor(){super();this.setTitle("Verify your email"),this.contentEl.append(jsx("p",null,"Thanks for applying for Obsidian discount!"),jsx("p",null,"We've sent an email to your organization email address to verify your email. Once you click on the link, the application will be submitted for review."),jsx("p",null,"If you don't see the email in a few minutes, please try checking your spam folder. You can try applying for a discount again."))}},Nt=class extends S{constructor(){super();this.setTitle("Organization email verified"),this.contentEl.append(jsx("p",null,"Thanks for verifying your organization email! We'll take a look at your application as soon as we can."),jsx("p",null,"You'll get an email update when your discount application is approved. Have a nice day!"))}},Ot=class extends S{constructor(e){super();this.setTitle("Your discount is active"),this.contentEl.append(jsx("p",null,"Your ",jsx("span",{class:"approved-discount-type"},e)," discount is approved!"),jsx("p",null,"You'll see the discount applied when you try to buy Obsidian Sync or Obsidian Publish. It's not applicable to Catalyst licenses, commercial licenses, or donations."))}},Ut=class extends S{constructor(){super();this.setTitle("Gift redeemed"),this.contentEl.append(jsx("p",null,"Your gift was successfully redeemed!"),jsx("p",null,'You should be able to see the credit in the "Obsidian Credit" section. You can use it to buy whatever you want, or even gift to others.'))}onClose(){super.onClose(),ht(),location.reload()}},Le=class extends _{constructor(e){super();this.setTitle("Gift not redeemed"),this.contentEl.append(jsx("p",null,"Unfortunately, we were unable to redeem your gift for you.")),this.showError(e)}},W=T(()=>window.Stripe(dt)),ae=T(()=>W().elements().create("card",{style:{base:{color:"#dcddde",iconColor:"#dcddde",fontFamily:"Inter, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#888888"}},invalid:{fontFamily:"Inter, sans-serif",color:"#fa755a",iconColor:"#fa755a"}}})),Yt="",X=0;ready(()=>{let a=fish(".login-form"),e=fish(".login-form .message.mod-error"),t=fish(".signup-form"),i=fish(".signup-form .message.mod-error"),s=fish(".welcome"),u=fish("#labeled-input-email"),m=fish("#labeled-input-password"),f=fish(".signup-name"),y=fish(".obsidian-signup-email"),v=fish(".signup-password"),M=fish(".welcome-name"),se=fish(".welcome-email"),jt=fish(".js-change-email"),Gt=fish(".modal-container.mod-change-email"),qt=fish(".change-email-new-email"),Vt=fish(".change-email-password"),$t=fish(".js-confirm-change-email"),A=fish(".modal-container.mod-change-email .message.mod-error"),Xt=fish(".js-change-name"),zt=fish(".modal-container.mod-change-name"),Wt=fish(".change-name-new-name"),Kt=fish(".js-confirm-change-name"),U=fish(".modal-container.mod-change-name .message.mod-error"),Qt=fish(".js-change-password"),Jt=fish(".modal-container.mod-change-password"),Zt=fish(".change-password-old-password"),en=fish(".change-password-new-password"),tn=fish(".js-confirm-change-password"),R=fish(".modal-container.mod-change-password .message.mod-error"),nn=fish(".js-delete-account"),an=fish(".modal-container.mod-delete-account"),sn=fish(".delete-account-password"),rn=fish(".delete-account-email"),ln=fish(".js-confirm-delete-account"),I=fish(".modal-container.mod-delete-account .message.mod-error"),Y=fish(".modal-container.mod-change-info-success"),on=fish(".js-logout"),Fe=fish(".card.mod-publish"),Se=fish(".card.mod-sync"),Me=fish(".publish-site-num"),Ae=fish(".publish-renew-site-num"),cn=fishAll(".publish-renewal-time"),un=fish(".publish-renew-info-renewing"),Re=fish(".publish-renew-info-not-renewing"),dn=fishAll(".js-view-payment-info"),hn=fishAll(".js-open-change-payment"),Ie=fish(".current-card-info"),ke=fish(".modal-container.mod-change-payment-method"),mn=fish(".modal-container.mod-change-payment-method .payment-form"),pn=fish(".js-change-number-of-publish-sites"),re=fish(".js-reduce-number-of-publish-sites"),He=fish(".js-change-publish-to-monthly"),Be=fish(".js-change-publish-to-yearly"),_e=fish(".setting-item-description.mod-publish-frequency"),Ne=fish(".publish-reduce-sites-num"),fn=fish(".js-update-reduce-sites"),Oe=fish(".js-stop-publish-auto-renewal"),yn=fish(".commercial-license-pitch"),En=fish(".existing-commercial-license"),C=fish(".commercial-license-key"),gn=fish(".commercial-license-company-name"),wn=fishAll(".commercial-license-seat-number"),Ue=fish(".card.mod-commercial-license"),bn=fish(".catalyst-tier"),Ye=fish(".catalyst-upgrade-button"),vn=fishAll(".js-close-modal, .modal-close-button, .modal-bg"),je=fish(".card.mod-catalyst"),E=fish(".loader-cube"),Tn=fish(".js-go-to-signup"),Cn=fish(".js-go-to-login"),xn=fish(".js-go-to-forgot-pass"),Ge=fish(".forgot-pass-form"),le=fish(".forgot-pass-form .message.mod-success"),k=fish(".forgot-pass-form .message.mod-error"),Dn=fish(".forgot-pass-email"),qe=fish(".reset-pass-form"),Ln=fish(".forgot-pass-email-container"),Pn=fish(".reset-pass-password"),oe=fish(".reset-pass-form .message.mod-success"),j=fish(".reset-pass-form .message.mod-error"),Fn=fish(".js-request-forgot"),ce=null,Sn=fish(".js-upgrade-publish"),Mn=fish(".modal-container.mod-publish-reduce-sites"),An=fish(".modal-container.mod-view-payment-method"),Rn=fish(".js-open-unlimited"),In=fish(".obsidian-credit-amount"),kn=fish(".donation-amount"),Hn=fishAll(".modal-container"),Bn=fish(".js-upgrade-sync"),ue=fish(".js-change-sync-to-monthly"),de=fish(".js-change-sync-to-yearly"),he=fish(".js-stop-sync-auto-renewal"),_n=fishAll(".sync-renewal-time"),Ve=fish(".sync-renew-info-renewing"),me=fish(".sync-renew-info-not-renewing"),$e=fish(".setting-item-description.mod-sync-frequency"),Nn=fishAll(".commercial-renewal-time"),pe=fish(".js-resume-commercial-auto-renewal"),K=fish(".js-stop-commercial-auto-renewal"),fe=fish(".commercial-renew-info-renewing"),Q=fish(".commercial-renew-info-not-renewing"),On=fishAll(".commercial-license-expiry-date"),Un=fishAll(".checkbox-container"),Yn=fishAll(".claim-discord-badge-button"),jn=fishAll(".claim-forum-badge-button"),Gn=fish(".js-commercial-license-change-seat"),qn=fish(".js-commercial-license-reduce-seat"),Vn=fish(".modal-container.mod-commercial-license-reduce-seats"),$n=fish(".commercial-license-reduce-seat-input"),Xn=fish(".js-update-reduce-seats"),H=fish(".modal-container.mod-commercial-license-reduce-seats .payment-error"),ye={monthly:10,yearly:8,yearlyPromo:"20% off compared to monthly"},Ee={monthly:20,yearly:16,yearlyPromo:"20% off compared to monthly"},ge=T(()=>new Dt),zn=T(()=>new bt(ye)),Xe=T(()=>new vt(Ee)),ze=T(()=>new Tt),Wn=T(()=>new At),Kn=T(()=>new Rt),J="",Z=!1,We=null,Ke=null,D=!1,L=null,Qn=W(),we=ae(),G=null,ee=null,N=()=>{if(D){window.location.reload();return}we.unmount(),Hn.forEach(n=>n.hide()),D=!1},b=P.decodeUrlQuery(V);if(b.mode&&b.mode==="signup")xe(),E.hide(),t.show(),Z=!0;else if(b.mode&&b.mode==="forgotpass")xe(),E.hide(),Ge.show(),Z=!0;else if(b.hasOwnProperty("forgetpw")&&b.id&&b.key)xe(),We=b.id,Ke=b.key,E.hide(),qe.show(),Z=!0;else if(b.stripe&&b.stripe==="complete"){let n=b.session}else b.discount&&(b.discount==="verified"?new Nt().open():b.discount==="approved"&&b.type&&new Ot(b.type).open());G=P.decodeUrlQuery($),G.code?o(void 0,null,function*(){try{yield c(Ii,{code:G.code}),new Pt().open()}catch(n){new Ft(n).open()}}):G.giftcode&&(ee=G.giftcode);let Jn=n=>o(void 0,null,function*(){try{yield c(ct,{code:n}),new Ut().open()}catch(r){new Le(r).open()}}),Zn=()=>o(void 0,null,function*(){let n;try{n=yield c(yi,{})}catch(r){Z||(E.hide(),a.show(),ee&&(e.setText("Please log in or sign up to redeem your gift."),e.show()));return}if(Yt=n.name,M.setText(n.name),se.setText(n.email),n.donation&&kn.setText(z(n.donation)),t.hide(),E.hide(),s.show(),n.license&&(J=n.license),J?(je.addClass("is-active"),bn.setText(n.license),ge().setTier(J),J!=="vip"&&(Ye.addEventListener("click",()=>{ge().open()}),Ye.show())):je.addEventListener("click",()=>{ge().open()}),X=n.credit,fish(".js-gift-credit").toggle(n.credit!==0),In.setText(z(n.credit)),n.discount){let{status:r,type:d,expiry_ts:l}=n.discount,p=fish(".setting-item.mod-discount .setting-item-description"),g=fish(".setting-item.mod-discount .setting-item-control a");r==="submitted"?(p.setText("You have submitted your school or organization email, but have not completed email verification yet. Please check your email for a link to verify your email address."),g.hide()):r==="verified"?(p.setText("Your discount application has been submitted for review. Thanks for your patience!"),g.hide()):r==="approved"&&(p.setText(`Your ${d} discount currently gives you 40% off the regular price of Obsidian Sync and Publish. Your discount will expire on ${new Date(l).toLocaleDateString()}.`),g.setText("Renew"))}ee&&Jn(ee)}),ei=()=>o(void 0,null,function*(){let n=yield c(Li,{});if(n.business&&n.business.expiry>=Date.now()){L=n.business,C.setText(L.key),gn.setText(L.company);let r=L.seats,d=r===1?"1 seat":r+" seats";wn.forEach(l=>l.setText(d)),On.forEach(l=>l.setText(new Date(L.expiry).toLocaleDateString())),yn.hide(),En.show()}else Ue.addEventListener("click",()=>ze().setStatus(0,!0).open());if(n.publish){let{sites:r,renew:d,renew_sites:l,expiry_ts:p,earlybird:g}=n.publish;if(p>=Date.now()){if(Fe.addClass("is-active"),r===1?Me.setText("1 site"):Me.setText(`${r} sites`),l===1?(Ae.setText("1 site"),re.hide()):(Ae.setText(`${l} sites`),re.show()),p){let q=new Date(p);cn.forEach(te=>te.setText(`on ${q.toLocaleDateString()}`))}Re.hide();let w=document.createDocumentFragment();d==="yearly"?(Be.hide(),w.createSpan({text:"You're currently on a "}),w.createSpan({cls:"u-pop",text:"yearly"}),w.createSpan({text:" plan."})):d==="monthly"?(He.hide(),w.createSpan({text:"You're currently on a "}),w.createSpan({cls:"u-pop",text:"monthly"}),w.createSpan({text:" plan."})):d===""&&(Oe.hide(),Re.show(),un.hide(),w.createSpan({text:"You're not currently being renewed."})),_e.empty(),_e.appendChild(w),Ne.value=r}g===!0&&(Ee.yearly/=2,Ee.monthly/=2,Fe.addClass("is-early-bird"))}if(n.sync){let{renew:r,expiry_ts:d,earlybird:l}=n.sync;if(d>=Date.now()){if(Se.addClass("is-active"),d){let g=new Date(d);_n.forEach(w=>w.setText(`on ${g.toLocaleDateString()}`))}me.hide(),r==="yearly"||(r==="monthly"?ue.hide():r===""&&(he.hide(),me.show(),Ve.hide()));let p=document.createDocumentFragment();r==="yearly"?(de.hide(),p.createSpan({text:"You're currently on a "}),p.createSpan({cls:"u-pop",text:"yearly"}),p.createSpan({text:" plan."})):r==="monthly"?(ue.hide(),p.createSpan({text:"You're currently on a "}),p.createSpan({cls:"u-pop",text:"monthly"}),p.createSpan({text:" plan."})):r===""&&(he.hide(),me.show(),Ve.hide(),p.createSpan({text:"You're not currently being renewed."})),$e.empty(),$e.appendChild(p)}l===!0&&(ye.yearly/=2,ye.monthly/=2,Se.addClass("is-early-bird"))}if(n.business){let{renew:r,expiry:d}=n.business;if(d>=Date.now()){if(Ue.addClass("is-active"),d){let l=new Date(d);Nn.forEach(p=>p.setText(`on ${l.toLocaleDateString()}`))}Q.hide(),r==="yearly"?(pe.hide(),K.show(),Q.hide(),fe.show()):r===""&&(pe.show(),K.hide(),Q.show(),fe.hide()),r==="yearly"?de.hide():r===""&&(K.hide(),Q.show(),fe.hide())}}}),ti=()=>o(void 0,null,function*(){let n=yield c(Yi,{}),r=fish(".setting-item.mod-gift-history"),d=r.find(".setting-item-description");if(!(!n||n.length===0))for(let l of n){let p=`You sent $${z(l.amount)} to "${l.email}" on ${new Date(l.ts).toLocaleDateString()}.`;d.createEl("p",{text:p},g=>{if(g.createEl("br"),l.redeemed){let w=l.sender_id===l.redeemed_by_id?"cancelled":"redeemed";g.createEl("span",{text:`Your gift has been ${w} on ${new Date(l.redeemed_ts).toLocaleDateString()}.`})}else g.createEl("span",{text:"Waiting for recipient to redeem gift. "}),g.createEl("a",{cls:"landing-link",text:"Cancel this gift",href:"#"},w=>w.addEventListener("click",q=>o(void 0,null,function*(){if(q.preventDefault(),!!confirm("Are you sure you want to cancel this gift? Your credits will be refunded, and the recipient will no longer be able to redeem it."))try{yield c(ct,{code:l.redeem_code}),location.reload()}catch(ve){new Le(ve).open()}})))}),r.show()}}),ni=()=>o(void 0,null,function*(){e.hide(),a.hide(),E.show();let n=u.value,r=m.value,d=!1;if(n===""?(e.setText("Email cannot be empty."),d=!0):n.indexOf("@")===-1?(e.setText("Email is not valid."),d=!0):r===""&&(e.setText("Password cannot be empty."),d=!0),d){a.show(),E.hide(),e.show();return}try{yield c(Ei,{email:u.value,password:m.value}),window.location.reload()}catch(l){a.show(),E.hide(),l==="Login failed"&&(e.setText("Login failed, please double check your email and password."),e.show())}}),ii=()=>o(void 0,null,function*(){i.hide(),t.hide(),E.show();let n=f.value,r=y.value,d=v.value,l=!1;if(n===""?(i.setText("Name cannot be empty."),l=!0):r===""?(i.setText("Email cannot be empty."),l=!0):r.indexOf("@")===-1?(i.setText("Email is not valid."),l=!0):d===""&&(i.setText("Password cannot be empty."),l=!0),l){i.show(),t.show(),E.hide();return}try{yield c(gi,{name:n,email:r,password:d}),window.location.reload()}catch(p){t.show(),E.hide(),p==="Invalid email address"?i.setText("The email address you entered was invalid."):p==="Already signed up"&&i.setText("Seems like you already have an account! Please log in."),i.show()}}),ai=()=>o(void 0,null,function*(){k.hide(),le.hide();let n=Dn.value;if(n){if(n.indexOf("@")===-1){k.setText('Email address is not valid and must contain "@".'),k.show();return}}else{k.setText("Please fill out your email."),k.show();return}E.show();try{yield c(bi,{email:n,captcha:"captcha"}),le.setText(`We have sent an email to ${n} to reset your password.`),le.show(),Ln.hide(),Fn.hide(),E.hide()}catch(r){k.setText("Something went wrong, please try again."),k.show(),E.hide()}}),si=()=>o(void 0,null,function*(){oe.hide(),j.hide();let n=Pn.value;if(!n){j.setText("Please set a new password."),j.show();return}try{yield c(vi,{password:n,id:We,key:Ke}),oe.innerHTML='Your password has been successfully set. <a href="/account">Log in</a>',oe.show()}catch(r){j.setText("Something went wrong, please try again."),j.show()}}),ri=()=>o(void 0,null,function*(){yield c(wi,{}),window.location.reload()});Zn(),ei(),ti(),on.addEventListener("click",()=>{ri()});let be=()=>{let n=C.getText();at(n),C.setText("Copied!"),C.addClass("is-copied"),C.removeEventListener("click",be),setTimeout(()=>{C.removeClass("is-copied"),C.setText(n),C.addEventListener("click",be)},500)};C.addEventListener("click",be),vn.forEach(n=>{n.addEventListener("click",N)}),Tn.addEventListener("click",()=>{location.hash="#mode=signup",location.reload()}),Cn.addEventListener("click",()=>{location.hash="",location.reload()}),xn.addEventListener("click",()=>{location.hash="#mode=forgotpass",location.reload()}),a.find("form").addEventListener("submit",n=>{n.preventDefault(),ni()}),t.find("form").addEventListener("submit",n=>{n.preventDefault(),ii()}),Ge.find("form").addEventListener("submit",n=>{n.preventDefault(),ai()}),qe.find("form").addEventListener("submit",n=>{n.preventDefault(),si()}),Sn.addEventListener("click",()=>Xe().open()),He.addEventListener("click",()=>o(void 0,null,function*(){yield c(F,{type:"publish",renew:"monthly"}),window.location.reload()})),Be.addEventListener("click",()=>o(void 0,null,function*(){yield c(F,{type:"publish",renew:"yearly"}),window.location.reload()})),Oe.addEventListener("click",()=>o(void 0,null,function*(){yield c(F,{type:"publish",renew:""}),window.location.reload()})),pn.addEventListener("click",()=>Xe().open()),re.addEventListener("click",()=>{Mn.show()}),fn.addEventListener("click",()=>o(void 0,null,function*(){let n=parseInt(Ne.value);yield c(Mi,{sites:n}),window.location.reload()})),dn.forEach(n=>n.addEventListener("click",()=>o(void 0,null,function*(){let r=yield c(Ai,{});r.info?Ie.setText(`You're currently using a ${r.info}.`):Ie.setText("You currently do not have any payment methods on file."),An.show()}))),hn.forEach(n=>n.addEventListener("click",()=>{ke.show(),ce=ke.find(".payment-error"),we.mount(".modal-container.mod-change-payment-method .card-element")})),mn.addEventListener("submit",n=>{n.preventDefault(),Qn.createPaymentMethod({type:"card",card:we}).then(r=>o(void 0,null,function*(){r.paymentMethod&&r.paymentMethod.id?(yield c(Ri,{payment_method_id:r.paymentMethod.id}),window.location.reload()):(ce.setText("Could not update your payment method."),ce.show())}))}),Rn.addEventListener("click",()=>{Wn().open()}),fish(".js-add-credit").onClickEvent(()=>{Kn().open()}),fish(".js-gift-credit").onClickEvent(()=>{new kt().open()}),Bn.addEventListener("click",()=>zn().open()),ue.addEventListener("click",()=>o(void 0,null,function*(){yield c(F,{type:"sync",renew:"monthly"}),window.location.reload()})),de.addEventListener("click",()=>o(void 0,null,function*(){yield c(F,{type:"sync",renew:"yearly"}),window.location.reload()})),he.addEventListener("click",()=>o(void 0,null,function*(){yield c(F,{type:"sync",renew:""}),window.location.reload()})),K.addEventListener("click",()=>o(void 0,null,function*(){yield c(F,{type:"business",renew:""}),window.location.reload()})),pe.addEventListener("click",()=>o(void 0,null,function*(){yield c(F,{type:"business",renew:"yearly"}),window.location.reload()})),Un.forEach(n=>{n.addEventListener("click",()=>{n.hasClass("is-enabled")?n.removeClass("is-enabled"):n.addClass("is-enabled")})}),Yn.forEach(n=>n.addEventListener("click",()=>pt(n))),jn.forEach(n=>n.addEventListener("click",()=>ft(n))),jt.addEventListener("click",()=>{Gt.show()}),$t.addEventListener("click",()=>o(void 0,null,function*(){A.hide();let n=qt.value,r=Vt.value;if(n===""){A.setText("New email cannot be empty."),A.show();return}if(r===""){A.setText("Password cannot be empty."),A.show();return}try{yield c(Ci,{password:r,email:n}),N(),D=!0,Y.show()}catch(d){A.setText(d),A.show()}})),Xt.addEventListener("click",()=>{zt.show()}),Kt.addEventListener("click",()=>o(void 0,null,function*(){U.hide();let n=Wt.value;if(n===""){U.setText("New name cannot be empty."),U.show();return}try{yield c(Ti,{name:n}),N(),D=!0,Y.show()}catch(r){U.setText(r),U.show()}})),Qt.addEventListener("click",()=>{Jt.show()}),tn.addEventListener("click",()=>o(void 0,null,function*(){R.hide();let n=Zt.value,r=en.value;if(n===""){R.setText("Current password cannot be empty."),R.show();return}if(n===""){R.setText("New password cannot be empty."),R.show();return}try{yield c(xi,{old_password:n,new_password:r}),N(),D=!0,Y.show()}catch(d){R.setText(d),R.show()}})),nn.addEventListener("click",()=>{an.show()}),ln.addEventListener("click",()=>o(void 0,null,function*(){I.hide();let n=rn.value,r=sn.value;if(n===""){I.setText("Please enter your email to confirm account deletion."),I.show();return}if(r===""){I.setText("Please enter your password to confirm account deletion."),I.show();return}try{yield c(Di,{email:n,password:r}),N(),D=!0,Y.show()}catch(d){I.setText(d),I.show()}})),Gn.addEventListener("click",()=>{ze().setStatus(L.seats,!!L.renew).open()}),qn.addEventListener("click",()=>{Vn.show()}),Xn.addEventListener("click",()=>o(void 0,null,function*(){H.hide();let n=$n.valueAsNumber,r=L.seats;if(n===0){H.setText("The number of seats to remove cannot be 0."),H.show();return}let d=r-n;if(d<0){let l=r===1?"1 seat":r+" seats";H.setText("You currently have "+l+" and cannot remove more seats than that."),H.show();return}try{yield c(Si,{seats:d}),N(),D=!0,Y.show()}catch(l){H.setText(l),H.show()}}));let Qe="",Je="stripe",Ze=fish(".modal-container.mod-invoice-list");fishAll(".js-view-invoices").forEach(n=>n.addEventListener("click",()=>o(void 0,null,function*(){E.show(),s.hide();let r=yield c(Hi,{});E.hide(),s.show(),Ze.show();let d=Ze.find(".invoice-list");d.empty();for(let l of r)d.createDiv({cls:"invoice-item setting-item"},p=>{p.createDiv({cls:"setting-item-info"},g=>{g.createDiv({text:l.description,cls:"setting-item-name"}),g.createDiv({text:new Date(l.created).toLocaleString(),cls:"setting-item-description"})}),p.createDiv({cls:"setting-item-control mod-vertical"},g=>{g.createEl("button",{cls:"mod-cta",text:"View"},w=>{w.addEventListener("click",()=>{let q=(l.amount/100).toFixed(2),te=(l.refunded/100).toFixed(2),ve=((l.amount-l.refunded)/100).toFixed(2),li=l.refunded!==0,et=localStorage.getItem("billing-info");fish(".invoice-date").setText(new Date(l.created).toLocaleString()),fish(".invoice-number-title").setText(l.receipt_number||l.id),fish(".invoice-number").setText(l.receipt_number||l.id),fish(".invoice-description").setText(l.description),fish(".invoice-amount").setText(q),li?(fish(".invoice-box .item.mod-refund").show(),fish(".invoice-refund-amount").setText(te)):fish(".invoice-box .item.mod-refund").hide(),fish(".invoice-total").setText(ve),et&&fish(".billing-info").setText(et),fish(".billing-info").addEventListener("input",()=>{let oi=fish(".billing-info").getText();localStorage.setItem("billing-info",oi)}),fish(".modal-container.mod-invoice-detail").show()})}),l.refundable&&g.createEl("a",{text:"Get refund"},w=>{w.addEventListener("click",()=>{Qe=l.id,Je=l.type,fish(".modal-container.mod-confirm-refund").show()})})})})}))),fish(".js-confirm-refund").addEventListener("click",()=>o(void 0,null,function*(){fish(".modal-container.mod-invoice-list").hide(),fish(".modal-container.mod-confirm-refund").hide(),E.show(),s.hide();try{yield c(Bi,{charge:Qe,type:Je}),D=!0,fish(".modal-container.mod-refund-success").show()}catch(n){fish(".refund-failed-reason").setText(n),fish(".modal-container.mod-refund-failed").show()}E.hide(),s.show()})),fish(".js-apply-for-discount").addEventListener("click",()=>new Bt().open())});})();
