(()=>{var ui=Object.defineProperty,di=Object.defineProperties;var hi=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var pi=Object.prototype.hasOwnProperty,mi=Object.prototype.propertyIsEnumerable;var st=(a,e,t)=>e in a?ui(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,Te=(a,e)=>{for(var t in e||(e={}))pi.call(e,t)&&st(a,t,e[t]);if(at)for(var t of at(e))mi.call(e,t)&&st(a,t,e[t]);return a},rt=(a,e)=>di(a,hi(e));var l=(a,e,t)=>new Promise((i,s)=>{var u=g=>{try{p(t.next(g))}catch(v){s(v)}},f=g=>{try{p(t.throw(g))}catch(v){s(v)}},p=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,f);p((t=t.apply(a,e)).next())});function Ce(a){if(!navigator.clipboard||!navigator.permissions){let e=document.createElement("textarea");e.value=a,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e);try{e.focus(),e.select(),document.execCommand("copy")}catch(t){}document.body.removeChild(e);return}navigator.clipboard.writeText(a)}var Ki=window.requestIdleCallback;var Qi=/bot|crawl|spider/i.test(navigator.userAgent);var fi=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){fi={passive:!1}}}))}catch(a){}function yi(a){return new Promise((e,t)=>{let i=document.createElement("script");i.type="text/javascript",i.src=a,i.addEventListener("load",()=>e(i)),i.addEventListener("error",s=>t(s)),document.body.appendChild(i)})}function xe(a,e){let t=!1,i=null;return{get loaded(){return t},get promise(){if(t)return Promise.resolve();if(!i){e&&e.before&&e.before();let s=yi(a);s.catch(u=>{u.detach(),i=null}),i=s.then(()=>{t=!0,i=null,e&&e.after&&e.after()})}return i},then(s){return t?s():this.promise.then(s)}}}var lt=new Map;for(let a of"a abbr acronym b bdi bdo big br button canvas cite code data del dfn em embed i iframe img input ins kbd label map mark meter noscript object outputpicture progress q ruby s samp select small span strong sub sup svg textarea time u tt var video wbr".split(" "))lt.set(a,!0);for(let a of"address article aside blockquote details dialog dd div dl dt fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hgroup hr li main nav ol p pre ul".split(" "))lt.set(a,!1);function T(a){let e,t=!1;return()=>(t||(e=a(),t=!0),e)}var F=class{static encodeUrlQuery(e){if(!e)return"";let t=[];for(let i in e)e.hasOwnProperty(i)&&e[i]&&(e[i]===!0?t.push(encodeURIComponent(i)):t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i])));return t.join("&")}static decodeUrlQuery(e){let t={};if(!e||e.trim()==="")return t;let i=e.split("&");for(let s=0;s<i.length;s++){let u=i[s].split("=");if(u.length>=1&&u[0]){let f=decodeURIComponent(u[0]);u.length===2?t[f]=decodeURIComponent(u[1]):t[f]=""}}return t}static decodeUrl(e){e||(e="");let t=e.split("#"),i=t.length>1?t[1]:"",s=t[0].split("?"),u=s.length>1?s[1]:"";return{path:s[0],query:F.decodeUrlQuery(u),hash:F.decodeUrlQuery(i)}}static addQuery(e,t){return e+(e.contains("?")?"&":"?")+F.encodeUrlQuery(t)}};function ot(a){let e=[];for(let t=0;t<a;t++)e.push((Math.random()*16|0).toString(16));return e.join("")}function ne(a,e,t){return"https://raw.githubusercontent.com/"+a+"/"+(t||"HEAD")+"/"+e}function c(a,e){return l(this,null,function*(){let t;try{t=yield ajaxPromise({method:"POST",url:a,data:e})}catch(i){throw i.error?i.error:i}if(t=JSON.parse(t),t.error)throw t.error;return t})}var sa=ne("obsidianmd/obsidian-releases","community-plugins.json");var ra=ne("obsidianmd/obsidian-releases","community-plugin-stats.json");var la=ne("obsidianmd/obsidian-releases","community-css-themes.json");var dt=location.host.startsWith("127.0.0.1")||location.host.startsWith("localhost"),h="https://api.obsidian.md";dt&&(h="http://127.0.0.1:3000");var Ei=h+"/user/info",gi=h+"/user/signin",wi=h+"/user/signup",bi=h+"/user/signout",vi=h+"/user/forgetpass",Ti=h+"/user/resetpass",Ci=h+"/user/changename",xi=h+"/user/changeemail",Di=h+"/user/changepass",Li=h+"/user/deleteaccount",Pi=h+"/subscription/list",ct=h+"/subscription/pay",Fi=h+"/subscription/stripe/end",ut=h+"/subscription/price",Si=h+"/subscription/business/rename",Mi=h+"/subscription/business/reduce",S=h+"/subscription/renew",Ai=h+"/subscription/publish/reduce",Ri=h+"/subscription/paymentmethod",ki=h+"/subscription/stripe/paymentmethod",Ii=h+"/subscription/role/discord",Hi=h+"/subscription/role/forum",Bi=h+"/subscription/invoice/list",Oi=h+"/subscription/invoice/refund",Ni=h+"/subscription/paypal/clientid",_i=h+"/subscription/stripe/finish",Ui=h+"/user/discount/apply",Yi=h+"/user/gift/create",ji=h+"/user/gift/list",Gi=h+"/user/gift/info",ht=h+"/user/gift/redeem",pt="pk_live_vqeOYADfYPpqKDT5FtAqCNBP00a9WEhYa6";dt&&(pt="pk_test_y7CBP7qLG6kSU9sdcHV5S2db0052OC4wR8");function De(){history.pushState?history.pushState("",document.title,window.location.pathname+window.location.search):location.hash=""}function N(a){let e=(a/100).toFixed(2).toString().toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}var V=location.hash;V&&V.length>1&&(V=V.substr(1));var X=location.search;X&&X.length>1&&(X=X.substr(1));var mt=()=>{location.search&&history.replaceState(null,null,location.pathname)};location.search.includes("giftcode")||mt();var qi=xe("https://js.braintreegateway.com/web/3.85.2/js/client.min.js"),$i=xe("https://js.braintreegateway.com/web/3.85.2/js/paypal-checkout.min.js"),ft=T(()=>l(void 0,null,function*(){yield Promise.all([qi,$i]);let a=yield c(Ni,{}),e=window.braintree,t=yield e.client.create({authorization:a.clientid});return{braintree:e,braintreeClient:t}})),Vi=T(()=>l(void 0,null,function*(){let{braintree:a,braintreeClient:e}=yield ft(),t=yield a.paypalCheckout.create({client:e});yield t.loadPayPalSDK({vault:!0,currency:"CAD",intent:"capture"});let i=window.paypal;return{paypalCheckout:t,paypal:i}})),Xi=T(()=>l(void 0,null,function*(){let{braintree:a,braintreeClient:e}=yield ft();return yield a.dataCollector.create({client:e})}));function yt(a){return l(this,null,function*(){let e="823279137640415263",t=location.protocol+"//"+location.host+location.pathname;a.addClass("mod-disabled"),location.href=`https://discord.com/api/oauth2/authorize?client_id=${e}&redirect_uri=${encodeURIComponent(t)}&response_type=code&scope=identify`})}function Et(a){return l(this,null,function*(){a.addClass("mod-disabled");try{yield c(Hi,{}),new At().open()}catch(e){new Rt(e).open()}a.removeClass("mod-disabled")})}var gt=class{constructor(e){this.value=!1;(this.el=e.createEl("span","checkbox-container")).addEventListener("click",()=>this.setValue(!this.value))}setValue(e){this.value=e,this.el.toggleClass("is-enabled",this.value)}getValue(){return this.value}},_=class{constructor(){this.containerEl=createDiv("modal-container");let e=this.bgEl=this.containerEl.createDiv("modal-bg");this.modalEl=this.containerEl.createDiv("modal");let t=this.modalEl.createDiv("modal-close-button");this.titleEl=this.modalEl.createDiv("modal-title"),this.contentEl=this.modalEl.createDiv("modal-content"),this.buttonContainerEl=this.modalEl.createDiv("modal-button-container"),t.addEventListener("click",this.close.bind(this)),e.addEventListener("click",this.close.bind(this))}setTitle(e){return this.titleEl.setText(e),this}open(){document.body.appendChild(this.containerEl),this.onOpen()}close(){this.onClose(),this.containerEl.detach()}onOpen(){}onClose(){}},M=class extends _{constructor(){super();let e=this.contentEl.createDiv("message-container");this.errorEl=e.createDiv("payment-error message mod-error"),this.hideError()}showError(e){let{errorEl:t}=this;e instanceof XMLHttpRequest&&(e=e.statusText),t.setText(e.toString()),t.show()}hideError(){let{errorEl:e}=this;e.hide(),e.setText("")}},D=class extends _{constructor(){super();this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Got it"}).addEventListener("click",this.close.bind(this))}},x=class{constructor(e,t){let i=this.containerEl=e.createDiv("payment-line");this.descEl=i.createSpan({cls:"payment-desc",text:t}),i.appendText(": "),this.amountEl=i.createSpan("payment-amount"),i.appendText(" USD")}setValues(e,t,i){let{containerEl:s,amountEl:u,descEl:f}=this;s.toggle(e),u.setText(t>=0?"$"+N(t):"-$"+N(-t)),String.isString(i)&&f.setText(i)}},wt=class{constructor(e){this.subtotal=new x(e,"Subtotal"),this.discount=new x(e,"Discount"),this.tax=new x(e,"Tax"),this.credit=new x(e,"Credit"),this.total=new x(e,"Total")}setValues(e){let{subtotal:t,desc:i,tax:s,taxDesc:u,discount:f,discountDesc:p,creditUsed:g,total:v}=e;this.discount.setValues(f!==0,-f,p),this.tax.setValues(s!==0,s,u),this.credit.setValues(g!==0,-g,"Credit"),t===v&&f===0&&s===0&&g===0?(this.subtotal.setValues(!1,0,"Subtotal"),this.total.setValues(!0,v,i)):(this.subtotal.setValues(!0,t,i),this.total.setValues(!0,v,"Total"))}},bt=class{constructor(e){this.total=new x(e,"Your credit"),this.gift=new x(e,"Credit to gift"),this.remaining=new x(e,"Remaining credit")}setValues(e){let{total:t,gift:i,remaining:s}=e;this.total.setValues(!0,t,"Your credit"),this.gift.setValues(!0,i,"Credit to gift"),this.remaining.setValues(!0,s,"Remaining credit")}},vt=class{constructor(e){let t=this.formEl=e.createEl("form","payment-form");this.cardEl=t.createEl("label").createDiv("card-element");let i=this.payEl=t.createEl("button","submit mod-cta");this.spinnerEl=i.createDiv("spinner hidden"),this.textEl=i.createSpan({cls:"button-text",text:"Pay"}),this.stripeBadgeEl=t.createEl("p","stripe-badge u-center-text"),this.stripeBadgeEl.createEl("img",{attr:{src:"images/stripe-badge.png",alt:"Powered by Stripe"}})}setUseCredit(e){this.stripeBadgeEl.toggle(!e),this.payEl.toggleClass("mod-no-card",e),this.payEl.setText(e?"Pay with credit":"Pay")}},Y=class extends M{constructor(){super();let{contentEl:e}=this;this.createPayment(e);let t=this.paymentContainerEl=e.createDiv("payment-container"),i=this.summaryEl=t.createDiv("payment-summary");this.summary=new wt(i),this.stripeButton=new vt(t);let s=t.createEl("p","u-center-text");this.paypalButtonEl=s.createEl("span","paypal-button"),this.wechatButtonEl=s.createEl("img",{cls:"wechat-pay-button",attr:{src:"images/wechat-pay.png",alt:"Pay with Wechat Pay"}}),this.alipayButtonEl=s.createEl("img",{cls:"alipay-button",attr:{src:"images/alipay.png",alt:"Pay with Alipay"}}),this.oldPaypalButtonEl=s.createEl("img",{cls:"paypal-temp-button",attr:{src:"images/paypal-badge.svg",alt:"Pay with PayPal"}}),this.stripeButton.formEl.addEventListener("submit",this.onSubmit.bind(this)),this.wechatButtonEl.addEventListener("click",()=>this.pay("wechat")),this.alipayButtonEl.addEventListener("click",()=>this.pay("alipay")),this.oldPaypalButtonEl.addEventListener("click",()=>new Ot().open()),this.setLoading(!1)}createPayment(e){}onSubmit(e){e.preventDefault(),this.pay("card")}setPrices(e){let t=e.total===0;this.stripeButton.cardEl.toggle(!t),this.stripeButton.setUseCredit(t),this.summary.setValues(e)}onOpen(){super.onOpen(),ae().mount(this.stripeButton.cardEl)}onClose(){super.onClose(),ae().unmount()}updatePrice(){return l(this,null,function*(){this.hideError();try{let e=this.getPriceData(!1),t=yield c(ut,e);this.setPrices(t)}catch(e){this.showError(e)}})}pay(e){return l(this,null,function*(){this.hideError(),this.setLoading(!0);try{let t=this.getPriceData(!0),i=yield c(ct,Te({method:e},t));if(i.secret){let s;if(e==="card")s=yield K().confirmCardPayment(i.secret,{payment_method:{card:ae()}});else if(e==="wechat")s=yield K().confirmWechatPayPayment(i.secret,{payment_method_options:{wechat_pay:{client:"web"}}});else if(e==="alipay")s=yield K().confirmAlipayPayment(i.secret,{return_url:_i});else throw"Please select payment method.";if(s.error)throw s.error.message;yield c(Fi,{intent_id:s.paymentIntent.id})}}catch(t){this.showError(t),this.setLoading(!1);return}this.setLoading(!1),this.afterPay()})}setLoading(e){this.stripeButton.payEl.toggleClass("mod-disabled",e),this.stripeButton.spinnerEl.toggleClass("hidden",!e),this.stripeButton.textEl.toggleClass("hidden",e)}setupPaypal(e){return l(this,null,function*(){})}},Le=class{constructor(e,t){this.value=t,this.cardEl=e.createDiv("card u-center-text",i=>{i.createDiv("card-title",s=>{s.style.textAlign="left",s.appendText(t==="yearly"?"Yearly":"Monthly"),this.promoEl=s.createSpan({cls:"flair mod-pop",text:""})}),i.createDiv("card-description",s=>{s.createDiv({},u=>{u.style.float="right",this.perMonthEl=u.createEl("b",{text:"$-"}),u.appendText(" USD / month")}),s.createDiv({},u=>{u.style.float="left",this.perYearEl=u.createEl("b",{text:"$-"}),u.appendText(" USD / year")})})}),this.promoEl.hide()}setValues(e,t){this.perMonthEl.setText("$"+e),this.perYearEl.setText("$"+e*12),this.promoEl.setText(t),this.promoEl.toggle(!!t)}},Fe=class extends Y{onOpen(){super.onOpen(),this.setCard(this.yearlyCard),this.setupPaypal(!0)}createPayment(e){let t=e.createDiv("card-container mod-horizontal"),i=this.yearlyCard=new Le(t,"yearly"),s=this.monthlyCard=new Le(t,"monthly");this.cards=[i,s],i.cardEl.addEventListener("click",()=>this.setCard(i)),s.cardEl.addEventListener("click",()=>this.setCard(s))}setCard(e){this.selectedCard&&this.selectedCard.cardEl.removeClass("is-selected"),this.selectedCard=e,e&&(e.cardEl.addClass("is-selected"),this.updatePrice())}setSubscriptionPrices(e){this.yearlyCard.setValues(e.yearly,e.yearlyPromo),this.monthlyCard.setValues(e.monthly,e.monthlyPromo)}onSubmit(e){e.preventDefault(),this.pay("card")}},Tt=class extends Fe{constructor(e){super();this.setTitle("Choose a plan"),this.setSubscriptionPrices(e)}getPriceData(){return{type:"sync",variation:"",renew:this.selectedCard.value}}afterPay(){this.close(),new Dt().open()}},Ct=class extends Fe{constructor(e){super();this.setTitle("Choose a plan"),this.setSubscriptionPrices(e)}createPayment(e){super.createPayment(e);let t=e.createEl("p");t.createEl("label",{cls:"input-label",text:"Number of sites"}),this.numSitesEl=t.createEl("input",{type:"number",attr:{placeholder:"Enter a number...",min:1,value:1}}),this.numSitesEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(){return{type:"publish",variation:this.numSitesEl.value,renew:this.selectedCard.value}}afterPay(){this.close(),new Lt().open()}},xt=class extends Y{constructor(){super();this.currentSeats=0;this.setTitle("Commercial license"),this.containerEl.addClass("mod-commercial-license")}createPayment(e){super.createPayment(e),this.businessNameContainerEl=e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Business name"}),this.businessNameEl=t.createEl("input",{type:"text",placeholder:"Name of your business..."})}),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Seats"}),this.seatsEl=t.createEl("input",{type:"number",placeholder:"1",attr:{min:1,value:1}})}),this.autoRenewalContainerEl=e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Auto-renewal"}),this.autoRenewal=new gt(t)}),this.seatsEl.addEventListener("input",this.updatePrice.bind(this))}setStatus(e,t){return this.currentSeats=e,e===0?this.setTitle("Commercial license"):this.setTitle("Add seats"),this.businessNameContainerEl.toggle(e===0),this.autoRenewalContainerEl.toggle(e===0),this.autoRenewal.setValue(t),this}getPriceData(e){let{currentSeats:t}=this;if(e&&t===0&&!this.businessNameEl.value)throw"Please enter a business name.";let i=this.seatsEl.value;if(i==="")return null;let s=parseInt(i);if(isNaN(s)||s<=0)return null;let u=this.autoRenewal.getValue()?"yearly":"";return{type:"business",variation:(t+s).toString(),renew:u}}afterPay(){return l(this,null,function*(){let e=this.businessNameEl.value;if(e)try{yield c(Si,{company:e})}catch(t){this.showError(t);return}window.location.reload()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Dt=class extends D{constructor(){super();this.setTitle("Successfully bought Obsidian Sync"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by using Obsidian Sync!"),jsx("p",null,"To learn more about how to use the in-app plugin to sync your vaults,",jsx("a",{href:"https://help.obsidian.md/Obsidian+Sync/Introduction+to+Obsidian+Sync",target:"_blank"},"here's a guide"),"."))}onClose(){super.onClose(),window.location.reload()}},Lt=class extends D{constructor(){super();this.setTitle("Successfully bought Obsidian Publish"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by using Obsidian Publish!"),jsx("p",null,"To learn more about how to publish your notes",jsx("a",{href:"https://help.obsidian.md/Obsidian+Publish/Introduction+to+Obsidian+Publish",target:"_blank"},"here's a guide"),"."))}onClose(){super.onClose(),window.location.reload()}},ie=class{constructor(e,t,i,s,u){this.value=t,this.cardEl=e.createDiv("card",f=>{f.createDiv({cls:"card-title",text:i}),f.createDiv("card-description").appendChild(s),f.createDiv("button-container u-center-text").createEl("button","mod-cta",p=>{p.createEl("b",{text:"$"+u}),p.appendText(" USD one-time")})})}},Pt=class extends Y{constructor(){super();this.currentCard=null;this.setTitle("Obsidian Catalyst"),this.containerEl.addClass("mod-personal-license"),this.paymentContainerEl.hide()}createPayment(e){e.createDiv("card-container mod-catalyst",t=>{let i=[this.insiderCard=new ie(t,"insider","Insider",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,jsx("b",{className:"u-pop"},'"Insider"')," badge in the community")),25),this.supporterCard=new ie(t,"supporter","Supporter",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,"Access to exclusive dev channel"),jsx("li",null,jsx("b",{className:"u-pop"},'"Supporter"')," badge in the community")),50),this.vipCard=new ie(t,"vip","VIP",jsx("ul",null,jsx("li",null,"Early access to insider builds"),jsx("li",null,"Access to exclusive dev channel"),jsx("li",null,jsx("b",{className:"u-pop"},'"VIP"')," badge in the community")),100)];for(let s of i)s.cardEl.addEventListener("click",()=>l(this,null,function*(){this.setCard(s)}))}),this.upgradeEl=this.contentEl.appendChild(jsx("div",{className:"u-muted"},jsx("p",null,"Please select a tier to upgrade. When upgrading you only need to pay the difference."))),this.upgradeEl.hide()}onOpen(){super.onOpen(),this.setupPaypal(!1)}setCard(e){this.paymentContainerEl.show(),this.currentCard&&this.currentCard.cardEl.removeClass("is-selected"),this.currentCard=e,e&&(e.cardEl.addClass("is-selected"),this.updatePrice())}setTier(e){e==="supporter"?(this.insiderCard.cardEl.hide(),this.supporterCard.cardEl.hide()):e==="insider"&&this.insiderCard.cardEl.hide(),e&&this.upgradeEl.show()}getPriceData(){let{currentCard:e}=this;return e?{type:"catalyst",variation:e.value,renew:""}:null}afterPay(){this.close(),new Ft().open()}},Ft=class extends _{constructor(){super();this.setTitle("Successfully bought Catalyst"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by upgrading to Catalyst!"),jsx("p",null,"To get insider builds, ",jsx("a",{href:"https://help.obsidian.md/Insider+builds",target:"_blank"},"here's a guide"),"."),jsx("p",null,"To claim your community badges:")),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Get Discord badge"},e=>{e.addEventListener("click",()=>yt(e))}),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Get forum badge"},e=>{e.addEventListener("click",()=>Et(e))})}onClose(){super.onClose(),window.location.reload()}},St=class extends _{constructor(){super();this.contentEl.createDiv("message-container").createDiv({cls:"message mod-success",text:"Successfully added badge for you!"}),this.setTitle("Added Discord badge"),this.contentEl.append(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent so we can pursue our vision."))}},Mt=class extends M{constructor(e){super();this.setTitle("Couldn't add Discord badge"),this.contentEl.append(jsx("p",null,"Please contact us for support or try again later. We're really sorry for the inconvenience!")),this.showError(e)}},At=class extends _{constructor(){super();this.contentEl.createDiv("message-container").createDiv({cls:"message mod-success",text:"Successfully added badge for you!"}),this.setTitle("Added forum badge"),this.contentEl.append(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent so we can pursue our vision."),jsx("p",null,'P.S. Your forum badge is not a "badge" in the forum system, but a shiny gold tag right next to your name in all of your posts. Hope that helps!'))}},Rt=class extends M{constructor(e){super();this.setTitle("Couldn't add forum badge"),this.contentEl.append(jsx("p",null,"Please contact us for support or try again later. We're really sorry for the inconvenience!")),this.showError(e)}},kt=class extends Y{constructor(){super();this.setTitle("Obsidian Unlimited"),this.summaryEl.hide()}createPayment(e){e.appendChild(jsx("p",null,"Thanks for supporting Obsidian! Your support helps us stay independent, so we can pursue our vision.")),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Amount (USD)"}),this.donationEl=t.createEl("input",{type:"number",placeholder:"Pay what you want...",attr:{min:5,value:50,step:1}})}),this.donationEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(e){let t=this.donationEl.value;if(t==="")return null;let i=parseInt(t);return isNaN(i)||i<=0?null:{type:"donation",variation:(i*100).toString(),renew:""}}afterPay(){return l(this,null,function*(){window.location.reload()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},It=class extends Y{constructor(){super();this.setTitle("Obsidian Credit"),this.summaryEl.hide()}createPayment(e){e.appendChild(jsx("p",null,"Obsidian Credit can be used to buy all kinds of Obsidian licenses and services (Sync and Publish).")),e.appendChild(jsx("p",null,"You can also send your credit to friends and family as a gift.")),e.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Amount (USD)"}),this.amountEl=t.createEl("input",{type:"number",placeholder:"Credit amount",attr:{min:5,value:50,step:1}})}),this.amountEl.addEventListener("change",this.updatePrice.bind(this))}getPriceData(e){let t=this.amountEl.value;if(t==="")return null;let i=parseInt(t);return isNaN(i)||i<=0?null:{type:"credit",variation:(i*100).toString(),renew:""}}afterPay(){return l(this,null,function*(){new Ht().open()})}onOpen(){super.onOpen(),this.updatePrice(),this.setupPaypal(!1)}},Ht=class extends D{constructor(){super();this.setTitle("Successfully bought Obsidian Credit"),this.contentEl.append(jsx("p",null,"Thanks so much for supporting us by buying Obsidian Credit!"),jsx("p",null,"You can now purchase Obsidian Sync, Obsidian Publish, or any license with your credit. You can also gift it to others. "))}onClose(){super.onClose(),window.location.reload()}},Bt=class extends M{constructor(){super();this.setTitle("Gift Obsidian Credit"),this.contentEl.appendChild(jsx("p",null,"Gift Obsidian Credit to friends and family so they can buy all things Obsidian!")),this.contentEl.appendChild(jsx("p",null,"It applies to Obsidian Sync, Obsidian Publish, commercial licenses, and Catalyst licenses.")),this.contentEl.createEl("p",{},t=>{t.createEl("label",{cls:"input-label",text:"Gift amount (USD)"}),this.giftAmountEl=t.createEl("input",{type:"number",placeholder:"Gift amount",attr:{min:1,max:Math.floor(z/100),value:5,step:1}})}),this.giftOptionsEl=this.contentEl.createDiv(),this.updateGiftOptions(!0),this.giftAmountEl.addEventListener("change",this.updateSummary.bind(this));let e=this.summaryEl=this.contentEl.createDiv("payment-summary");this.contentEl.createDiv("button-container u-center-text",t=>{t.createEl("button",{cls:"mod-cta",text:"Send gift"},i=>{i.onClickEvent(()=>l(this,null,function*(){this.hideError();let s=this.recipientEl.value,u=this.getGiftAmount(),f=this.emailOptionEl.checked;if(f){if(!s){this.showError("Please enter email of the recipient so we can send the gift for you!");return}if(!s.contains("@")){this.showError("Please enter valid recipient email.");return}}if(isNaN(u)){this.showError("Please enter a valid gift amount.");return}if(u<500){this.showError("You need to gift at least $5.");return}if(u>z){this.showError("You cannot gift more credit than you currently have.");return}try{let p=yield c(Yi,{should_email:this.emailOptionEl.checked,recipient:s,amount:u});f?window.location.reload():(this.close(),new Se(p.redeem_code,u,s).open())}catch(p){this.showError(p)}}))}),t.createEl("button",{text:"Cancel"}).addEventListener("click",this.close.bind(this))}),this.summary=new bt(e)}getGiftAmount(){return parseInt(this.giftAmountEl.value)*100}updateGiftOptions(e){this.giftOptionsEl.empty(),this.giftOptionsEl.append(jsx(jsxFragment,null,jsx("p",null,jsx("label",null,jsx("span",{className:"input-label"},"Method"),jsx("label",null,this.codeOptionEl=jsx("input",{type:"radio",name:"gift-method",value:"code",checked:e}),"Get redeem link"),"\xA0\xA0",jsx("label",null,this.emailOptionEl=jsx("input",{type:"radio",name:"gift-method",value:"email",checked:!e}),"Send anonymously through email"))),jsx("p",{class:"u-muted"},jsx("span",{className:"input-label"}),e?"You'll get a link to redeem the gift. Choose this if you want to send a personalized gift yourself.":"We'll send an email on your behalf. Choose this if you want to stay anonymous or want it to be a surprise."),e?jsx(jsxFragment,null,jsx("p",null,jsx("label",{className:"input-label"},"Recipient name"),this.recipientEl=jsx("input",{type:"email",placeholder:"Recipient name..."})),jsx("p",{class:"u-muted"},jsx("label",{className:"input-label"}),"For your reference only. The recipient will not see this.")):jsx("p",null,jsx("label",{className:"input-label"},"Recipient email"),this.recipientEl=jsx("input",{type:"email",placeholder:"Recipient email..."})))),this.codeOptionEl.addEventListener("change",()=>{let t=this.codeOptionEl.checked;this.updateGiftOptions(t)}),this.emailOptionEl.addEventListener("change",()=>{let t=this.codeOptionEl.checked;this.updateGiftOptions(t)})}updateSummary(){let e=this.getGiftAmount(),t=z-e;if(t<0){this.showError("You cannot gift more credit than you currently have.");return}this.summary.setValues({total:z,gift:e,remaining:t})}onOpen(){super.onOpen(),this.updateSummary()}},Ot=class extends _{constructor(){super();this.setTitle("Pay with PayPal"),this.contentEl.appendChild(jsx(jsxFragment,null,jsx("p",null,"Paying with PayPal is currently a manual process, and we're working on automating it. Please do the following in order to get your payment processed:"),jsx("ol",{className:"u-pop"},jsx("li",null,jsx("span",{class:"mod-warning"},"Verify you're not paying a monthly fee.")," Because it's a manual process, we only accept yearly payments for Sync and Publish. Monthly payments will be refunded."),jsx("li",null,"Forward your PayPal receipt to ",jsx("a",{href:"mailto:support@obsidian.md"},"support@obsidian.md")," and specify what service you're purchasing.")),jsx("p",null,"Your payment should be processed within 3 business days."),jsx("p",null,"Thanks so much for your kind support! Obsidian couldn't have become what it is today without help from amazing people like you. Sorry for the trouble!"),jsx("p",{className:"u-center-text"},jsx("a",{href:"https://paypal.me/obsidianmd",target:"_blank"},jsx("img",{style:"width: 200px; background-color: #FFC439;border-radius: 24px;padding: 8px 40px;",src:"images/paypal-badge.png",alt:"Pay with PayPal"})))))}},Nt=class extends M{constructor(){super();this.setTitle("Apply for discount"),this.contentEl.append(jsx("p",null,"Please choose discount type you're applying for and enter your school or organization email. We will send an email to this email address to verify it."),jsx("p",{class:"u-muted u-small"},"Please note that if you already have early bird, discounts will not stack with early bird."),jsx("p",{class:"u-muted u-small"},"If you do not have an organization email, please contact us at ",jsx("a",{href:"mailto:support@obsidian.md"},"support@obsidian.md")," to provide other forms of verification, such as student ID card, transcript, or employee ID card."),jsx("p",null,jsx("label",null,jsx("span",{class:"input-label"},"Discount type"),jsx("label",null,jsx("input",{type:"radio",name:"apply-discount-type",value:"1",checked:!0}),"Education (student or faculty)"),"\xA0\xA0",jsx("label",null,jsx("input",{type:"radio",name:"apply-discount-type",value:"2"}),"Non-profit organization"))),jsx("p",null,jsx("label",null,jsx("span",{class:"input-label"},"School or organization email"),this.emailEl=jsx("input",{type:"email",placeholder:"Your email..."})))),this.buttonContainerEl.createEl("button",{cls:"mod-cta",text:"Send application"}).addEventListener("click",()=>l(this,null,function*(){this.hideError();let e=this.contentEl.find('input[name="apply-discount-type"]:checked').value,t=this.emailEl.value;if(!e){this.showError("Please select a discount type.");return}if(t===""||!t.contains("@")){this.showError("Please enter a valid organization email address.");return}try{yield c(Ui,{type:e,email:t}),this.close(),new _t().open()}catch(i){this.showError(i)}})),this.buttonContainerEl.createEl("button",{text:"Cancel"}).addEventListener("click",this.close.bind(this))}},_t=class extends D{constructor(){super();this.setTitle("Verify your email"),this.contentEl.append(jsx("p",null,"Thanks for applying for Obsidian discount!"),jsx("p",null,"We've sent an email to your organization email address to verify your email. Once you click on the link, the application will be submitted for review."),jsx("p",null,"If you don't see the email in a few minutes, please try checking your spam folder. You can try applying for a discount again."))}},Ut=class extends D{constructor(){super();this.setTitle("Organization email verified"),this.contentEl.append(jsx("p",null,"Thanks for verifying your organization email! We'll take a look at your application as soon as we can."),jsx("p",null,"You'll get an email update when your discount application is approved. Have a nice day!"))}},Yt=class extends D{constructor(e){super();this.setTitle("Your discount is active"),this.contentEl.append(jsx("p",null,"Your ",jsx("span",{class:"approved-discount-type"},e)," discount is approved!"),jsx("p",null,"You'll see the discount applied when you try to buy Obsidian Sync or Obsidian Publish. It's not applicable to Catalyst licenses, commercial licenses, or donations."))}},Pe=class extends M{constructor(e,t){super();this.setTitle("Redeem your gift"),t?(this.contentEl.append(jsx("p",null,"Unfortunately, we were unable to fetch your gift.")),this.showError(t)):(this.contentEl.append(jsx("p",null,"Someone has sent you a gift worth of $",N(e)," Obsidian Credit. How exciting!")),this.buttonContainerEl.append(jsx(jsxFragment,null,jsx("button",{className:"mod-cta",onclick:this.redeemGift.bind(this)},"Redeem"),jsx("button",{onclick:this.close.bind(this)},"Cancel"))))}redeemGift(){return l(this,null,function*(){try{yield c(ht,{code:W}),new jt().open()}catch(e){new Me(e).open()}})}},Se=class extends D{constructor(e,t,i){super();this.link=`${location.origin}/account?giftcode=${e}`,i?this.setTitle("Successfully sent gift"):this.setTitle("Copied redeem link"),this.contentEl.append(jsx(jsxFragment,null,i?jsx("p",null,"You just sent a gift of ",N(t),' to "',i,'"!'):"",jsx("p",null,"The link to redeem the gift has been copied to your clipboard."),jsx("p",null,this.linkField=jsx("input",{type:"text",value:this.link,style:"width: 100%;"}))))}onOpen(){super.onOpen(),Ce(this.link),this.linkField.select()}},jt=class extends D{constructor(){super();this.setTitle("Gift redeemed"),this.contentEl.append(jsx("p",null,"Your gift was successfully redeemed!"),jsx("p",null,'You should be able to see the credit in the "Obsidian Credit" section. You can use it to buy whatever you want, or even gift to others.'))}onClose(){super.onClose(),mt(),location.reload()}},Me=class extends M{constructor(e){super();this.setTitle("Gift not redeemed"),this.contentEl.append(jsx("p",null,"Unfortunately, we were unable to redeem your gift for you.")),this.showError(e)}},K=T(()=>window.Stripe(pt)),ae=T(()=>K().elements().create("card",{style:{base:{color:"#dcddde",iconColor:"#dcddde",fontFamily:"Inter, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#888888"}},invalid:{fontFamily:"Inter, sans-serif",color:"#fa755a",iconColor:"#fa755a"}}})),zi="",z=0,W=null;ready(()=>{let a=fish(".login-form"),e=fish(".login-form .message.mod-error"),t=fish(".signup-form"),i=fish(".signup-form .message.mod-error"),s=fish(".welcome"),u=fish("#labeled-input-email"),f=fish("#labeled-input-password"),p=fish(".signup-name"),g=fish(".obsidian-signup-email"),v=fish(".signup-password"),A=fish(".welcome-name"),se=fish(".welcome-email"),Gt=fish(".js-change-email"),qt=fish(".modal-container.mod-change-email"),$t=fish(".change-email-new-email"),Vt=fish(".change-email-password"),Xt=fish(".js-confirm-change-email"),R=fish(".modal-container.mod-change-email .message.mod-error"),zt=fish(".js-change-name"),Wt=fish(".modal-container.mod-change-name"),Kt=fish(".change-name-new-name"),Qt=fish(".js-confirm-change-name"),j=fish(".modal-container.mod-change-name .message.mod-error"),Jt=fish(".js-change-password"),Zt=fish(".modal-container.mod-change-password"),en=fish(".change-password-old-password"),tn=fish(".change-password-new-password"),nn=fish(".js-confirm-change-password"),k=fish(".modal-container.mod-change-password .message.mod-error"),an=fish(".js-delete-account"),sn=fish(".modal-container.mod-delete-account"),rn=fish(".delete-account-password"),ln=fish(".delete-account-email"),on=fish(".js-confirm-delete-account"),I=fish(".modal-container.mod-delete-account .message.mod-error"),G=fish(".modal-container.mod-change-info-success"),cn=fish(".js-logout"),Ae=fish(".card.mod-publish"),Re=fish(".card.mod-sync"),ke=fish(".publish-site-num"),Ie=fish(".publish-renew-site-num"),un=fishAll(".publish-renewal-time"),dn=fish(".publish-renew-info-renewing"),He=fish(".publish-renew-info-not-renewing"),hn=fishAll(".js-view-payment-info"),pn=fishAll(".js-open-change-payment"),Be=fish(".current-card-info"),Oe=fish(".modal-container.mod-change-payment-method"),mn=fish(".modal-container.mod-change-payment-method .payment-form"),fn=fish(".js-change-number-of-publish-sites"),re=fish(".js-reduce-number-of-publish-sites"),Ne=fish(".js-change-publish-to-monthly"),_e=fish(".js-change-publish-to-yearly"),Ue=fish(".setting-item-description.mod-publish-frequency"),Ye=fish(".publish-reduce-sites-num"),yn=fish(".js-update-reduce-sites"),je=fish(".js-stop-publish-auto-renewal"),En=fish(".commercial-license-pitch"),gn=fish(".existing-commercial-license"),C=fish(".commercial-license-key"),wn=fish(".commercial-license-company-name"),bn=fishAll(".commercial-license-seat-number"),Ge=fish(".card.mod-commercial-license"),vn=fish(".catalyst-tier"),qe=fish(".catalyst-upgrade-button"),Tn=fishAll(".js-close-modal, .modal-close-button, .modal-bg"),$e=fish(".card.mod-catalyst"),w=fish(".loader-cube"),Cn=fish(".js-go-to-signup"),xn=fish(".js-go-to-login"),Dn=fish(".js-go-to-forgot-pass"),Ve=fish(".forgot-pass-form"),le=fish(".forgot-pass-form .message.mod-success"),H=fish(".forgot-pass-form .message.mod-error"),Ln=fish(".forgot-pass-email"),Xe=fish(".reset-pass-form"),Pn=fish(".forgot-pass-email-container"),Fn=fish(".reset-pass-password"),oe=fish(".reset-pass-form .message.mod-success"),q=fish(".reset-pass-form .message.mod-error"),Sn=fish(".js-request-forgot"),ce=null,Mn=fish(".js-upgrade-publish"),An=fish(".modal-container.mod-publish-reduce-sites"),Rn=fish(".modal-container.mod-view-payment-method"),kn=fish(".js-open-unlimited"),In=fish(".obsidian-credit-amount"),Hn=fish(".donation-amount"),Bn=fishAll(".modal-container"),On=fish(".js-upgrade-sync"),ue=fish(".js-change-sync-to-monthly"),de=fish(".js-change-sync-to-yearly"),he=fish(".js-stop-sync-auto-renewal"),Nn=fishAll(".sync-renewal-time"),ze=fish(".sync-renew-info-renewing"),pe=fish(".sync-renew-info-not-renewing"),We=fish(".setting-item-description.mod-sync-frequency"),_n=fishAll(".commercial-renewal-time"),me=fish(".js-resume-commercial-auto-renewal"),Q=fish(".js-stop-commercial-auto-renewal"),fe=fish(".commercial-renew-info-renewing"),J=fish(".commercial-renew-info-not-renewing"),Un=fishAll(".commercial-license-expiry-date"),Yn=fishAll(".checkbox-container"),jn=fishAll(".claim-discord-badge-button"),Gn=fishAll(".claim-forum-badge-button"),qn=fish(".js-commercial-license-change-seat"),$n=fish(".js-commercial-license-reduce-seat"),Vn=fish(".modal-container.mod-commercial-license-reduce-seats"),Xn=fish(".commercial-license-reduce-seat-input"),zn=fish(".js-update-reduce-seats"),B=fish(".modal-container.mod-commercial-license-reduce-seats .payment-error"),ye={monthly:10,yearly:8,yearlyPromo:"20% off compared to monthly"},Ee={monthly:20,yearly:16,yearlyPromo:"20% off compared to monthly"},ge=T(()=>new Pt),Wn=T(()=>new Tt(ye)),Ke=T(()=>new Ct(Ee)),Qe=T(()=>new xt),Kn=T(()=>new kt),Qn=T(()=>new It),Z="",ee=!1,Je=null,Ze=null,L=!1,P=null,Jn=K(),we=ae(),$=null,U=()=>{if(L){window.location.reload();return}we.unmount(),Bn.forEach(n=>n.hide()),L=!1},b=F.decodeUrlQuery(V);if(b.mode&&b.mode==="signup")De(),w.hide(),t.show(),ee=!0;else if(b.mode&&b.mode==="forgotpass")De(),w.hide(),Ve.show(),ee=!0;else if(b.hasOwnProperty("forgetpw")&&b.id&&b.key)De(),Je=b.id,Ze=b.key,w.hide(),Xe.show(),ee=!0;else if(b.stripe&&b.stripe==="complete"){let n=b.session}else b.discount&&(b.discount==="verified"?new Ut().open():b.discount==="approved"&&b.type&&new Yt(b.type).open());$=F.decodeUrlQuery(X),$.code?l(void 0,null,function*(){try{yield c(Ii,{code:$.code}),new St().open()}catch(n){new Mt(n).open()}}):$.giftcode&&(W=$.giftcode);let Zn=n=>l(void 0,null,function*(){try{let r=yield c(Gi,{code:n});new Pe(r.amount,null).open()}catch(r){new Pe(0,r).open()}}),ei=()=>l(void 0,null,function*(){let n;try{n=yield c(Ei,{})}catch(r){ee||(w.hide(),a.show(),W&&(e.setText("Please log in or sign up to redeem your gift."),e.show()));return}if(zi=n.name,A.setText(n.name),se.setText(n.email),n.donation&&Hn.setText(N(n.donation)),t.hide(),w.hide(),s.show(),n.license&&(Z=n.license),Z?($e.addClass("is-active"),vn.setText(n.license),ge().setTier(Z),Z!=="vip"&&(qe.addEventListener("click",()=>{ge().open()}),qe.show())):$e.addEventListener("click",()=>{ge().open()}),z=n.credit,fish(".js-gift-credit").toggle(n.credit!==0),In.setText(N(n.credit)),n.discount){let{status:r,type:d,expiry_ts:o}=n.discount,m=fish(".setting-item.mod-discount .setting-item-description"),y=fish(".setting-item.mod-discount .setting-item-control a");r==="submitted"?(m.setText("You have submitted your school or organization email, but have not completed email verification yet. Please check your email for a link to verify your email address."),y.hide()):r==="verified"?(m.setText("Your discount application has been submitted for review. Thanks for your patience!"),y.hide()):r==="approved"&&(m.setText(`Your ${d} discount currently gives you 40% off the regular price of Obsidian Sync and Publish. Your discount will expire on ${new Date(o).toLocaleDateString()}.`),y.setText("Renew"))}W&&Zn(W)}),ti=()=>l(void 0,null,function*(){let n=yield c(Pi,{});if(n.business&&n.business.expiry>=Date.now()){P=n.business,C.setText(P.key),wn.setText(P.company);let r=P.seats,d=r===1?"1 seat":r+" seats";bn.forEach(o=>o.setText(d)),Un.forEach(o=>o.setText(new Date(P.expiry).toLocaleDateString())),En.hide(),gn.show()}else Ge.addEventListener("click",()=>Qe().setStatus(0,!0).open());if(n.publish){let{sites:r,renew:d,renew_sites:o,expiry_ts:m,earlybird:y}=n.publish;if(m>=Date.now()){if(Ae.addClass("is-active"),r===1?ke.setText("1 site"):ke.setText(`${r} sites`),o===1?(Ie.setText("1 site"),re.hide()):(Ie.setText(`${o} sites`),re.show()),m){let O=new Date(m);un.forEach(te=>te.setText(`on ${O.toLocaleDateString()}`))}He.hide();let E=document.createDocumentFragment();d==="yearly"?(_e.hide(),E.createSpan({text:"You're currently on a "}),E.createSpan({cls:"u-pop",text:"yearly"}),E.createSpan({text:" plan."})):d==="monthly"?(Ne.hide(),E.createSpan({text:"You're currently on a "}),E.createSpan({cls:"u-pop",text:"monthly"}),E.createSpan({text:" plan."})):d===""&&(je.hide(),He.show(),dn.hide(),E.createSpan({text:"You're not currently being renewed."})),Ue.empty(),Ue.appendChild(E),Ye.value=r}y===!0&&(Ee.yearly/=2,Ee.monthly/=2,Ae.addClass("is-early-bird"))}if(n.sync){let{renew:r,expiry_ts:d,earlybird:o}=n.sync;if(d>=Date.now()){if(Re.addClass("is-active"),d){let y=new Date(d);Nn.forEach(E=>E.setText(`on ${y.toLocaleDateString()}`))}pe.hide(),r==="yearly"||(r==="monthly"?ue.hide():r===""&&(he.hide(),pe.show(),ze.hide()));let m=document.createDocumentFragment();r==="yearly"?(de.hide(),m.createSpan({text:"You're currently on a "}),m.createSpan({cls:"u-pop",text:"yearly"}),m.createSpan({text:" plan."})):r==="monthly"?(ue.hide(),m.createSpan({text:"You're currently on a "}),m.createSpan({cls:"u-pop",text:"monthly"}),m.createSpan({text:" plan."})):r===""&&(he.hide(),pe.show(),ze.hide(),m.createSpan({text:"You're not currently being renewed."})),We.empty(),We.appendChild(m)}o===!0&&(ye.yearly/=2,ye.monthly/=2,Re.addClass("is-early-bird"))}if(n.business){let{renew:r,expiry:d}=n.business;if(d>=Date.now()){if(Ge.addClass("is-active"),d){let o=new Date(d);_n.forEach(m=>m.setText(`on ${o.toLocaleDateString()}`))}J.hide(),r==="yearly"?(me.hide(),Q.show(),J.hide(),fe.show()):r===""&&(me.show(),Q.hide(),J.show(),fe.hide()),r==="yearly"?de.hide():r===""&&(Q.hide(),J.show(),fe.hide())}}}),ni=()=>l(void 0,null,function*(){let n=yield c(ji,{}),r=fish(".setting-item.mod-gift-history"),d=r.find(".setting-item-description");if(!(!n||n.length===0))for(let o of n){let m=`You sent $${N(o.amount)} to "${o.recipient}" on ${new Date(o.ts).toLocaleDateString()}. `;d.createEl("p",{text:m},y=>{if(o.redeemed||y.createEl("a",{cls:"landing-link",text:"Copy redeem link",href:"#"},E=>E.addEventListener("click",O=>l(void 0,null,function*(){O.preventDefault(),new Se(o.redeem_code).open()}))),y.createEl("br"),o.redeemed){let E=o.is_cancelled?"cancelled":"redeemed";y.createEl("span",{text:`Your gift has been ${E} on ${new Date(o.redeemed_ts).toLocaleDateString()}.`})}else y.createEl("span",{text:"Waiting for recipient to redeem gift. "}),y.createEl("span",{text:" "}),y.createEl("a",{cls:"landing-link",text:"Cancel this gift",href:"#"},E=>E.addEventListener("click",O=>l(void 0,null,function*(){if(O.preventDefault(),!!confirm("Are you sure you want to cancel this gift? Your credits will be refunded, and the recipient will no longer be able to redeem it."))try{yield c(ht,{code:o.redeem_code}),location.reload()}catch(ve){new Me(ve).open()}})))}),r.show()}}),ii=()=>l(void 0,null,function*(){e.hide(),a.hide(),w.show();let n=u.value,r=f.value,d=!1;if(n===""?(e.setText("Email cannot be empty."),d=!0):n.indexOf("@")===-1?(e.setText("Email is not valid."),d=!0):r===""&&(e.setText("Password cannot be empty."),d=!0),d){a.show(),w.hide(),e.show();return}try{yield c(gi,{email:u.value,password:f.value}),window.location.reload()}catch(o){a.show(),w.hide(),o==="Login failed"&&(e.setText("Login failed, please double check your email and password."),e.show())}}),ai=()=>l(void 0,null,function*(){i.hide(),t.hide(),w.show();let n=p.value,r=g.value,d=v.value,o=!1;if(n===""?(i.setText("Name cannot be empty."),o=!0):r===""?(i.setText("Email cannot be empty."),o=!0):r.indexOf("@")===-1?(i.setText("Email is not valid."),o=!0):d===""&&(i.setText("Password cannot be empty."),o=!0),o){i.show(),t.show(),w.hide();return}try{yield c(wi,{name:n,email:r,password:d}),window.location.reload()}catch(m){t.show(),w.hide(),m==="Invalid email address"?i.setText("The email address you entered was invalid."):m==="Already signed up"&&i.setText("Seems like you already have an account! Please log in."),i.show()}}),si=()=>l(void 0,null,function*(){H.hide(),le.hide();let n=Ln.value;if(n){if(n.indexOf("@")===-1){H.setText('Email address is not valid and must contain "@".'),H.show();return}}else{H.setText("Please fill out your email."),H.show();return}w.show();try{yield c(vi,{email:n,captcha:"captcha"}),le.setText(`We have sent an email to ${n} to reset your password.`),le.show(),Pn.hide(),Sn.hide(),w.hide()}catch(r){H.setText("Something went wrong, please try again."),H.show(),w.hide()}}),ri=()=>l(void 0,null,function*(){oe.hide(),q.hide();let n=Fn.value;if(!n){q.setText("Please set a new password."),q.show();return}try{yield c(Ti,{password:n,id:Je,key:Ze}),oe.innerHTML='Your password has been successfully set. <a href="/account">Log in</a>',oe.show()}catch(r){q.setText("Something went wrong, please try again."),q.show()}}),li=()=>l(void 0,null,function*(){yield c(bi,{}),window.location.reload()});ei(),ti(),ni(),cn.addEventListener("click",()=>{li()});let be=()=>{let n=C.getText();Ce(n),C.setText("Copied!"),C.addClass("is-copied"),C.removeEventListener("click",be),setTimeout(()=>{C.removeClass("is-copied"),C.setText(n),C.addEventListener("click",be)},500)};C.addEventListener("click",be),Tn.forEach(n=>{n.addEventListener("click",U)}),Cn.addEventListener("click",()=>{location.hash="#mode=signup",location.reload()}),xn.addEventListener("click",()=>{location.hash="",location.reload()}),Dn.addEventListener("click",()=>{location.hash="#mode=forgotpass",location.reload()}),a.find("form").addEventListener("submit",n=>{n.preventDefault(),ii()}),t.find("form").addEventListener("submit",n=>{n.preventDefault(),ai()}),Ve.find("form").addEventListener("submit",n=>{n.preventDefault(),si()}),Xe.find("form").addEventListener("submit",n=>{n.preventDefault(),ri()}),Mn.addEventListener("click",()=>Ke().open()),Ne.addEventListener("click",()=>l(void 0,null,function*(){yield c(S,{type:"publish",renew:"monthly"}),window.location.reload()})),_e.addEventListener("click",()=>l(void 0,null,function*(){yield c(S,{type:"publish",renew:"yearly"}),window.location.reload()})),je.addEventListener("click",()=>l(void 0,null,function*(){yield c(S,{type:"publish",renew:""}),window.location.reload()})),fn.addEventListener("click",()=>Ke().open()),re.addEventListener("click",()=>{An.show()}),yn.addEventListener("click",()=>l(void 0,null,function*(){let n=parseInt(Ye.value);yield c(Ai,{sites:n}),window.location.reload()})),hn.forEach(n=>n.addEventListener("click",()=>l(void 0,null,function*(){let r=yield c(Ri,{});r.info?Be.setText(`You're currently using a ${r.info}.`):Be.setText("You currently do not have any payment methods on file."),Rn.show()}))),pn.forEach(n=>n.addEventListener("click",()=>{Oe.show(),ce=Oe.find(".payment-error"),we.mount(".modal-container.mod-change-payment-method .card-element")})),mn.addEventListener("submit",n=>{n.preventDefault(),Jn.createPaymentMethod({type:"card",card:we}).then(r=>l(void 0,null,function*(){r.paymentMethod&&r.paymentMethod.id?(yield c(ki,{payment_method_id:r.paymentMethod.id}),window.location.reload()):(ce.setText("Could not update your payment method."),ce.show())}))}),kn.addEventListener("click",()=>{Kn().open()}),fish(".js-add-credit").onClickEvent(()=>{Qn().open()}),fish(".js-gift-credit").onClickEvent(()=>{new Bt().open()}),On.addEventListener("click",()=>Wn().open()),ue.addEventListener("click",()=>l(void 0,null,function*(){yield c(S,{type:"sync",renew:"monthly"}),window.location.reload()})),de.addEventListener("click",()=>l(void 0,null,function*(){yield c(S,{type:"sync",renew:"yearly"}),window.location.reload()})),he.addEventListener("click",()=>l(void 0,null,function*(){yield c(S,{type:"sync",renew:""}),window.location.reload()})),Q.addEventListener("click",()=>l(void 0,null,function*(){yield c(S,{type:"business",renew:""}),window.location.reload()})),me.addEventListener("click",()=>l(void 0,null,function*(){yield c(S,{type:"business",renew:"yearly"}),window.location.reload()})),Yn.forEach(n=>{n.addEventListener("click",()=>{n.hasClass("is-enabled")?n.removeClass("is-enabled"):n.addClass("is-enabled")})}),jn.forEach(n=>n.addEventListener("click",()=>yt(n))),Gn.forEach(n=>n.addEventListener("click",()=>Et(n))),Gt.addEventListener("click",()=>{qt.show()}),Xt.addEventListener("click",()=>l(void 0,null,function*(){R.hide();let n=$t.value,r=Vt.value;if(n===""){R.setText("New email cannot be empty."),R.show();return}if(r===""){R.setText("Password cannot be empty."),R.show();return}try{yield c(xi,{password:r,email:n}),U(),L=!0,G.show()}catch(d){R.setText(d),R.show()}})),zt.addEventListener("click",()=>{Wt.show()}),Qt.addEventListener("click",()=>l(void 0,null,function*(){j.hide();let n=Kt.value;if(n===""){j.setText("New name cannot be empty."),j.show();return}try{yield c(Ci,{name:n}),U(),L=!0,G.show()}catch(r){j.setText(r),j.show()}})),Jt.addEventListener("click",()=>{Zt.show()}),nn.addEventListener("click",()=>l(void 0,null,function*(){k.hide();let n=en.value,r=tn.value;if(n===""){k.setText("Current password cannot be empty."),k.show();return}if(n===""){k.setText("New password cannot be empty."),k.show();return}try{yield c(Di,{old_password:n,new_password:r}),U(),L=!0,G.show()}catch(d){k.setText(d),k.show()}})),an.addEventListener("click",()=>{sn.show()}),on.addEventListener("click",()=>l(void 0,null,function*(){I.hide();let n=ln.value,r=rn.value;if(n===""){I.setText("Please enter your email to confirm account deletion."),I.show();return}if(r===""){I.setText("Please enter your password to confirm account deletion."),I.show();return}try{yield c(Li,{email:n,password:r}),U(),L=!0,G.show()}catch(d){I.setText(d),I.show()}})),qn.addEventListener("click",()=>{Qe().setStatus(P.seats,!!P.renew).open()}),$n.addEventListener("click",()=>{Vn.show()}),zn.addEventListener("click",()=>l(void 0,null,function*(){B.hide();let n=Xn.valueAsNumber,r=P.seats;if(n===0){B.setText("The number of seats to remove cannot be 0."),B.show();return}let d=r-n;if(d<0){let o=r===1?"1 seat":r+" seats";B.setText("You currently have "+o+" and cannot remove more seats than that."),B.show();return}try{yield c(Mi,{seats:d}),U(),L=!0,G.show()}catch(o){B.setText(o),B.show()}}));let et="",tt="stripe",nt=fish(".modal-container.mod-invoice-list");fishAll(".js-view-invoices").forEach(n=>n.addEventListener("click",()=>l(void 0,null,function*(){w.show(),s.hide();let r=yield c(Bi,{});w.hide(),s.show(),nt.show();let d=nt.find(".invoice-list");d.empty();for(let o of r)d.createDiv({cls:"invoice-item setting-item"},m=>{m.createDiv({cls:"setting-item-info"},y=>{y.createDiv({text:o.description,cls:"setting-item-name"}),y.createDiv({text:new Date(o.created).toLocaleString(),cls:"setting-item-description"})}),m.createDiv({cls:"setting-item-control mod-vertical"},y=>{y.createEl("button",{cls:"mod-cta",text:"View"},E=>{E.addEventListener("click",()=>{let O=(o.amount/100).toFixed(2),te=(o.refunded/100).toFixed(2),ve=((o.amount-o.refunded)/100).toFixed(2),oi=o.refunded!==0,it=localStorage.getItem("billing-info");fish(".invoice-date").setText(new Date(o.created).toLocaleString()),fish(".invoice-number-title").setText(o.receipt_number||o.id),fish(".invoice-number").setText(o.receipt_number||o.id),fish(".invoice-description").setText(o.description),fish(".invoice-amount").setText(O),oi?(fish(".invoice-box .item.mod-refund").show(),fish(".invoice-refund-amount").setText(te)):fish(".invoice-box .item.mod-refund").hide(),fish(".invoice-total").setText(ve),it&&fish(".billing-info").setText(it),fish(".billing-info").addEventListener("input",()=>{let ci=fish(".billing-info").getText();localStorage.setItem("billing-info",ci)}),fish(".modal-container.mod-invoice-detail").show()})}),o.refundable&&y.createEl("a",{text:"Get refund"},E=>{E.addEventListener("click",()=>{et=o.id,tt=o.type,fish(".modal-container.mod-confirm-refund").show()})})})})}))),fish(".js-confirm-refund").addEventListener("click",()=>l(void 0,null,function*(){fish(".modal-container.mod-invoice-list").hide(),fish(".modal-container.mod-confirm-refund").hide(),w.show(),s.hide();try{yield c(Oi,{charge:et,type:tt}),L=!0,fish(".modal-container.mod-refund-success").show()}catch(n){fish(".refund-failed-reason").setText(n),fish(".modal-container.mod-refund-failed").show()}w.hide(),s.show()})),fish(".js-apply-for-discount").addEventListener("click",()=>new Nt().open())});})();
